# โ ะะตะฐะปะธะทะฐัะธั: ะะพะธัะบ ะผะตัั ะฝะฐ ะบะฐััะต (ะคะฐะทะฐ 2)

**ะะฐัะฐ:** 01.01.2026  
**ะกัะฐััั:** โ ะะฐะฒะตััะตะฝะพ (90%)

---

## ๐ฏ ะะฐะดะฐัะฐ

**ะะฐะทะฒะฐะฝะธะต:** ะะพะธัะบ ะผะตัั ะฟะพ ะฝะฐะทะฒะฐะฝะธั ะฝะฐ ะบะฐััะต  
**ะัะธะพัะธัะตั:** ๐ฅ๐ฅ๐ฅ HIGH  
**Effort:** ๐ง Medium (5 ะดะฝะตะน โ ัะตะฐะปะธะทะพะฒะฐะฝะพ ะทะฐ 1 ัะฐั)  

**ะัะพะฑะปะตะผะฐ:**  
ะะพะปัะทะพะฒะฐัะตะปะธ ะดะพะปะถะฝั ะฒัััะฝัั ะธัะบะฐัั ะบะพะพัะดะธะฝะฐัั ัะพัะตะบ ะฝะฐ ะบะฐััะต ะธะปะธ ะฒะฒะพะดะธัั ะธั ะฒ ัะพัะผะฐัะต "lat, lng". ะญัะพ ะฝะตัะดะพะฑะฝะพ ะธ ััะตะฑัะตั ะทะฝะฐะฝะธั ะณะตะพะณัะฐัะธัะตัะบะธั ะบะพะพัะดะธะฝะฐั.

**ะะตัะตะฝะธะต:**  
ะะพะฑะฐะฒะปะตะฝ ะฟะพะธัะบ ะผะตัั ัะตัะตะท Nominatim Search API ั ะฐะฒัะพะบะพะผะฟะปะธัะพะผ ะธ ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะดะพะฑะฐะฒะปะตะฝะธะตะผ ัะพัะตะบ ะฝะฐ ะบะฐััั.

---

## โ ะงัะพ ัะดะตะปะฐะฝะพ

### 1. ะกะพะทะดะฐะฝ ะบะพะผะฟะพะฝะตะฝั LocationSearchInput

**ะคะฐะนะป:** `components/travel/LocationSearchInput.tsx`

**ะคัะฝะบัะธะพะฝะฐะป:**
- ะะพะธัะบะพะฒัะน input ั ะธะบะพะฝะบะพะน ๐
- Debounce 500ms ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะทะฐะฟัะพัะพะฒ
- ะะฝัะตะณัะฐัะธั ั Nominatim Search API
- Dropdown ั ัะตะทัะปััะฐัะฐะผะธ ะฟะพะธัะบะฐ (ะดะพ 7 ัะตะทัะปััะฐัะพะฒ)
- ะัะพะฑัะฐะถะตะฝะธะต ะฐะดัะตัะฐ (ะณะพัะพะด, ัะตะณะธะพะฝ, ัััะฐะฝะฐ)
- Loading indicator ะฒะพ ะฒัะตะผั ะฟะพะธัะบะฐ
- ะะฝะพะฟะบะฐ ะพัะธััะบะธ input
- ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ
- Empty state ะบะพะณะดะฐ ะฝะธัะตะณะพ ะฝะต ะฝะฐะนะดะตะฝะพ

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะธะฝะธะผัะผ 3 ัะธะผะฒะพะปะฐ ะดะปั ะฝะฐัะฐะปะฐ ะฟะพะธัะบะฐ
- Accept-language=ru ะดะปั ััััะบะธั ะฝะฐะทะฒะฐะฝะธะน
- AbortController ะดะปั ะพัะผะตะฝั ะฟัะตะดัะดััะธั ะทะฐะฟัะพัะพะฒ
- ะะดะฐะฟัะธะฒะฝัะน ะดะธะทะฐะนะฝ (mobile/desktop)
- Accessibility ะฟะพะดะดะตัะถะบะฐ
- Feather Icons (ัะพะพัะฒะตัััะฒะธะต ะดะธะทะฐะนะฝ-ัะธััะตะผะต)

---

### 2. ะะฝัะตะณัะฐัะธั ะฒ TravelWizardStepRoute

**ะคะฐะนะป:** `components/travel/TravelWizardStepRoute.tsx`

**ะะทะผะตะฝะตะฝะธั:**
1. ะะพะฑะฐะฒะปะตะฝ ะธะผะฟะพัั `LocationSearchInput`
2. ะกะพะทะดะฐะฝ handler `handleLocationSelect`:
   - ะะฐััะธั ะบะพะพัะดะธะฝะฐัั ะธะท ัะตะทัะปััะฐัะฐ ะฟะพะธัะบะฐ
   - ะะฟัะตะดะตะปัะตั ัััะฐะฝั ัะตัะตะท `matchCountryId`
   - ะคะพัะผะฐัะธััะตั ะฐะดัะตั
   - ะกะพะทะดะฐะตั ะฝะพะฒัะน ะผะฐัะบะตั
   - ะะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตั ัััะฐะฝั ะฒ ะฒัะฑัะฐะฝะฝัะต
3. ะะพะผะฟะพะฝะตะฝั ัะฐะทะผะตัะตะฝ ะผะตะถะดั coachmark ะธ ะบะฝะพะฟะบะพะน "ะะพะฑะฐะฒะธัั ัะพัะบั ะฒัััะฝัั"

**Handler:**
```typescript
const handleLocationSelect = useCallback(async (result: any) => {
    const lat = Number(result.lat);
    const lng = Number(result.lon);
    
    // ะะฟัะตะดะตะปัะตะผ ัััะฐะฝั
    const derivedCountryId = matchCountryId(...);
    
    // ะคะพัะผะฐัะธััะตะผ ะฐะดัะตั
    const address = formatAddress(result);
    
    // ะกะพะทะดะฐะตะผ ะผะฐัะบะตั
    const newMarker: MarkerData = {
        id: null,
        lat,
        lng,
        address,
        country: derivedCountryId,
        categories: [],
        image: '',
    };
    
    // ะะพะฑะฐะฒะปัะตะผ ะฝะฐ ะบะฐััั
    setMarkers([...markers, newMarker]);
    
    // ะะฒัะพะผะฐัะธัะตัะบะธ ะฒัะฑะธัะฐะตะผ ัััะฐะฝั
    if (derivedCountryId) {
        onCountrySelect(String(derivedCountryId));
    }
}, [markers, countries, selectedCountryIds]);
```

---

## ๐จ UI/UX

### Workflow ะฟะพะปัะทะพะฒะฐัะตะปั:

**ะะพ:**
1. ะัะบัััั Google Maps
2. ะะฐะนัะธ ะผะตััะพ
3. ะกะบะพะฟะธัะพะฒะฐัั ะบะพะพัะดะธะฝะฐัั
4. ะััะฐะฒะธัั ะฒ ัะพัะผะฐัะต "lat, lng"
5. ะะฐะถะฐัั "ะะพะฑะฐะฒะธัั"

**ะะพัะปะต:**
1. ะะฒะตััะธ ะฝะฐะทะฒะฐะฝะธะต ะผะตััะฐ (ะฝะฐะฟัะธะผะตั: "ะญะนัะตะปะตะฒะฐ ะฑะฐัะฝั")
2. ะัะฑัะฐัั ะธะท dropdown
3. โ ะขะพัะบะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปะตะฝะฐ!

### ะะธะทัะฐะปัะฝัะน ะดะธะทะฐะนะฝ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ [ะะพะธัะบ ะผะตััะฐ...]              [x]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ ๐ ะญะนัะตะปะตะฒะฐ ะฑะฐัะฝั            โ      โ
    โ    ะะฐัะธะถ, ะะปั-ะดะต-ะคัะฐะฝั, ะคัะฐะฝัะธั      โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
    โ ๐ Tour Eiffel                โ      โ
    โ    7รจme, ะะฐัะธะถ, ะคัะฐะฝัะธั              โ
    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ง ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### API: Nominatim Search

**Endpoint:**
```
https://nominatim.openstreetmap.org/search
```

**ะะฐัะฐะผะตััั:**
- `format=json` - ัะพัะผะฐั ะพัะฒะตัะฐ
- `q=<query>` - ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั
- `limit=7` - ะผะฐะบัะธะผัะผ ัะตะทัะปััะฐัะพะฒ
- `addressdetails=1` - ะดะตัะฐะปะธ ะฐะดัะตัะฐ
- `accept-language=ru` - ััััะบะธะน ัะทัะบ

**ะัะธะผะตั ะทะฐะฟัะพัะฐ:**
```
https://nominatim.openstreetmap.org/search?format=json&q=ะญะนัะตะปะตะฒะฐ ะฑะฐัะฝั&limit=7&addressdetails=1&accept-language=ru
```

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
[
  {
    "place_id": "106364515",
    "lat": "48.8582599",
    "lon": "2.2945006",
    "display_name": "Tour Eiffel, Paris, France",
    "address": {
      "attraction": "Tour Eiffel",
      "city": "Paris",
      "country": "France",
      "country_code": "fr"
    },
    "type": "attraction",
    "importance": 0.9
  }
]
```

---

### Debounce ะผะตัะฐะฝะธะทะผ

```typescript
useEffect(() => {
    // ะัะธัะฐะตะผ ะฟัะตะดัะดััะธะน ัะฐะนะผะตั
    if (searchTimeoutRef.current) {
        clearTimeout(searchTimeoutRef.current);
    }

    // ะะฐะฟััะบะฐะตะผ ะฝะพะฒัะน ัะฐะนะผะตั (500ms)
    searchTimeoutRef.current = setTimeout(() => {
        searchLocation(query);
    }, 500);

    return () => {
        if (searchTimeoutRef.current) {
            clearTimeout(searchTimeoutRef.current);
        }
    };
}, [query, searchLocation]);
```

**ะญััะตะบั:** ะะฐะฟัะพั ะพัะฟัะฐะฒะปัะตััั ัะพะปัะบะพ ะฟะพัะปะต 500ms ะฟะฐัะทั ะฒ ะฟะตัะฐัะธ.

---

### ะัะผะตะฝะฐ ะทะฐะฟัะพัะพะฒ (AbortController)

```typescript
const abortControllerRef = useRef<AbortController | null>(null);

// ะัะผะตะฝัะตะผ ะฟัะตะดัะดััะธะน ะทะฐะฟัะพั
if (abortControllerRef.current) {
    abortControllerRef.current.abort();
}

abortControllerRef.current = new AbortController();

// Fetch ั signal
fetch(url, { signal: abortControllerRef.current.signal });
```

**ะญััะตะบั:** ะัะตะดัะดััะธะน ะทะฐะฟัะพั ะพัะผะตะฝัะตััั ะฟัะธ ะฝะพะฒะพะผ ะฒะฒะพะดะต, ัะบะพะฝะพะผะธั ััะฐัะธะบะฐ.

---

## ๐ ะะถะธะดะฐะตะผัะต ะผะตััะธะบะธ

| ะะตััะธะบะฐ | ะะพ | ะฆะตะปั | ะัะพะณะฝะพะท |
|---------|-----|------|---------|
| **ะัะตะผั ะดะพะฑะฐะฒะปะตะฝะธั ัะพัะบะธ** | ~60 ัะตะบ | ~10 ัะตะบ | ๐ข -83% |
| **Abandoned forms ะฝะฐ ัะฐะณะต 2** | ? | -40% | ๐ข ะััะพะบะธะน |
| **ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะพะธัะบะฐ** | 0% | 60%+ | ๐ข ะัะฝะพะฒะฝะพะน ัะฟะพัะพะฑ |
| **ะัะธะฑะบะธ ะบะพะพัะดะธะฝะฐั** | ? | -90% | ๐ข ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒะฒะพะด |

---

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะงะตะบะปะธัั ัััะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั:

#### ะะฐะทะพะฒัะน ััะฝะบัะธะพะฝะฐะป:
- [ ] ะะพะธัะบ ัะฐะฑะพัะฐะตั (ะผะธะฝะธะผัะผ 3 ัะธะผะฒะพะปะฐ)
- [ ] Debounce 500ms ัะฐะฑะพัะฐะตั
- [ ] Dropdown ั ัะตะทัะปััะฐัะฐะผะธ ะฟะพัะฒะปัะตััั
- [ ] ะะปะธะบ ะฟะพ ัะตะทัะปััะฐัั ะดะพะฑะฐะฒะปัะตั ัะพัะบั
- [ ] ะะดัะตั ัะพัะผะฐัะธััะตััั ะบะพััะตะบัะฝะพ
- [ ] ะกััะฐะฝะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฒัะฑะธัะฐะตััั

#### ะัะฐะฝะธัะฝัะต ัะปััะฐะธ:
- [ ] ะะพะธัะบ < 3 ัะธะผะฒะพะปะพะฒ โ ะฝะตั ัะตะทัะปััะฐัะพะฒ
- [ ] ะะตั ัะตะทัะปััะฐัะพะฒ โ empty state
- [ ] ะกะตัะตะฒะฐั ะพัะธะฑะบะฐ โ ัะพะพะฑัะตะฝะธะต ะพะฑ ะพัะธะฑะบะต
- [ ] ะัััััะน ะฒะฒะพะด โ ะพัะผะตะฝััััั ััะฐััะต ะทะฐะฟัะพัั

#### ะะฝัะตะณัะฐัะธั:
- [ ] ะขะพัะบะฐ ะฟะพัะฒะปัะตััั ะฝะฐ ะบะฐััะต
- [ ] ะขะพัะบะฐ ะฟะพัะฒะปัะตััั ะฒ ัะฟะธัะบะต
- [ ] ะกััะฐะฝะฐ ะดะพะฑะฐะฒะปัะตััั ะฒ ัะธะปััั
- [ ] ะะฒัะพัะพััะฐะฝะตะฝะธะต ััะฐะฑะฐััะฒะฐะตั

#### ะะธะทะฐะนะฝ:
- [ ] ะะบะพะฝะบะธ Feather (ะฝะต emoji)
- [ ] ะฆะฒะตัะฐ ะธะท ัะพะบะตะฝะพะฒ
- [ ] ะะดะฐะฟัะธะฒะฝะพ ะฝะฐ mobile
- [ ] ะขะตะผะฝะฐั ัะตะผะฐ ัะฐะฑะพัะฐะตั

### ะขะตััะพะฒัะต ะทะฐะฟัะพัั:

```
1. "ะญะนัะตะปะตะฒะฐ ะฑะฐัะฝั" โ ะะฐัะธะถ, ะคัะฐะฝัะธั
2. "ะะพะปะธะทะตะน" โ ะะธะผ, ะัะฐะปะธั
3. "ะัะฐัะฝะฐั ะฟะปะพัะฐะดั" โ ะะพัะบะฒะฐ, ะะพััะธั
4. "Big Ben" โ ะะพะฝะดะพะฝ, ะะตะปะธะบะพะฑัะธัะฐะฝะธั
5. "ะขะฐะดะถ-ะะฐัะฐะป" โ ะะณัะฐ, ะะฝะดะธั
6. "abcdefg12345" โ ะะตั ัะตะทัะปััะฐัะพะฒ
```

---

## ๐ก ะฃะปัััะตะฝะธั ะฒ ะฑัะดััะตะผ

### ะัะฐัะบะพััะพัะฝะพ:
- [ ] ะััะธัะพะฒะฐะฝะธะต ัะตะทัะปััะฐัะพะฒ ะฟะพะธัะบะฐ (localStorage)
- [ ] ะััะพัะธั ะฟะพัะปะตะดะฝะธั ะฟะพะธัะบะพะฒ
- [ ] ะะพะธัะบ ะฟะพ ะบะฐัะตะณะพัะธัะผ (ัะตััะพัะฐะฝั, ะพัะตะปะธ, ะดะพััะพะฟัะธะผะตัะฐัะตะปัะฝะพััะธ)

### ะกัะตะดะฝะตััะพัะฝะพ:
- [ ] ะะตะพะปะพะบะฐัะธั ะฟะพะปัะทะพะฒะฐัะตะปั ะดะปั relev

ant results
- [ ] ะคะธะปัััั ะฟะพ ัะธะฟั ะผะตััะฐ (attraction, city, country)
- [ ] ะะพะธัะบ ะฟะพ ะบะพะพัะดะธะฝะฐัะฐะผ (ะพะฑัะฐัะฝะฐั ะทะฐะดะฐัะฐ)
- [ ] ะะฝัะตะณัะฐัะธั ั Google Places API (ะฐะปััะตัะฝะฐัะธะฒะฐ)

### ะะพะปะณะพััะพัะฝะพ:
- [ ] AI-powered ะฟะพะธัะบ (ะฟะพะฝะธะผะฐะฝะธะต ะบะพะฝัะตะบััะฐ)
- [ ] ะะตะบะพะผะตะฝะดะฐัะธะธ ะฝะฐ ะพัะฝะพะฒะต ะผะฐัััััะฐ
- [ ] ะะพะธัะบ ะฟะพัะพะถะธั ะผะตัั nearby

---

## ๐ง ะะทะฒะตััะฝัะต ะพะณัะฐะฝะธัะตะฝะธั

1. **Rate limit Nominatim:** 1 ะทะฐะฟัะพั/ัะตะบัะฝะดั (debounce ัะตัะฐะตั)
2. **ะะฐัะตััะฒะพ ะดะฐะฝะฝัั:** ะทะฐะฒะธัะธั ะพั OpenStreetMap
3. **ะัััะบะธะต ะฝะฐะทะฒะฐะฝะธั:** ะฝะต ะฒัะต ะผะตััะฐ ะธะผะตัั ััััะบะธะต ะฟะตัะตะฒะพะดั
4. **CORS:** ัะฐะฑะพัะฐะตั ัะพะปัะบะพ ั Nominatim (ั ะฝะธั ะฒะบะปััะตะฝ CORS)

---

## ๐ ะกะฒัะทะฐะฝะฝัะต ัะฐะนะปั

### ะกะพะทะดะฐะฝะฝัะต (1):
- `components/travel/LocationSearchInput.tsx` โญ

### ะะทะผะตะฝะตะฝะฝัะต (1):
- `components/travel/TravelWizardStepRoute.tsx`

### ะัะตะณะพ ัััะพะบ: ~300

---

## โ ะะพัะพะฒะฝะพััั

- [x] ะะพะด ะฝะฐะฟะธัะฐะฝ
- [x] TypeScript ะฑะตะท ะบัะธัะธัะตัะบะธั ะพัะธะฑะพะบ
- [x] ะะธะทะฐะนะฝ-ัะธััะตะผะฐ ัะพะฑะปัะดะตะฝะฐ
- [x] Feather Icons ะธัะฟะพะปัะทััััั
- [x] ะะดะฐะฟัะธะฒะฝัะน ะดะธะทะฐะนะฝ
- [x] Accessibility
- [ ] ะััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต
- [ ] ะะฝัะตะณัะฐัะธั ั ะฐะฝะฐะปะธัะธะบะพะน

---

## ๐ฏ ะัะพะณ

**ะะฐะดะฐัะฐ ะฒัะฟะพะปะฝะตะฝะฐ ะฝะฐ 90%!**

ะัะฝะพะฒะฝะพะน ััะฝะบัะธะพะฝะฐะป ัะตะฐะปะธะทะพะฒะฐะฝ ะธ ะณะพัะพะฒ ะบ ัะตััะธัะพะฒะฐะฝะธั. ะััะฐะปะพัั:
1. ะัะพะฒะตััะธ ัััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต
2. ะะพะฑะฐะฒะธัั ะฐะฝะฐะปะธัะธะบั (`trackWizardEvent('location_search_used')`)
3. ะกะพะฑัะฐัั feedback ะพั ะฟะพะปัะทะพะฒะฐัะตะปะตะน

**ะะถะธะดะฐะตะผัะน ัััะตะบั:**  
ะะตะทะบะพะต ัะฟัะพัะตะฝะธะต ะฟัะพัะตััะฐ ะดะพะฑะฐะฒะปะตะฝะธั ัะพัะตะบ ะฝะฐ ะผะฐััััั. ะะพะปัะทะพะฒะฐัะตะปะธ ัะผะพะณัั ะธัะบะฐัั ะผะตััะฐ ะฟะพ ะฝะฐะทะฒะฐะฝะธั ะฒะผะตััะพ ัััะฝะพะณะพ ะฒะฒะพะดะฐ ะบะพะพัะดะธะฝะฐั.

---

**ะะฐะทัะฐะฑะพััะธะบ:** GitHub Copilot  
**ะะฐัะฐ:** 01.01.2026  
**ะัะตะผั:** ~1 ัะฐั  
**ะกัะฐััั:** โ ะะพัะพะฒะพ ะบ ัะตััะธัะพะฒะฐะฝะธั

