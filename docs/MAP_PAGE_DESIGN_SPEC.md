# ТЗ: Дизайн-улучшения страницы карты (`/map`)

> Дата: 6 февраля 2026
> Область: UI/UX дизайн страницы карты (web + mobile web), без изменений бэкенда
> Основа: анализ ~50 компонентов MapPage/*, MapScreen, хуков, стилей, конфигов

---

## Содержание

1. [Текущее состояние](#1-текущее-состояние)
2. [Выявленные проблемы](#2-выявленные-проблемы)
3. [Что улучшить](#3-что-улучшить)
4. [Что добавить](#4-что-добавить)
5. [Что убрать / исправить](#5-что-убрать--исправить)
6. [Приоритизация](#6-приоритизация)

---

## 1. Текущее состояние

### Архитектура страницы

- **Точка входа**: `app/(tabs)/map.tsx` → lazy-load `screens/tabs/MapScreen.tsx`
- **Контроллер**: `hooks/useMapScreenController.ts` — facade-паттерн, объединяет 5 модульных хуков (`useMapCoordinates`, `useMapFilters`, `useMapDataController`, `useMapUIController`, `useRouteController`)
- **Desktop**: Карта на всю ширину + выдвижная правая панель (фильтры / список мест)
- **Mobile web**: Карта на весь экран + Bottom Sheet (`MapMobileLayout` + `MapBottomSheet.web.tsx`)
- **Карта**: Leaflet (web) через `OptimizedMap.web.tsx` → `Map.web.tsx` → `MapLogicComponent.tsx`

### Компоненты карточного слоя

| Компонент | Контекст использования |
|---|---|
| `AddressListItem` | Карточка места в списке (native: полноразмерная с фото; web: делегирует в `PlaceListCard`) |
| `PlacePopupCard` | Popup при клике на маркер на карте |
| `MapPeekPreview` | Превью топ-3 мест в collapsed-состоянии Bottom Sheet |
| `QuickRecommendations` | Популярное рядом (только native, не отображается на web) |

### Панель фильтров

- `FiltersPanel` → `FiltersPanelHeader` + `FiltersPanelBody` + `FiltersPanelFooter`
- Два режима: **Радиус** (`FiltersPanelRadiusSection`) и **Маршрут** (`FiltersPanelRouteSection`)
- Переключение через `SegmentedControl`
- Контекст: `MapFiltersContext` + `FiltersProvider`

### Дополнительные UI-элементы

- `MapOnboarding` — 3-шаговый тур для новых пользователей
- `MapLegend` — легенда цветов маркеров
- `MapFAB` — плавающая кнопка действий
- `RoutingStatus` — статус построения маршрута (loading/error/success)
- `MapPageSkeleton` — скелетон при загрузке

---

## 2. Выявленные проблемы

### 2.1. Desktop: правая панель — визуальное отделение от карты

- **Проблема**: Правая панель (`rightPanel`) использует `Animated.View` с полупрозрачным overlay при открытии на мобильных, но на desktop выглядит как отдельный блок, визуально не связанный с картой. Нет плавного перехода между картой и панелью.
- **Файлы**: `MapScreen.tsx` (строки 290-326)
- **Влияние**: На desktop панель и карта ощущаются как два отдельных приложения, а не единый интерфейс.

### 2.2. Desktop: переключатель табов «Фильтры / Список» — информационная перегрузка

- **Проблема**: Табы содержат иконку + label + hint-текст + badge — 4 уровня информации на одну кнопку. Hint-текст («Настрой параметров», «N мест») дублирует то, что пользователь уже видит в панели. На мобильных hint скрывается, но сами табы всё равно перегружены.
- **Файл**: `MapScreen.tsx` (строки 140-250)
- **Влияние**: Когнитивная нагрузка; пользователь тратит время на разбор вместо действия.

### 2.3. Mobile Bottom Sheet: три уровня вложенных контролов

- **Проблема**: В expanded-состоянии Bottom Sheet содержит:
  1. Header Bottom Sheet (заголовок + кнопка закрытия)
  2. `SegmentedControl` «Список / Фильтры»
  3. Если фильтры — ещё один `SegmentedControl` «Радиус / Маршрут»
  4. Если маршрут — `RoutingStatus`

  Итого: до 4 уровней «управления» до начала контента. На экране 375px это занимает ~180px — почти половину видимой высоты Bottom Sheet в half-состоянии.
- **Файлы**: `MapMobileLayout.tsx` (строки 239-312), `FiltersPanelHeader.tsx`
- **Влияние**: Основной контент (фильтры/список мест) отодвигается вниз; пользователь должен скроллить, чтобы добраться до полезной информации.

### 2.4. Карточка места (AddressListItem, native) — перегруженный overlay

- **Проблема**: На нативной карточке при hover/всегда отображается:
  - 4 иконки-действия в правом верхнем углу (скрыть, ссылка, копировать, telegram)
  - Название
  - Distance badge + Time badge
  - Координаты (кликабельные)
  - Чипы категорий (до 3)
  - Кнопка «Мои точки»

  Всего до 8 уровней информации + 5 action-кнопок на одной карточке. На маленьких экранах (240px высота) информация не помещается.
- **Файл**: `AddressListItem.tsx` (строки 454-618)
- **Влияние**: Информационная перегрузка; действия конкурируют друг с другом; пользователь не знает, что нажать первым.

### 2.5. PlacePopupCard — inline-стили без StyleSheet

- **Проблема**: `PlacePopupCard` (popup при клике на маркер) использует исключительно inline-стили с ternary-выражениями для breakpoints (`isNarrowPopup ? 9 : isCompactPopup ? 10 : 11`). Нет StyleSheet, 390+ строк спагетти-стилей.
- **Файл**: `PlacePopupCard.tsx` (весь файл)
- **Влияние**: Визуальная несогласованность с остальными компонентами; трудно поддерживать; каждое значение padding/fontSize вычисляется ad-hoc.

### 2.6. MapPeekPreview — нет изображений

- **Проблема**: Превью мест в collapsed-состоянии Bottom Sheet показывает только текст (название + distance/time badges). Нет thumbnail-изображения, хотя данные `travelImageThumbUrl` доступны.
- **Файл**: `MapPeekPreview.tsx`
- **Влияние**: Карточки выглядят одинаково; пользователь не может визуально различить места без чтения текста.

### 2.7. Пустое состояние (empty state) — минималистично до безликости

- **Проблема**: Когда мест не найдено, показывается текст «Мест не найдено» + «Попробуйте изменить фильтры или увеличить радиус поиска». Нет иллюстрации, нет CTA-кнопки для быстрого действия (сбросить фильтры, увеличить радиус).
- **Файлы**: `TravelListPanel.tsx` (строки 106-112), `MapPeekPreview.tsx` (строки 67-80)
- **Влияние**: Пользователь в тупике; нужно самостоятельно найти способ решить проблему.

### 2.8. SegmentedControl — нет визуального индикатора активного сегмента

- **Проблема**: Активный сегмент отличается только цветом текста (`textMuted` → `primary`) и весом шрифта (600 → 700). Нет фонового выделения (animated pill/indicator), как в iOS UISegmentedControl или Material Design. Разница между активным и неактивным слишком тонкая.
- **Файл**: `SegmentedControl.tsx` — есть `indicator` в стилях (строка 119-126), но он не используется в JSX.
- **Влияние**: Пользователь не сразу понимает, какой режим активен; путает состояния.

### 2.9. Onboarding — показывается каждый раз на native

- **Проблема**: `MapOnboarding` проверяет `localStorage` только на web. На native вместо AsyncStorage просто всегда показывает onboarding (`setTimeout(() => setVisible(true), 500)`).
- **Файл**: `MapOnboarding.tsx` (строки 63-66)
- **Влияние**: Пользователь видит onboarding при каждом открытии карты на native.

### 2.10. MapControls — единственная кнопка «Моё местоположение»

- **Проблема**: На карте есть только одна кнопка управления — «Вернуться к моему местоположению» (crosshair). Нет кнопок зума, переключения слоёв карты, поворота. Leaflet по умолчанию рисует зум-контролы, но они стилистически не совпадают с дизайн-системой приложения.
- **Файл**: `MapControls.tsx`
- **Влияние**: Пользователь зависит от стандартных Leaflet-контролов, которые визуально чужеродны.

### 2.11. Поиск адреса ограничен Беларусью

- **Проблема**: `AddressSearch` использует Nominatim с `countrycodes=by` — поиск работает только по Беларуси. Для travel-приложения это критичное ограничение.
- **Файл**: `AddressSearch.tsx` (строка 62)
- **Влияние**: Пользователь не может искать адреса в других странах для построения маршрутов.

### 2.12. Desktop: кнопка «Сбросить фильтры» вместо «Закрыть панель»

- **Проблема**: На desktop вместо кнопки «Закрыть панель» (×) показывается иконка `refresh-cw` для сброса фильтров. Панель на desktop всегда видна — нет способа её закрыть. Но и нет визуального указания, что иконка сбрасывает фильтры (без tooltip).
- **Файл**: `MapScreen.tsx` (строки 223-249)
- **Влияние**: Неочевидное поведение кнопки; пользователь ожидает кнопку закрытия, но получает reset.

### 2.13. Карта не показывает превью фото на кластерах

- **Проблема**: Кластеры маркеров показывают только число (`ClusterLayer.tsx`). При большом количестве мест карта превращается в поле кружков с числами без визуальной идентификации.
- **Файл**: `Map/ClusterLayer.tsx`
- **Влияние**: Пользователь не может визуально определить, какие места содержит кластер, без клика.

### 2.14. Нет визуальной обратной связи при добавлении точки

- **Проблема**: Кнопка «Мои точки» при нажатии показывает только `ActivityIndicator` и toast по завершении. Нет анимации успеха (чекмарк), нет изменения состояния кнопки после добавления (остаётся такой же).
- **Файлы**: `AddressListItem.tsx` (строки 590-613), `PlacePopupCard.tsx` (строки 350-385)
- **Влияние**: Пользователь не уверен, добавилась ли точка; может нажать повторно.

---

## 3. Что улучшить

### 3.1. SegmentedControl: animated pill indicator (P1)

**Текущее**: Только цвет текста меняется.

**Решение**:
- Добавить animated background pill, который перемещается к активному сегменту
- Стиль pill: `backgroundColor: colors.primary`, `borderRadius: 6`, `opacity: 0.12` (для светлых тем) или `opacity: 0.25` (для тёмных)
- Анимация: `Animated.View` с `translateX` (spring, friction: 8, tension: 60)
- Активный текст: `color: colors.primary`, `fontWeight: '700'`
- Неактивный: `color: colors.textMuted`, `fontWeight: '500'`

**Затрагиваемые файлы**: `SegmentedControl.tsx`

---

### 3.2. Mobile Bottom Sheet: объединить управляющие уровни (P1)

**Текущее**: 4 уровня контролов до контента.

**Решение**:
- **Collapsed**: Peek-превью (как сейчас — карточки мест или mode-toggle) — без изменений
- **Half/Full**: Объединить «Список / Фильтры» и «Радиус / Маршрут» в **один компактный toolbar**:
  - Слева: pill-группа `Список | Фильтры`
  - Справа (если фильтры активны): pill-группа `Радиус | Маршрут`
  - Высота toolbar: 48px максимум
- Убрать заголовок «Фильтры» / «Места рядом» из header Bottom Sheet — он дублирует информацию из toolbar
- Убрать `compactHeader` из `FiltersPanelHeader` (header с «N мест • M км») — эта информация уже есть в badge на табе «Список»
- `RoutingStatus` переместить **внутрь** scroll-контента фильтров, а не над ним

**Затрагиваемые файлы**: `MapMobileLayout.tsx`, `MapBottomSheet.web.tsx`, `FiltersPanelHeader.tsx`

---

### 3.3. Карточка AddressListItem (native): упрощение и иерархия (P1)

**Текущее**: 8 уровней информации + 5 action-кнопок.

**Решение**:
- **Видимые всегда** (без hover): название + distance badge (компактный)
- **По hover/tap** (overlay): координаты + категория (1 чип max) + action bar
- **Action bar**: горизонтальная полоса внизу с 3-4 компактными иконками (статья, копировать, поделиться, мои точки) — без текста, только иконки с tooltip
- Убрать кнопку «Скрыть» (eye-off) из постоянно видимых — переместить в long-press context menu или swipe action
- Уменьшить высоту карточки на 320px экранах: 200px вместо 240px
- Distance badge: один компактный badge «12 км · 15 мин» вместо двух отдельных

**Затрагиваемые файлы**: `AddressListItem.tsx`

---

### 3.4. MapPeekPreview: добавить thumbnail (P1)

**Текущее**: Только текст + badges.

**Решение**:
- Добавить thumbnail-изображение (40×40, `borderRadius: 8`, `object-fit: cover`) слева от названия
- Если нет изображения — иконка категории в цветном кружке (как в `QuickRecommendations`)
- Уменьшить `minWidth` карточки: 140px вместо 160px для лучшего вмещения на 320px экранах

**Затрагиваемые файлы**: `MapPeekPreview.tsx`

---

### 3.5. PlacePopupCard: рефакторинг стилей (P1)

**Текущее**: 390+ строк inline-стилей.

**Решение**:
- Вынести стили в `StyleSheet.create` через `getStyles(colors, isCompact)` — как во всех остальных компонентах
- 3 breakpoint-варианта: `narrow` (<480), `compact` (480-640), `default` (>640) — вычислять один раз
- Использовать `DESIGN_TOKENS` для spacing/radii/font sizes вместо magic numbers

**Затрагиваемые файлы**: `Map/PlacePopupCard.tsx`

---

### 3.6. Empty state: иллюстрация + CTA (P2)

**Текущее**: Только текст.

**Решение**:
- Добавить иллюстрацию: используем `assets/no-data.webp` (уже есть в проекте)
- Добавить две CTA-кнопки:
  - «Сбросить фильтры» (variant: outline) — вызывает `resetFilters`
  - «Увеличить радиус» (variant: ghost) — устанавливает radius на максимальное значение
- Текст: «Мест не найдено» → «Рядом ничего не нашлось» (более дружелюбно)
- Подтекст: адаптировать в зависимости от режима (радиус vs маршрут)

**Затрагиваемые файлы**: `TravelListPanel.tsx`, `MapPeekPreview.tsx`

---

### 3.7. Desktop panel: визуальная интеграция с картой (P2)

**Текущее**: Панель и карта — отдельные блоки.

**Решение**:
- Панель: `borderRadius: 0` справа (прилегает к краю экрана), `borderRadius: 16` слева (сторона карты)
- Убрать тень у панели, добавить тонкую `borderLeft: 1px solid colors.border`
- Карта: добавить `borderRadius: 16` на правый край (у панели) через `border-radius` на контейнере
- При закрытой панели — карта занимает 100% без border-radius
- Transition: карта анимированно расширяется/сужается при открытии панели (CSS `transition: width 0.3s ease`)

**Затрагиваемые файлы**: `MapScreen.tsx`, `MapPanel.tsx`

---

### 3.8. Desktop tabs: упрощение (P2)

**Текущее**: Иконка + label + hint + badge = 4 уровня.

**Решение**:
- Убрать hint-текст (`tabHint`, `tabHintActive`) — он дублирует контент панели
- Табы: иконка + label + badge (опционально). Три уровня максимум.
- Кнопка «Сбросить фильтры» (refresh-cw) → добавить tooltip и заменить на текстовую кнопку-ghost «Сбросить» при наличии активных фильтров. Скрывать при отсутствии фильтров.

**Затрагиваемые файлы**: `MapScreen.tsx`

---

### 3.9. Обратная связь при добавлении точки (P2)

**Текущее**: Только spinner → toast.

**Решение**:
- При успешном добавлении: иконка кнопки меняется с `map-pin` на `check` (зелёный) на 2 секунды
- Текст кнопки: «Мои точки» → «Добавлено ✓» (на 2 секунды)
- Кнопка меняет `backgroundColor` на `colors.success` на 2 секунды, потом возвращается
- При повторном нажатии после добавления: toast «Точка уже добавлена» (prevent duplicate)

**Затрагиваемые файлы**: `AddressListItem.tsx`, `PlacePopupCard.tsx`

---

### 3.10. MapControls: кастомные зум-кнопки (P2)

**Текущее**: Только кнопка «Моё местоположение» + стандартные Leaflet-контролы.

**Решение**:
- Добавить кастомные кнопки `+` / `−` в том же стиле (44×44, `borderRadius: 50%`, border + shadow)
- Отключить стандартный `zoomControl` Leaflet (`zoomControl: false`)
- Расположение: правый нижний угол (desktop) / левый нижний (mobile)
- Порядок сверху вниз: Zoom In → Zoom Out → My Location
- Между кнопками: `gap: 8px`

**Затрагиваемые файлы**: `Map/MapControls.tsx`, `Map/MapLogicComponent.tsx` или `Map/useMapInstance.ts`

---

### 3.11. Адресный поиск: убрать ограничение по стране (P2)

**Текущее**: `countrycodes=by` — только Беларусь.

**Решение**:
- Убрать `countrycodes=by` из запроса Nominatim
- Добавить `viewbox` параметр на основе текущего viewport карты (bounded=1) для приоритизации результатов в видимой области
- Fallback: если viewport не доступен — без ограничений

**Затрагиваемые файлы**: `AddressSearch.tsx`

---

### 3.12. Onboarding: починить native persistence (P3)

**Текущее**: На native всегда показывает onboarding.

**Решение**:
- Использовать `AsyncStorage` на native для сохранения `ONBOARDING_STORAGE_KEY`
- Или: универсально использовать `expo-secure-store` / `@react-native-async-storage/async-storage`

**Затрагиваемые файлы**: `MapOnboarding.tsx`

---

## 4. Что добавить

### 4.1. Карточка места на карте: превью при hover на маркер (P2)

**Описание**: При наведении курсора на маркер (web) — показывать mini-tooltip с:
- Название (1 строка, max 30 символов)
- Thumbnail (32×32)
- Distance badge

Tooltip исчезает при уходе курсора. Полный popup остаётся по клику.

**Реализация**: Leaflet `bindTooltip` с кастомным HTML (или React Portal).

**Затрагиваемые файлы**: `Map/MapMarkers.tsx`, `Map/TravelMarkers.tsx`

---

### 4.2. Индикатор загрузки данных на карте (P2)

**Описание**: При загрузке/обновлении маркеров показывать тонкую progress-полосу сверху карты (как в Google Maps при подгрузке).

**Реализация**:
```tsx
{(loading || isFetching) && (
  <View style={styles.mapProgressBar}>
    <Animated.View style={[styles.progressFill, { width: progressWidth }]} />
  </View>
)}
```

**Позиция**: Поверх карты, сверху, `height: 3px`, `backgroundColor: colors.primary`, `zIndex: 10`.

**Затрагиваемые файлы**: `MapScreen.tsx`, `MapMobileLayout.tsx`

---

### 4.3. Быстрые фильтры-чипы поверх карты (P2)

**Описание**: Горизонтальный scroll с chip-кнопками популярных категорий поверх карты (сверху).

**Категории**: Из `filters.categories` — показать топ-5 по количеству мест в данных.

**Визуал**:
- Позиция: абсолютно поверх карты, `top: 12px`, `left: 12px`, `right: 12px`
- Чипы: `paddingHorizontal: 12`, `paddingVertical: 8`, `borderRadius: 20`, `backgroundColor: colors.surface`, `borderWidth: 1`, `borderColor: colors.border`
- Активный чип: `backgroundColor: colors.primary`, `color: colors.textOnPrimary`
- Прокрутка: горизонтальная, `showsHorizontalScrollIndicator: false`

**Затрагиваемые файлы**: новый компонент `MapPage/MapQuickFilters.tsx`, интеграция в `MapScreen.tsx` и `MapMobileLayout.tsx`

---

### 4.4. Кнопка «Показать список» на карте (P3)

**Описание**: Плавающая pill-кнопка внизу по центру карты «Показать N мест списком» (как в Airbnb/Google Maps).

**Поведение**:
- Desktop: переключает на таб «Список» в правой панели
- Mobile: открывает Bottom Sheet в half-состоянии на табе «Список»
- Скрывается, когда список уже открыт

**Визуал**: `paddingHorizontal: 20`, `paddingVertical: 12`, `borderRadius: 24`, `backgroundColor: colors.text`, `color: colors.textOnDark`, `fontSize: 14`, `fontWeight: '600'`, shadow heavy.

**Затрагиваемые файлы**: новый компонент, интеграция в `MapScreen.tsx`, `MapMobileLayout.tsx`

---

### 4.5. Статус-бар текущих фильтров (P3)

**Описание**: Компактная полоса под toolbar карты показывающая активные фильтры в виде dismiss-чипов.

**Пример**: `[Природа ×] [60 км ×] [Маршрут ×]`

**Поведение**:
- Клик на × убирает конкретный фильтр
- Скрывается если нет активных фильтров
- Высота: 36px, горизонтальный scroll

**Затрагиваемые файлы**: новый компонент `MapPage/ActiveFiltersBar.tsx`

---

### 4.6. Skeleton в списке мест при загрузке (P3)

**Описание**: Вместо единого `ActivityIndicator` при загрузке списка — показывать 3-4 skeleton-карточки в `TravelListPanel`.

**Реализация**: Переиспользовать `SkeletonLoader` — карточка 100% × 80px с `borderRadius: 12`, внутри два блока (thumbnail-circle + text lines).

**Затрагиваемые файлы**: `TravelListPanel.tsx`

---

## 5. Что убрать / исправить

### 5.1. Убрать hint-текст из desktop-табов (P1)

**Текущее**: `tabHint` / `tabHintActive` — «Настрой параметров» / «N мест».

**Действие**: Удалить `tabLabelColumn`, `tabHint`, `tabHintActive` из стилей и JSX.

**Файл**: `MapScreen.tsx`

---

### 5.2. Убрать неиспользуемый indicator-стиль из SegmentedControl (P3)

**Текущее**: Стиль `indicator` (строки 119-126) определён, но не рендерится.

**Действие**: Удалить неиспользуемый стиль или реализовать animated indicator (см. п. 3.1).

**Файл**: `SegmentedControl.tsx`

---

### 5.3. Исправить дублирование parseCoord (P3)

**Текущее**: Функция `parseCoord` дублируется в 3 файлах: `AddressListItem.tsx`, `MapPeekPreview.tsx`, `QuickRecommendations.tsx`.

**Действие**: Вынести в `utils/coordinates/index.ts` (файл уже существует) или использовать `CoordinateConverter.fromLooseString` (уже импортируется в `AddressListItem`).

**Файлы**: `MapPeekPreview.tsx`, `QuickRecommendations.tsx`

---

### 5.4. QuickRecommendations: добавить web-поддержку (P3)

**Текущее**: Компонент возвращает `null` на web (строка 91-93).

**Действие**: Показывать рекомендации в режиме радиуса и на web — внутри панели фильтров после основных настроек.

**Файл**: `QuickRecommendations.tsx`, `FiltersPanelBody.tsx` (строки 144-151 — убрать `Platform.OS !== 'web'`)

---

### 5.5. Исправить hardcoded `listTransportMode: 'car'` (P2)

**Текущее**: В `AddressListItem.tsx` (строка 336) транспорт для расчёта расстояния захардкожен как `'car'`, хотя prop `transportMode` передаётся.

**Действие**: Использовать `_transportMode` (переименованный prop) вместо hardcoded `'car'`.

**Файл**: `AddressListItem.tsx`

---

## 6. Приоритизация

### P1 — Критично (влияет на usability)

| # | Задача | Сложность | Влияние |
|---|---|---|---|
| 3.1 | SegmentedControl: animated pill | Средняя | **Высокое** — используется 4+ раза на странице |
| 3.2 | Mobile: объединить управляющие уровни | Высокая | **Высокое** — экономит ~100px экрана на мобильном |
| 3.3 | AddressListItem: упрощение карточки | Средняя | **Высокое** — основной элемент списка |
| 3.4 | MapPeekPreview: добавить thumbnail | Низкая | **Высокое** — первое, что видит пользователь |
| 3.5 | PlacePopupCard: рефакторинг стилей | Средняя | Среднее — качество кода + визуальная согласованность |
| 5.1 | Убрать hint из desktop-табов | Низкая | Среднее — упрощает визуал |
| 5.5 | Исправить hardcoded transport mode | Низкая | Среднее — баг функциональности |

### P2 — Важно (полировка UX)

| # | Задача | Сложность | Влияние |
|---|---|---|---|
| 3.6 | Empty state: иллюстрация + CTA | Низкая | Среднее |
| 3.7 | Desktop panel: визуальная интеграция | Средняя | Среднее |
| 3.8 | Desktop tabs: упрощение | Низкая | Среднее |
| 3.9 | Обратная связь добавления точки | Низкая | Среднее |
| 3.10 | Кастомные зум-кнопки | Средняя | Среднее |
| 3.11 | Адресный поиск: убрать ограничение | Низкая | Среднее |
| 4.1 | Hover-tooltip на маркерах | Средняя | Среднее |
| 4.2 | Progress-бар загрузки на карте | Низкая | Среднее |
| 4.3 | Быстрые фильтры-чипы на карте | Средняя | **Высокое** — ускоряет фильтрацию |

### P3 — Nice-to-have

| # | Задача | Сложность | Влияние |
|---|---|---|---|
| 3.12 | Onboarding: native persistence | Низкая | Среднее |
| 4.4 | Кнопка «Показать N мест» | Средняя | Среднее |
| 4.5 | Статус-бар активных фильтров | Средняя | Низкое |
| 4.6 | Skeleton в списке мест | Низкая | Низкое |
| 5.2 | Убрать неиспользуемый indicator | Низкая | Низкое |
| 5.3 | Рефакторинг parseCoord | Низкая | Низкое |
| 5.4 | QuickRecommendations на web | Средняя | Низкое |

---

## Ограничения

- **Бэкенд не меняется** — все данные из существующих API (`/api/travels/search_travels_for_map/`, `/api/getFiltersTravel/`)
- **Дизайн-система** — использовать `DESIGN_TOKENS` из `constants/designSystem.ts`, `useThemedColors` для цветов
- **Иконки** — только `@expo/vector-icons/Feather` (основной) + `MapIcon` (обёртка)
- **Компоненты UI** — переиспользовать `Button`, `IconButton`, `CardActionPressable`, `SegmentedControl`, `SkeletonLoader`
- **Тестирование** — каждое изменение: `yarn lint` + `yarn test:run`; визуальная проверка на 375px (mobile) и 1440px (desktop)

---

*Документ составлен на основе анализа ~50 компонентов MapPage, 5 модульных хуков карты, контроллера MapScreen, стилей фильтров, карточек мест, popup-компонентов, Leaflet-интеграции и системы навигации.*
