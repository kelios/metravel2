---
description: План UI/UX улучшений панели маршрута на странице карты
---

# План улучшений UI/UX панели маршрута (web/mobile)

## Кратко
- Что делаем: компактная панель маршрута с фиксированной шапкой/статусом и нижним CTA, удобными полями старт/финиш (очистка, swap), компактным списком точек и свёрнутыми справками.
- Для кого: web (desktop/tablet) и mobile (RN web view).
- Что меняется в коде: FiltersPanel.tsx, RoutePointControls.tsx, RoutingStatus.tsx (при необходимости), useRouting.ts (баннер ошибок), стили панелей.

## Цели
- Уменьшить вертикальный скролл и дергание панели.
- Держать статус маршрута, режим и CTA всегда доступными (sticky).
- Упростить ввод/редактирование точек (swap, очистка, автокомплит при наличии).
- Прозрачный fallback при недоступности маршрутизатора (OSRM/ORS) — показывать прямую линию и баннер.

## Ключевые требования
- Sticky: шапка (табы + переключатель режима) и карточка статуса/дистанции закреплены сверху панели; footer CTA закреплен снизу (особенно на мобайл).
- Управление точками: очистка в каждом поле, кнопка swap S/F, удаление отдельных точек и «Очистить маршрут» (outline).
- Справки: «Как построить маршрут» и «Легенда» по умолчанию свёрнуты (accordion).
- Ошибки: баннер «Прямая линия / сервис недоступен» при fallback; «Точки не найдены» с быстрым CTA «+200 км».
- Плотность: вертикальные отступы 12–16px, мобайл padding 16px, минимальная высота интерактивов ≥ 40–44px.

## Изменения по блокам
1) Sticky шапка и статус
- Шапка панели (табы «Фильтры/Список», переключатель «Радиус/Маршрут») остаётся на месте при скролле.
- Статус маршрута (Старт/Финиш/Дистанция) вынести в отдельную компактную карточку под шапкой и тоже закрепить.
- Индикация загрузки маршрута (spinner/label) рядом со статусом.

2) Формы ввода точек
- Поля старта/финиша: кнопка очистки (×) внутри каждого поля.
- Кнопка «Поменять местами» (swap) старт/финиш.
- Автокомплит (если есть AddressSearch) — по выбору автоматически переключать фокус на следующее поле.
- При выборе на карте — подставлять адрес/координату в поля.

3) Транспорт и режим
- Переключатели «Радиус/Маршрут» и транспорт (Авто/Пешком/Вело) визуально объединить, показать активный цветом, остальные — мьют.
- Подсказка «Кликните на карте, чтобы выбрать старт, затем финиш» — компактная, не занимать много места.

4) Список точек маршрута
- Карточки точек (S/F, координаты/адрес) компактные; клик центрирует карту.
- Кнопка удаления рядом с каждой точкой; «Очистить маршрут» — нейтральная (outline), не конкурирует с основным CTA.
- Если маршрут не построен (ошибка или пусто) — текст «Линия: прямая (сервис недоступен)» или «Ожидает выбора точек».

5) Справки и легенда
- «Как построить маршрут» и «Легенда карты» свернуть в аккордеоны по умолчанию.
- Внутри — только краткий текст/иконки, чтобы не занимать высоту.

6) Низ панели (CTA)
- Sticky footer: «Сбросить» (outline) + «Применить/Построить» (primary). Всегда виден на мобайл.
- На desktop можно оставить только «Сбросить», если построение триггерится автоматически.

7) Состояния и ошибки маршрутизатора
- При недоступности OSRM/ORS показать баннер «Маршрут построен прямой линией (сервер недоступен)».
- Если нет точек в радиусе — «Точки не найдены» с CTA «Увеличить радиус до 200 км» (быстрый выбор).

8) Отступы и плотность на мобайл
- Внутренний padding панели: 16px; уменьшить вертикальные gap между блоками, компактные кнопки.
- Максимально убрать лишние разделители/отступы, чтобы уменьшить скролл.

## UX-потоки
- Построение маршрута: пользователь вводит S → F (или кликает по карте), видит статус (loading → success/error), при недоступности сервиса получает баннер и прямую линию.
- Редактирование: может очистить поля, заменить S↔F, удалить отдельную точку, очистить маршрут, изменить транспорт/режим без скролла кверху.
- Информирование: всегда видит текущий режим (Радиус/Маршрут), транспорт и CTA; справка и легенда доступны, но не занимают высоту.

## Макет (словесно)
- Верхняя область (sticky):
  - Таб «Фильтры/Список» + переключатель «Радиус/Маршрут» (единая плашка).
  - Карточка статуса: режим, транспорт, расстояние/время или загрузка/ошибка.
- Прокручиваемая область:
  - Формы адресов (S/F) с очисткой + кнопка swap.
  - Транспортные табы.
  - Список точек (клик → центр, удалить, Outline «Очистить маршрут»).
  - Аккордеоны: «Как построить маршрут», «Легенда карты».
  - Инфобокс найденных точек / сообщения об ошибках.
- Нижняя область (sticky):
  - CTA блок: «Сбросить» (outline) + «Построить»/«Применить» (primary). На desktop можно автопостроение — тогда только «Сбросить».

## Техшаги внедрения
1) Разметка и sticky элементы (FiltersPanel.tsx)
- Ввести sticky wrapper для шапки (табы + переключатель режима) и статусной карточки (Старт/Финиш/Дистанция/Загрузка).
- Перенести RouteStats/Статус ближе к верху, вне scrollable контента.

2) Формы и swap
- Добавить кнопки очистки в поля AddressSearch (если компонент поддерживает) или обернуть в контейнер с иконкой ×.
- Реализовать swap старт/финиш (setRoutePoints и swap адресов, если заданы).

3) Аккордеоны справок
- Обернуть «Как построить маршрут» и «Легенда карты» в collapsible/accordion, по умолчанию свернуть.
- Минимизировать высоту карточек.

4) Список точек маршрута
- Карточки точек: компактный стиль, кнопка удаления, клик → center map.
- Кнопка «Очистить маршрут» (outline/secondary) вблизи списка.

5) Sticky footer CTA
- Добавить нижний fixed/sticky блок с «Сбросить» (outline) и, при необходимости, «Применить/Построить» (primary).
- Обеспечить безопасность: если sticky перекрывает scroll, учесть padding-bottom.

6) Стилизация/токены
- Использовать METRICS/DESIGN_TOKENS для paddings/gaps/радиусов.
- Уменьшить paddings внутри карточек и кнопок на мобайл.

7) Ошибки маршрута
- В useRouting: уже есть fallback на прямую линию; добавить баннер в панели при error (например, routingError строковый) с текстом и ссылкой «Попробовать позже».
- Не спамить запросы: resolvedRouteKeys уже добавлен; проверить наличие баннера.

8) Проверки
- Ручной smoke: мобильный breakpoint — проверить отсутствие избыточного скролла, sticky CTA, swap, удаление точек.
- Desktop: статус сверху, аккордеоны свернуты, кнопки очистки/сброса работают, маршруты показываются (прямая линия, если OSRM недоступен).

## Приоритет внедрения (итерация 1)
1) Sticky шапка + статус + sticky footer CTA.
2) Аккордеоны справок/легенды (свернуть).
3) Очистка полей и кнопка swap старт/финиш.
4) Компактный список точек (клик → центр, удаление).
5) Баннер недоступности маршрутизатора.

## Метрики успеха
- ↓ Время до первой успешной постройки маршрута (медиана) на 10–20%.
- ↓ Кол-во скролл-ивентов на панели (прокси: высота контента, sticky доступность CTA).
- ↑ Доля завершённых сценариев построения (S+F) без ошибок.

## Риски/ограничения
- Sticky на RN Web может конфликтовать со ScrollView: использовать position: 'sticky' для web и fallback padding для native.
- Автокомплит зависит от AddressSearch: если нет поддержки очистки, обернуть в контейнер с кнопкой ×.
- Баннеры ошибок не должны спамить: использовать ключи ошибки и throttling (resolvedRouteKeys).
