# ТЗ: переработка страницы «Путешествие» (Travel Details) — UX/UI + Performance + Responsive

## Статус реализации (актуально)

### Реализовано

- [x] Mobile-first above-the-fold: hero + quick facts + primary actions (быстрые действия вынесены вверх).
- [x] Убрано доминирование навигации над контентом на мобильных:
  - [x] Отключено полноэкранное боковое меню на mobile (оставлено только на desktop).
  - [x] Tabs по секциям на mobile показываются только после начала скролла (не конкурируют с первым экраном).
- [x] Компактная секционная навигация на mobile:
  - [x] Ограничение количества табов + кнопка `Еще`.
  - [x] `Еще` открывает список оставшихся секций в modal.
- [x] Перестановка блоков для mobile: «Автор» больше не занимает первый экран (перенесён ниже по странице).

### Реализовано (технические улучшения)

- [x] Убран лишний 301 редирект при загрузке travel по slug (`fetchTravelBySlug` использует trailing `/`).
- [x] Профиль автора: 401/403 обрабатываются как нефатальная ситуация (страница не «ломается», нет агрессивных retry).

### В работе / Следующее

- [ ] Performance: дополнительно проверить/усилить lazy-load тяжёлых секций (карта/рядом/популярное) и reserved-space под медиа (CLS).
- [ ] UI состояния: fallback для медиа-ошибок (ERR_CONNECTION_REFUSED) с повторной попыткой/плейсхолдером.
- [ ] Cookie-баннер: проверить/исправить перекрытие нижней навигации на mobile.
- [ ] Верификация на реальном mobile viewport: smoke-check, корректность sticky элементов.

## 1) Контекст
Страница путешествия — ключевая посадочная для органического/социального трафика. Пользователь приходит за конкретной ценностью: понять “стоит ли ехать”, как добраться/что посмотреть, сохранить маршрут, поделиться или построить свой план.

Текущее наблюдаемое состояние (по странице `/travels/marshrut-v-beskidakh-ot-parkovki-do-smotrovoi-cherez-vodopad`):
- На мобильном первый экран занимает навигация/меню секций и карточка автора; **галерея и суть маршрута спрятаны ниже**.
- Cookie-баннер перекрывает нижнюю навигацию и/или контент.
- Много “пунктов меню” (якорей) визуально конкурируют с контентом: пользователь читает меню, а не маршрут.
- “Ключевая информация” присутствует, но **не собрана в один «decision block»** (сложно быстро принять решение).
- Есть сетевые/медиа-ошибки: 401 по профилю автора, ошибки загрузки изображений (refused), редирект API `/by-slug` → `/by-slug/`.

## 2) Бизнес-цели
- Увеличить долю пользователей, которые получают “главное” за 5–10 секунд на мобильном.
- Увеличить вовлечённость:
  - просмотр галереи,
  - скролл до описания,
  - открытие карты,
  - переход в “рядом/популярное/путешествия автора”.
- Увеличить конверсии в ключевые действия (приоритеты можно уточнить):
  - сохранить/добавить в избранное,
  - поделиться,
  - построить маршрут (копировать координаты/открыть в картах),
  - экспорт в PDF.
- Снизить технические потери: медленная загрузка медиа, CLS/“прыжки”, тяжёлая карта.

## 3) Пользователи и ключевые сценарии
### 3.1 Персоны (упрощённо)
- **Быстрый решатель**: зашёл по ссылке, хочет понять “красиво ли / сложно ли / сколько времени / как добраться”.
- **Планировщик**: нужен маршрут по точкам, координаты, карта, сезонность/погода, советы.
- **Исследователь**: смотрит фото/видео, похожие маршруты, путешествия автора.

### 3.2 Топ-сценарии
- **S1: Быстрое понимание ценности** (мобайл, 5–10 секунд)
  - увидеть: заголовок, 1–2 лучших фото, регион/страна, длительность/сложность, “что увидишь” (топ-точки), CTA.
- **S2: Посмотреть медиа**
  - листать галерею без лагов, открыть полноэкранно, понимать “сколько фото”.
- **S3: Понять маршрут**
  - открыть карту (быстро, не блокируя рендер), увидеть трек/точки/старт-финиш, скопировать координаты.
- **S4: Принять решение и сохранить**
  - добавить в избранное/поделиться/экспорт.
- **S5: Продолжить сёрфинг**
  - рядом / популярное / другие путешествия автора.

## 4) Проблемы текущего UX (диагностика)
- **Неправильная информационная иерархия на мобильном**:
  - Меню секций (якоря) визуально доминирует над контентом.
  - “Галерея” не является главным “хуком” на первом экране.
- **Слишком много навигации вместо контента**:
  - список секций в виде длинного меню требует когнитивных усилий.
- **Слабый “Decision block”**:
  - ключевые параметры разбросаны, нет “итога/кому подходит”.
- **Перекрытия UI**:
  - cookie-баннер может перекрывать нижнюю навигацию и часть контента.
- **Надёжность данных/медиа**:
  - ошибки загрузки профиля автора/изображений ухудшают доверие и ломают восприятие качества.

## 5) Ключевая идея редизайна
Сделать страницу “travel details” **mobile-first** и “decision-driven”:
- На первом экране — **ценность + быстрые действия**, минимум навигации.
- Навигацию по секциям перевести в **компактный паттерн** (sticky tabs/pills) и показывать только когда это уместно.
- Тяжёлые блоки (карта, рекомендации, рядом) — **ленивая загрузка** и “progressive disclosure”.

## 6) Целевая структура страницы (IA)
### 6.1 Above the fold (первый экран)
**Цель**: “я понял куда еду и хочу продолжить”.

- **Hero Media**
  - 1 ключевое фото/карусель (с чётким reserved space, без скачков).
  - Индикатор `1/10`, кнопка полноэкранного просмотра.
- **Title + Region**
  - название (1–2 строки), страна/регион/ближайший город.
- **Decision Chips (самое важное)**
  - длительность (дн/ч), дистанция/набор (если есть), сезон/тип, уровень сложности.
  - если данных нет — скрыть, не показывать пустые “слоты”.
- **Primary Actions (sticky на мобайле)**
  - избранное (лайк), поделиться, “Открыть в картах/Навигация”, PDF.

### 6.2 Quick summary (короткое резюме)
- 2–4 строки “что это за маршрут и почему стоит” (если в контенте есть — иначе генерировать нельзя).
- Блок “Ключевые точки” (старт → финиш + 2–3 highlights, кнопка “показать все”).

### 6.3 Content sections (ниже)
Разделы (логика и порядок):
1) **Описание** (основной текст)
2) **Маршрут** (точки/список/тайминг) — если есть структурированные данные
3) **Карта** (лениво)
4) **Плюсы / Минусы** (свёрнуты по умолчанию)
5) **Экскурсии / полезные ссылки** (если есть)
6) **Рекомендации / Популярное / Рядом** (лениво)
7) **Автор** (профиль, но не выше hero)

Важно: “Автор” на мобильном не должен забирать первый экран.

## 7) Навигация по секциям (Desktop + Mobile)
### 7.1 Desktop
- Оставить секционную навигацию (tabs/side) но:
  - в пределах контентной области,
  - без доминирования над hero.

### 7.2 Mobile (рекомендуемый паттерн)
- **Sticky compact tabs/pills** появляются только после прокрутки ниже hero.
- Ограничить количество видимых пунктов (например 4–6), остальное — в `Еще`.
- При клике — плавный скролл к секции.

Антипаттерн: длинное меню секций как основной контент первого экрана.

## 8) Удержание пользователя (engagement design)
- **Hook**: качественное hero-медиа + краткое резюме.
- **Второй крючок**: “Ключевые точки” + “Открыть на карте”.
- **Снижение усилий**:
  - копирование координат одной кнопкой,
  - быстрый “share”.
- **Продолжение сессии**:
  - “Рядом” и “Похожие” ближе к концу, но до футера.
  - “Путешествия автора” — как альтернатива, но не вместо основного.

## 9) Адаптивность
### 9.1 Брейкпоинты (принцип)
- Mobile-first.
- На ширинах до ~768px — один столбец, sticky actions.
- Tablet/desktop — 2 колонки допускаются (контент + aside), но hero остаётся главным.

### 9.2 Правила layout
- Hero всегда с зарезервированной высотой.
- Блоки “ключевая инфо / действия” не должны прыгать при загрузке данных.
- Любые “длинные списки” (категории/теги) должны:
  - быть горизонтальным скроллом или “wrap + show more”.

## 10) Состояния (loading/error/empty)
- **Initial loading**: skeleton, совпадающий геометрией с реальным UI (см. `skeleton-redesign-tz.md`).
- **Partial data**:
  - автор не загрузился (401) → показать fallback “Автор недоступен” без поломки layout.
  - изображения не загрузились → placeholder изображения, кнопка “повторить”.
- **Empty секции**: секция не показывается, пункт в tabs скрывается.

## 11) Доступность (a11y)
- Hero carousel: доступные кнопки prev/next, корректные `aria-label`/accessibilityLabel.
- Sticky actions: достаточные hit targets (>=44px).
- Контраст текста/иконок.
- Навигация по секциям: возможность клавиатурной навигации на web.

## 12) Performance требования (Web + Native)
### 12.1 Изображения / Галерея
- Обязательный **reserved space** под hero, чтобы убрать CLS.
- Lazy-load для изображений ниже первого экрана.
- Предзагрузка 1–2 первых hero изображений.
- При ошибке загрузки (refused) — graceful fallback.

### 12.2 Карта
- Карта не должна блокировать LCP/первый рендер:
  - загружать по требованию (при скролле к секции или по кнопке “Открыть карту”).
  - использовать lightweight preview (статичная мини-карта) до инициализации.

### 12.3 Сеть и данные
- Убрать лишние редиректы (API `/by-slug` → `/by-slug/`): выровнять URL, чтобы экономить RTT.
- Параллельные запросы должны быть контролируемыми:
  - travel data — критический.
  - автор/погода/рекомендации — некритические (defer).

### 12.4 Метрики (целевые)
- Web:
  - CLS <= 0.10
  - LCP <= 2.5s (на fast 3G/slow 4G в тестовом окружении)
  - INP <= 200ms

## 13) Компонентная декомпозиция (предложение)
- `TravelHeroMedia`
- `TravelDecisionSummary` (чипы + короткое резюме)
- `TravelPrimaryActions` (sticky на мобайле)
- `TravelSectionsNav` (sticky tabs/pills)
- `TravelMapSection` (lazy)
- `TravelNearbySection` (lazy)
- `TravelAuthorCard` (robust fallback)

## 14) Критерии приемки
- На мобильном **первый экран** содержит:
  - hero media,
  - title + регион,
  - decision chips,
  - primary actions.
- Меню секций не занимает первый экран и не конкурирует с контентом.
- Cookie-баннер не перекрывает важные действия/навигацию (учесть safe-area и bottom nav).
- При ошибках загрузки автора/изображений layout не ломается.
- Карта загружается лениво и не ухудшает LCP.
- Нет заметных прыжков layout при замене skeleton → контент.

## 15) План внедрения (этапы)
1) Перестроить above-the-fold: hero + summary + actions (mobile-first).
2) Внедрить компактную навигацию по секциям (sticky tabs/pills + “Еще”).
3) Перевести карту/рекомендации/рядом на lazy-load.
4) Довести skeleton parity и убрать CLS на деталях.
5) Полировка: a11y, состояния ошибок, метрики.
