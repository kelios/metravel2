# Тест-кейсы: Страница избранного (/favorites)

## Общая информация
- **Страница**: Избранные путешествия
- **URL**: `/favorites`
- **Компонент**: `app/(tabs)/favorites.tsx`
- **Приоритет**: P2 (High)
- **Требует авторизации**: Да

---

## TC-FAV-001: Загрузка страницы избранного (авторизован)
**Приоритет**: P2  
**Предусловия**: Пользователь авторизован, есть избранные путешествия

### Шаги:
1. Авторизоваться
2. Открыть URL `/favorites`
3. Дождаться загрузки

### Ожидаемый результат:
- Страница загружается без ошибок
- Отображается список избранных путешествий
- API запрос: `GET /api/user/{id}/favorite-travels/`
- Каждая карточка содержит кнопку "Удалить из избранного"

### Проверки:
- [ ] Страница отображается
- [ ] Список загружен
- [ ] Кнопки удаления видны

---

## TC-FAV-002: Попытка доступа без авторизации
**Приоритет**: P1  
**Предусловия**: Пользователь НЕ авторизован

### Шаги:
1. Открыть `/favorites` без авторизации

### Ожидаемый результат:
- Редирект на `/login?redirect=/favorites`
- Или отображается сообщение: "Войдите, чтобы просмотреть избранное"
- Кнопка "Войти"

### Проверки:
- [ ] Защита работает
- [ ] Редирект корректен
- [ ] Сообщение понятное

---

## TC-FAV-003: Пустое избранное
**Приоритет**: P2  
**Предусловия**: Пользователь авторизован, избранных нет

### Шаги:
1. Открыть `/favorites` с пустым списком

### Ожидаемый результат:
- Отображается empty state:
  - Иконка или иллюстрация
  - Сообщение: "У вас пока нет избранных путешествий"
  - Кнопка "Исследовать путешествия"

### Проверки:
- [ ] Empty state отображается
- [ ] Сообщение понятное
- [ ] Кнопка ведет на /travelsby

---

## TC-FAV-004: Удаление из избранного
**Приоритет**: P1  
**Предусловия**: Есть избранные путешествия

### Шаги:
1. Найти путешествие в списке
2. Кликнуть на иконку "Удалить" (сердечко или крестик)
3. Подтвердить (если требуется)

### Ожидаемый результат:
- API запрос: `PATCH /api/travels/{id}/unmark-as-favorite/`
- Путешествие исчезает из списка
- Toast уведомление: "Удалено из избранного"
- Счетчик избранного уменьшается

### Проверки:
- [ ] Удаление работает
- [ ] API запрос успешен
- [ ] UI обновляется
- [ ] Feedback пользователю

---

## TC-FAV-005: Клик по карточке избранного
**Приоритет**: P1  
**Предусловия**: Список загружен

### Шаги:
1. Кликнуть на карточку путешествия

### Ожидаемый результат:
- Переход на детальную страницу
- URL: `/travel/[slug]`

### Проверки:
- [ ] Переход работает
- [ ] Детальная страница открыта

---

## TC-FAV-006: Возврат на страницу избранного
**Приоритет**: P2  
**Предусловия**: Открыта детальная страница из избранного

### Шаги:
1. Открыть путешествие из избранного
2. Нажать кнопку "Назад" в браузере

### Ожидаемый результат:
- Возврат на `/favorites`
- Список не перезагружается
- Scroll position восстанавливается (опционально)

### Проверки:
- [ ] Возврат работает
- [ ] Состояние сохранено

---

## TC-FAV-007: Синхронизация избранного на разных страницах
**Приоритет**: P2  
**Предусловия**: Избранное изменено на другой странице

### Шаги:
1. Открыть `/favorites`
2. В другой вкладке добавить путешествие в избранное
3. Вернуться на `/favorites`

### Ожидаемый результат:
- Список обновляется (при обновлении страницы или real-time)
- Новое путешествие видно

### Проверки:
- [ ] Синхронизация работает
- [ ] Данные актуальны

---

## TC-FAV-008: Фильтрация избранного по стране
**Приоритет**: P3  
**Предусловия**: Фильтры доступны

### Шаги:
1. Открыть фильтры
2. Выбрать страну (например, Беларусь)
3. Применить

### Ожидаемый результат:
- Список фильтруется
- Видны только избранные из выбранной страны

### Проверки:
- [ ] Фильтр работает
- [ ] Результаты корректны

---

## TC-FAV-009: Сортировка избранного
**Приоритет**: P3  
**Предусловия**: Опции сортировки доступны

### Шаги:
1. Выбрать сортировку:
   - По дате добавления
   - По названию
   - По популярности

### Ожидаемый результат:
- Список пересортируется
- Порядок изменяется соответственно

### Проверки:
- [ ] Сортировка работает
- [ ] Порядок корректен

---

## TC-FAV-010: Очистка всего избранного
**Приоритет**: P3  
**Предусловия**: Есть избранные путешествия

### Шаги:
1. Найти кнопку "Очистить все"
2. Кликнуть
3. Подтвердить действие

### Ожидаемый результат:
- Модальное окно подтверждения
- API запрос: `DELETE /api/user/{id}/clear-favorite/`
- Список очищается
- Toast: "Избранное очищено"

### Проверки:
- [ ] Подтверждение запрашивается
- [ ] Очистка работает
- [ ] Feedback пользователю

---

## TC-FAV-011: Счетчик избранных путешествий
**Приоритет**: P3  
**Предусловия**: Навигационное меню

### Шаги:
1. Проверить счетчик на иконке "Избранное" в меню
2. Добавить/удалить путешествие

### Ожидаемый результат:
- Счетчик показывает количество избранных
- Обновляется при изменениях

### Проверки:
- [ ] Счетчик отображается
- [ ] Обновляется динамически

---

## TC-FAV-012: Экспорт избранного в PDF
**Приоритет**: P3  
**Предусловия**: Функция экспорта доступна

### Шаги:
1. Найти кнопку "Экспорт"
2. Выбрать "Экспорт в PDF"
3. Дождаться генерации

### Ожидаемый результат:
- PDF генерируется
- Содержит список избранных с изображениями
- Скачивание начинается

### Проверки:
- [ ] Экспорт работает
- [ ] PDF содержит данные

---

## TC-FAV-013: Поделиться избранным
**Приоритет**: P4  
**Предусловия**: Функция шаринга доступна

### Шаги:
1. Найти кнопку "Поделиться"
2. Выбрать способ (ссылка/соцсети)

### Ожидаемый результат:
- Генерируется публичная ссылка или список
- Ссылка копируется или открывается шаринг

### Проверки:
- [ ] Шаринг работает
- [ ] Ссылка корректна

---

## TC-FAV-014: Мобильная версия избранного
**Приоритет**: P2  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть /favorites на мобильном
2. Проверить адаптивность

### Ожидаемый результат:
- Карточки в одну колонку
- Кнопки удаления доступны
- Swipe gesture для удаления (опционально)

### Проверки:
- [ ] Layout адаптирован
- [ ] Функционал работает

---

## TC-FAV-015: SEO метатеги страницы избранного
**Приоритет**: P3  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /favorites
2. Проверить метатеги

### Ожидаемый результат:
```html
<title>Избранное | Metravel</title>
<link rel="canonical" href="https://metravel.by/favorites" />
<meta name="robots" content="noindex, nofollow" />
```

### Проверки:
- [ ] Title корректен
- [ ] noindex установлен (приватная страница)

---

## TC-FAV-016: Обработка ошибки загрузки избранного
**Приоритет**: P2  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку API
2. Открыть /favorites

### Ожидаемый результат:
- Отображается сообщение об ошибке
- Кнопка "Повторить"
- Приложение не падает

### Проверки:
- [ ] Error handling работает
- [ ] Retry доступен

---

## TC-FAV-017: Accessibility (a11y) страницы
**Приоритет**: P3  
**Предусловия**: Keyboard navigation

### Шаги:
1. Использовать Tab для навигации
2. Удалить путешествие через Enter/Space

### Ожидаемый результат:
- Все элементы доступны через Tab
- Кнопки активируются клавишами
- Screen reader озвучивает содержимое

### Проверки:
- [ ] Keyboard navigation работает
- [ ] ARIA labels присутствуют

---

## TC-FAV-018: Пагинация большого списка избранного
**Приоритет**: P3  
**Предусловия**: Больше 20 избранных

### Шаги:
1. Прокрутить список до конца
2. Проверить загрузку следующей страницы

### Ожидаемый результат:
- Infinite scroll или кнопка "Загрузить еще"
- API запрос: `?page=2`

### Проверки:
- [ ] Пагинация работает
- [ ] Нет дубликатов

---

## TC-FAV-019: Добавление в избранное с детальной страницы
**Приоритет**: P2  
**Предусловия**: Открыта детальная страница путешествия

### Шаги:
1. Кликнуть на иконку "Избранное"
2. Перейти на /favorites

### Ожидаемый результат:
- Путешествие появляется в списке
- Синхронизация между страницами

### Проверки:
- [ ] Добавление работает
- [ ] Путешествие видно в избранном

---

## TC-FAV-020: Уведомление о лимите избранного
**Приоритет**: P4  
**Предусловия**: Установлен лимит (например, 100)

### Шаги:
1. Попытаться добавить 101-е путешествие

### Ожидаемый результат:
- Сообщение: "Достигнут лимит избранного (100)"
- Предложение удалить старые

### Проверки:
- [ ] Лимит работает
- [ ] Сообщение понятное

---

## Покрытие автоматизацией

### Jest unit tests:
- Логика управления избранным
- Обработка API ответов
- Синхронизация состояния

### Playwright E2E:
- `e2e/favorites-page.spec.ts`
- Добавление/удаление избранного
- Защита от неавторизованного доступа

### Связанные файлы:
- `app/(tabs)/favorites.tsx`
- `stores/favoritesStore.ts`
- `api/favorites.ts`
- `__tests__/stores/favoritesStore.test.ts`
