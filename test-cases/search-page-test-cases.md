# Тест-кейсы: Страница поиска (/search)

## Общая информация
- **Страница**: Глобальный поиск
- **URL**: `/search`
- **Компонент**: `app/(tabs)/search.tsx`
- **Приоритет**: P2 (High)

---

## TC-SEARCH-001: Загрузка страницы поиска
**Приоритет**: P2  
**Предусловия**: API доступен

### Шаги:
1. Открыть URL `/search`
2. Дождаться загрузки страницы

### Ожидаемый результат:
- Страница загружается без ошибок
- Видно поле поиска
- Видны фильтры (опционально)
- Placeholder: "Поиск путешествий, мест, стран..."

### Проверки:
- [ ] Страница отображается
- [ ] Поле поиска активно
- [ ] Нет ошибок в консоли

---

## TC-SEARCH-002: Поиск по названию путешествия
**Приоритет**: P1  
**Предусловия**: В базе есть путешествия

### Шаги:
1. Ввести в поиск: `Минск`
2. Нажать Enter или кнопку поиска

### Ожидаемый результат:
- Отображаются результаты поиска
- Карточки путешествий с "Минск" в названии или описании
- API запрос: `GET /api/travels/?search=Минск` или `?q=Минск`
- Количество результатов отображается

### Проверки:
- [ ] Результаты релевантны
- [ ] API запрос корректен
- [ ] Счетчик результатов виден

---

## TC-SEARCH-003: Поиск по стране
**Приоритет**: P1  
**Предусловия**: Фильтр по странам доступен

### Шаги:
1. Ввести в поиск: `Польша`
2. Или выбрать из фильтра стран
3. Применить

### Ожидаемый результат:
- Отображаются путешествия в Польше
- Результаты соответствуют выбранной стране

### Проверки:
- [ ] Фильтр работает
- [ ] Результаты корректны

---

## TC-SEARCH-004: Поиск с пустым запросом
**Приоритет**: P2  
**Предусловия**: Поле поиска пустое

### Шаги:
1. Не вводить ничего в поиск
2. Нажать Enter

### Ожидаемый результат:
- Отображается сообщение: "Введите запрос для поиска"
- Или показываются популярные путешествия
- API запрос может не отправляться

### Проверки:
- [ ] Поведение определено
- [ ] Нет ошибок

---

## TC-SEARCH-005: Поиск без результатов
**Приоритет**: P2  
**Предусловия**: Запрос не возвращает результатов

### Шаги:
1. Ввести запрос: `НесуществующееМесто123`
2. Выполнить поиск

### Ожидаемый результат:
- Отображается: "По вашему запросу ничего не найдено"
- Предложения:
  - Изменить запрос
  - Очистить фильтры
  - Посмотреть популярные путешествия

### Проверки:
- [ ] Empty state отображается
- [ ] Предложения понятны

---

## TC-SEARCH-006: Автодополнение (autocomplete)
**Приоритет**: P3  
**Предусловия**: Autocomplete реализован

### Шаги:
1. Начать вводить: `Мин...`
2. Наблюдать выпадающий список

### Ожидаемый результат:
- Появляется список подсказок:
  - Минск
  - Минская область
  - Предыдущие поисковые запросы
- Можно кликнуть на подсказку

### Проверки:
- [ ] Autocomplete работает
- [ ] Подсказки релевантны
- [ ] Клик применяет подсказку

---

## TC-SEARCH-007: История поиска
**Приоритет**: P3  
**Предусловия**: Пользователь выполнял поиск ранее

### Шаги:
1. Открыть страницу поиска
2. Проверить отображение истории

### Ожидаемый результат:
- Под полем поиска видна история запросов
- Можно кликнуть на запрос из истории
- Можно очистить историю

### Проверки:
- [ ] История отображается
- [ ] Клик по истории работает
- [ ] Очистка работает

---

## TC-SEARCH-008: Применение фильтров в поиске
**Приоритет**: P2  
**Предусловия**: Фильтры доступны

### Шаги:
1. Ввести запрос: `природа`
2. Применить фильтры:
   - Страна: Беларусь
   - Категория: Парки
3. Обновить результаты

### Ожидаемый результат:
- Результаты учитывают и запрос, и фильтры
- URL обновляется: `/search?q=природа&countries=[112]&categories=[1]`
- API запрос содержит все параметры

### Проверки:
- [ ] Фильтры применяются
- [ ] Результаты комбинированные
- [ ] URL синхронизирован

---

## TC-SEARCH-009: Очистка поискового запроса
**Приоритет**: P3  
**Предусловия**: Запрос введен

### Шаги:
1. Ввести запрос
2. Кликнуть на иконку "X" в поле поиска

### Ожидаемый результат:
- Поле очищается
- Результаты могут исчезнуть или показаться все путешествия
- Фокус остается на поле

### Проверки:
- [ ] Очистка работает
- [ ] UI обновляется

---

## TC-SEARCH-010: Поиск с опечаткой (fuzzy search)
**Приоритет**: P3  
**Предусловия**: Fuzzy search реализован

### Шаги:
1. Ввести запрос с опечаткой: `Миньск` (вместо Минск)
2. Выполнить поиск

### Ожидаемый результат:
- Система находит похожие результаты
- Сообщение: "Показаны результаты для 'Минск'"
- Или предложение: "Возможно, вы имели в виду: Минск"

### Проверки:
- [ ] Fuzzy search работает
- [ ] Результаты релевантны

---

## TC-SEARCH-011: Поиск по нескольким словам
**Приоритет**: P2  
**Предусловия**: Поддержка multi-word search

### Шаги:
1. Ввести: `Беловежская пуща природа`
2. Выполнить поиск

### Ожидаемый результат:
- Результаты содержат все или большинство слов
- Релевантность по убыванию
- Подсветка ключевых слов (опционально)

### Проверки:
- [ ] Multi-word работает
- [ ] Результаты релевантны

---

## TC-SEARCH-012: Сортировка результатов поиска
**Приоритет**: P3  
**Предусловия**: Опции сортировки доступны

### Шаги:
1. Выполнить поиск
2. Выбрать сортировку:
   - По релевантности
   - По популярности
   - По дате добавления

### Ожидаемый результат:
- Результаты пересортируются
- URL обновляется: `?sort=popular`
- API запрос включает параметр сортировки

### Проверки:
- [ ] Сортировка работает
- [ ] Порядок изменяется

---

## TC-SEARCH-013: Пагинация результатов поиска
**Приоритет**: P2  
**Предусловия**: Результатов больше одной страницы

### Шаги:
1. Выполнить популярный запрос
2. Прокрутить до конца списка
3. Загрузить следующую страницу

### Ожидаемый результат:
- Новые результаты подгружаются (infinite scroll)
- Или кнопка "Загрузить еще"
- API запрос: `?page=2`

### Проверки:
- [ ] Пагинация работает
- [ ] Нет дубликатов

---

## TC-SEARCH-014: Клик по результату поиска
**Приоритет**: P1  
**Предусловия**: Результаты отображены

### Шаги:
1. Выполнить поиск
2. Кликнуть на карточку путешествия

### Ожидаемый результат:
- Переход на детальную страницу
- URL: `/travel/[slug]`
- Поисковый запрос может сохраниться для возврата

### Проверки:
- [ ] Переход работает
- [ ] Детальная страница открыта

---

## TC-SEARCH-015: Сохранение поискового запроса в URL
**Приоритет**: P2  
**Предусловия**: Query params поддерживаются

### Шаги:
1. Выполнить поиск: `Минск`
2. Проверить URL

### Ожидаемый результат:
- URL обновляется: `/search?q=Минск`
- При обновлении страницы поиск восстанавливается
- Можно поделиться ссылкой

### Проверки:
- [ ] URL синхронизирован
- [ ] Состояние восстанавливается

---

## TC-SEARCH-016: Поиск с deep link
**Приоритет**: P2  
**Предусловия**: URL с параметрами

### Шаги:
1. Открыть `/search?q=Минск&countries=[112]`
2. Проверить применение параметров

### Ожидаемый результат:
- Поисковый запрос "Минск" автоматически применен
- Фильтр "Беларусь" активен
- Результаты отображаются

### Проверки:
- [ ] Deep link работает
- [ ] Параметры применены

---

## TC-SEARCH-017: Мобильная версия поиска
**Приоритет**: P2  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть /search на мобильном
2. Проверить адаптивность

### Ожидаемый результат:
- Поле поиска адаптировано
- Фильтры в модальном окне
- Результаты в одну колонку
- Клавиатура не перекрывает контент

### Проверки:
- [ ] Layout адаптирован
- [ ] Keyboard handling корректен

---

## TC-SEARCH-018: SEO метатеги страницы поиска
**Приоритет**: P2  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /search
2. Проверить метатеги

### Ожидаемый результат:
```html
<title>Поиск путешествий | Metravel</title>
<link rel="canonical" href="https://metravel.by/search" />
<meta name="robots" content="noindex, follow" />
```

### Проверки:
- [ ] Title корректен
- [ ] Canonical правильный
- [ ] noindex для страниц поиска

---

## TC-SEARCH-019: Поиск по статьям
**Приоритет**: P3  
**Предусловия**: Поиск поддерживает статьи

### Шаги:
1. Ввести запрос, относящийся к статье
2. Проверить результаты

### Ожидаемый результат:
- В результатах могут быть и путешествия, и статьи
- Статьи помечены соответствующим бейджем
- API: `GET /api/articles?q=...`

### Проверки:
- [ ] Статьи в результатах
- [ ] Различение типов контента

---

## TC-SEARCH-020: Обработка ошибки API
**Приоритет**: P1  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку API
2. Выполнить поиск

### Ожидаемый результат:
- Отображается сообщение об ошибке
- Кнопка "Повторить"
- Приложение не падает

### Проверки:
- [ ] Error handling работает
- [ ] Retry доступен

---

## TC-SEARCH-021: Производительность поиска
**Приоритет**: P3  
**Предусловия**: Performance tools

### Шаги:
1. Выполнить поиск
2. Измерить время ответа

### Ожидаемый результат:
- Результаты загружаются < 1s
- Debounce для autocomplete (300ms)
- Нет лагов при вводе

### Проверки:
- [ ] Поиск быстрый
- [ ] Debounce работает

---

## TC-SEARCH-022: Accessibility (a11y) поиска
**Приоритет**: P2  
**Предусловия**: Keyboard navigation

### Шаги:
1. Использовать Tab для навигации
2. Выполнить поиск через Enter
3. Навигация по результатам

### Ожидаемый результат:
- Поле поиска доступно через Tab
- Enter отправляет запрос
- Стрелки навигация по autocomplete
- Screen reader озвучивает результаты

### Проверки:
- [ ] Keyboard navigation работает
- [ ] ARIA live region для результатов

---

## TC-SEARCH-023: Экспорт результатов поиска
**Приоритет**: P4  
**Предусловия**: Функция экспорта доступна

### Шаги:
1. Выполнить поиск
2. Найти кнопку "Экспорт"
3. Выбрать формат (PDF/CSV)

### Ожидаемый результат:
- Файл с результатами генерируется
- Содержит список найденных путешествий

### Проверки:
- [ ] Экспорт работает
- [ ] Формат корректен

---

## TC-SEARCH-024: Сохранение поискового запроса
**Приоритет**: P4  
**Предусловия**: Пользователь авторизован

### Шаги:
1. Выполнить поиск с фильтрами
2. Сохранить запрос (если функция есть)
3. Вернуться позже и загрузить сохраненный запрос

### Ожидаемый результат:
- Запрос сохраняется
- Можно загрузить позже
- Уведомления о новых результатах (опционально)

### Проверки:
- [ ] Сохранение работает
- [ ] Загрузка работает

---

## TC-SEARCH-025: Поиск с фильтром по дате
**Приоритет**: P3  
**Предусловия**: Фильтр по дате доступен

### Шаги:
1. Выполнить поиск
2. Применить фильтр: "Добавлено за последний месяц"

### Ожидаемый результат:
- Результаты только за указанный период
- API параметр: `?date_from=...&date_to=...`

### Проверки:
- [ ] Фильтр работает
- [ ] Даты корректны

---

## Покрытие автоматизацией

### Jest unit tests:
- Логика поиска
- Обработка фильтров
- Debounce функции

### Playwright E2E:
- `e2e/search-page.spec.ts`
- Поиск и результаты
- Фильтры
- Пагинация

### Связанные файлы:
- `app/(tabs)/search.tsx`
- `components/search/SearchBar.tsx`
- `api/search.ts`
- `__tests__/components/search/`
