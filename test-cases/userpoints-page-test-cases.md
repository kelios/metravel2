# Тест-кейсы: Страница "Мои точки" (/userpoints)

## Общая информация
- **Страница**: Мои точки (User Points)
- **URL**: `/userpoints`
- **Компонент**: `app/(tabs)/userpoints.tsx`, `src/screens/tabs/UserPointsScreen.tsx`
- **Приоритет**: P2 (High)
- **Требует авторизации**: Да

---

## TC-USERPOINTS-001: Загрузка страницы "Мои точки"
**Приоритет**: P2  
**Предусловия**: Пользователь авторизован

### Шаги:
1. Авторизоваться
2. Открыть URL `/userpoints`
3. Дождаться загрузки страницы

### Ожидаемый результат:
- Страница загружается без ошибок
- Отображается список сохраненных точек
- Кнопка "Импортировать точки" доступна
- Skeleton/Loading отображается во время загрузки

### Проверки:
- [ ] Страница отображается
- [ ] Список загружен
- [ ] Нет ошибок в консоли

---

## TC-USERPOINTS-002: Попытка доступа без авторизации
**Приоритет**: P1  
**Предусловия**: Пользователь НЕ авторизован

### Шаги:
1. Открыть `/userpoints` без авторизации

### Ожидаемый результат:
- Отображается сообщение: "Требуется авторизация"
- Текст: "Для использования этой функции необходимо войти в систему"
- Кнопка "Войти" ведет на `/login`
- Нет падения приложения

### Проверки:
- [ ] Защита работает
- [ ] Сообщение понятное
- [ ] Кнопка "Войти" работает

---

## TC-USERPOINTS-003: Пустой список точек
**Приоритет**: P2  
**Предусловия**: У пользователя нет сохраненных точек

### Шаги:
1. Открыть `/userpoints` с пустым списком

### Ожидаемый результат:
- Отображается empty state:
  - Иконка или иллюстрация
  - Сообщение: "У вас пока нет сохраненных точек"
  - Текст с пояснением функции
  - Кнопка "Импортировать точки"

### Проверки:
- [ ] Empty state отображается
- [ ] Сообщение понятное
- [ ] Призыв к действию виден

---

## TC-USERPOINTS-004: Просмотр списка точек
**Приоритет**: P2  
**Предусловия**: Есть сохраненные точки

### Шаги:
1. Открыть страницу со списком точек
2. Проверить отображение

### Ожидаемый результат:
Каждая точка содержит:
- Название/адрес
- Координаты (lat, lon)
- Дата добавления
- Описание (если есть)
- Иконка типа точки
- Кнопки действий (редактировать, удалить, показать на карте)

### Проверки:
- [ ] Список отображается
- [ ] Данные корректны
- [ ] Кнопки видны

---

## TC-USERPOINTS-005: Открытие визарда импорта точек
**Приоритет**: P1  
**Предусловия**: Страница загружена

### Шаги:
1. Кликнуть на кнопку "Импортировать точки"
2. Проверить открытие визарда

### Ожидаемый результат:
- Открывается модальное окно (Modal / Sheet)
- Отображается визард импорта (ImportWizard)
- Доступны опции импорта:
  - Google Maps (из истории локаций)
  - GPX файл
  - KML файл
  - Вручную ввести координаты

### Проверки:
- [ ] Визард открывается
- [ ] Опции отображаются
- [ ] UI корректен

---

## TC-USERPOINTS-006: Импорт из Google Maps
**Приоритет**: P1  
**Предусловия**: Визард импорта открыт

### Шаги:
1. Выбрать "Google Maps"
2. Загрузить файл истории локаций (JSON)
3. Подтвердить импорт

### Ожидаемый результат:
- Файл парсится
- Отображается предпросмотр точек
- Можно выбрать точки для импорта
- После подтверждения точки добавляются в список
- Модальное окно закрывается
- Toast: "Импортировано X точек"

### Проверки:
- [ ] Импорт работает
- [ ] Парсинг корректен
- [ ] Точки добавлены
- [ ] Feedback пользователю

---

## TC-USERPOINTS-007: Импорт GPX файла
**Приоритет**: P2  
**Предусловия**: Визард импорта открыт

### Шаги:
1. Выбрать "GPX файл"
2. Загрузить GPX файл
3. Подтвердить

### Ожидаемый результат:
- GPX парсится
- Waypoints и треки извлекаются
- Предпросмотр на карте (опционально)
- Точки импортируются

### Проверки:
- [ ] GPX парсинг работает
- [ ] Данные корректны
- [ ] Импорт успешен

---

## TC-USERPOINTS-008: Импорт KML файла
**Приоритет**: P3  
**Предусловия**: Визард импорта открыт

### Шаги:
1. Выбрать "KML файл"
2. Загрузить KML файл
3. Подтвердить

### Ожидаемый результат:
- KML парсится
- Placemarks извлекаются
- Точки импортируются

### Проверки:
- [ ] KML парсинг работает
- [ ] Импорт успешен

---

## TC-USERPOINTS-009: Валидация файла при импорте
**Приоритет**: P2  
**Предусловия**: Попытка загрузить неверный файл

### Шаги:
1. Попытаться загрузить:
   - Файл неверного формата (TXT вместо GPX)
   - Поврежденный файл
   - Файл > макс. размера (например, 10MB)

### Ожидаемый результат:
- Ошибки валидации:
  - "Неподдерживаемый формат файла"
  - "Файл поврежден"
  - "Файл слишком большой (макс. 10MB)"
- Импорт не выполняется

### Проверки:
- [ ] Валидация работает
- [ ] Сообщения понятны
- [ ] Приложение не падает

---

## TC-USERPOINTS-010: Ручное добавление точки
**Приоритет**: P2  
**Предусловия**: Визард импорта открыт

### Шаги:
1. Выбрать "Добавить вручную"
2. Ввести данные:
   - Название
   - Широта (lat)
   - Долгота (lon)
   - Описание (опционально)
3. Сохранить

### Ожидаемый результат:
- Форма отображается
- Валидация координат работает
- Точка добавляется в список
- Toast: "Точка добавлена"

### Проверки:
- [ ] Форма работает
- [ ] Валидация корректна
- [ ] Точка сохранена

---

## TC-USERPOINTS-011: Валидация координат при ручном добавлении
**Приоритет**: P2  
**Предусловия**: Форма ручного добавления

### Шаги:
1. Ввести невалидные координаты:
   - Широта > 90 или < -90
   - Долгота > 180 или < -180
   - Нечисловые значения

### Ожидаемый результат:
- Ошибки валидации:
  - "Широта должна быть от -90 до 90"
  - "Долгота должна быть от -180 до 180"
  - "Введите числовое значение"

### Проверки:
- [ ] Валидация работает
- [ ] Сообщения понятны

---

## TC-USERPOINTS-012: Просмотр точки на карте
**Приоритет**: P2  
**Предусловия**: Есть точки в списке

### Шаги:
1. Найти точку в списке
2. Кликнуть "Показать на карте" или иконку карты

### Ожидаемый результат:
- Открывается модальное окно с картой
- Точка отмечена маркером
- Карта центрирована на точке
- Можно закрыть модальное окно

### Проверки:
- [ ] Карта открывается
- [ ] Точка отображается
- [ ] Координаты корректны

---

## TC-USERPOINTS-013: Редактирование точки
**Приоритет**: P2  
**Предусловия**: Есть точки в списке

### Шаги:
1. Найти точку
2. Кликнуть "Редактировать" или иконку карандаша
3. Изменить данные
4. Сохранить

### Ожидаемый результат:
- Открывается форма редактирования
- Поля заполнены текущими данными
- Изменения сохраняются
- Toast: "Точка обновлена"

### Проверки:
- [ ] Редактирование работает
- [ ] Данные обновляются
- [ ] Валидация работает

---

## TC-USERPOINTS-014: Удаление точки
**Приоритет**: P2  
**Предусловия**: Есть точки в списке

### Шаги:
1. Найти точку
2. Кликнуть "Удалить" или иконку корзины
3. Подтвердить удаление

### Ожидаемый результат:
- Модальное окно подтверждения
- Сообщение: "Вы уверены, что хотите удалить эту точку?"
- После подтверждения точка удаляется
- Toast: "Точка удалена"

### Проверки:
- [ ] Подтверждение запрашивается
- [ ] Удаление работает
- [ ] Список обновляется

---

## TC-USERPOINTS-015: Массовое удаление точек
**Приоритет**: P3  
**Предусловия**: Есть несколько точек

### Шаги:
1. Включить режим выбора (если есть)
2. Выбрать несколько точек
3. Кликнуть "Удалить выбранные"
4. Подтвердить

### Ожидаемый результат:
- Чекбоксы для выбора появляются
- Можно выбрать несколько точек
- Массовое удаление работает
- Toast: "Удалено X точек"

### Проверки:
- [ ] Режим выбора работает
- [ ] Массовое удаление работает

---

## TC-USERPOINTS-016: Фильтрация точек по дате
**Приоритет**: P3  
**Предусловия**: Точки добавлены в разные даты

### Шаги:
1. Открыть фильтры (если доступны)
2. Выбрать диапазон дат

### Ожидаемый результат:
- Список фильтруется по выбранному периоду
- Отображаются только точки из диапазона

### Проверки:
- [ ] Фильтр работает
- [ ] Результаты корректны

---

## TC-USERPOINTS-017: Поиск точек
**Приоритет**: P3  
**Предусловия**: Есть точки в списке

### Шаги:
1. Найти поле поиска
2. Ввести название или адрес
3. Проверить результаты

### Ожидаемый результат:
- Список фильтруется по запросу
- Совпадения выделяются
- Поиск работает в реальном времени

### Проверки:
- [ ] Поиск работает
- [ ] Результаты релевантны

---

## TC-USERPOINTS-018: Экспорт точек в GPX
**Приоритет**: P3  
**Предусловия**: Есть точки для экспорта

### Шаги:
1. Найти кнопку "Экспорт"
2. Выбрать формат "GPX"
3. Скачать файл

### Ожидаемый результат:
- GPX файл генерируется
- Содержит все точки с координатами
- Скачивание начинается
- Файл валиден (можно открыть в других приложениях)

### Проверки:
- [ ] Экспорт работает
- [ ] Файл корректен
- [ ] GPX валиден

---

## TC-USERPOINTS-019: Экспорт точек в KML
**Приоритет**: P3  
**Предусловия**: Есть точки для экспорта

### Шаги:
1. Выбрать "Экспорт в KML"
2. Скачать файл

### Ожидаемый результат:
- KML файл генерируется
- Можно открыть в Google Earth

### Проверки:
- [ ] Экспорт работает
- [ ] KML валиден

---

## TC-USERPOINTS-020: Отображение точек на карте (overview)
**Приоритет**: P2  
**Предусловия**: Есть точки в списке

### Шаги:
1. Найти кнопку "Показать все на карте"
2. Кликнуть

### Ожидаемый результат:
- Открывается карта со всеми точками
- Маркеры отображаются
- Можно кликнуть на маркер для деталей
- Карта автоматически масштабируется (fit bounds)

### Проверки:
- [ ] Карта отображается
- [ ] Все точки видны
- [ ] Масштаб корректен

---

## TC-USERPOINTS-021: Сортировка точек
**Приоритет**: P3  
**Предусловия**: Есть несколько точек

### Шаги:
1. Выбрать сортировку:
   - По дате добавления
   - По названию
   - По расстоянию от текущей позиции (если геолокация доступна)

### Ожидаемый результат:
- Список пересортируется
- Порядок изменяется соответственно

### Проверки:
- [ ] Сортировка работает
- [ ] Порядок корректен

---

## TC-USERPOINTS-022: Группировка точек
**Приоритет**: P4  
**Предусловия**: Функция группировки доступна

### Шаги:
1. Создать группу точек (например, "Отпуск 2025")
2. Добавить точки в группу

### Ожидаемый результат:
- Группы отображаются
- Точки организованы по группам
- Можно свернуть/развернуть группу

### Проверки:
- [ ] Группировка работает
- [ ] UI понятен

---

## TC-USERPOINTS-023: Мобильная версия страницы
**Приоритет**: P2  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть `/userpoints` на мобильном
2. Проверить адаптивность

### Ожидаемый результат:
- Список адаптирован
- Кнопки доступны
- Swipe gesture для удаления (опционально)
- Модальные окна открываются снизу (bottom sheet)

### Проверки:
- [ ] Layout адаптирован
- [ ] Функционал работает
- [ ] Gestures удобны

---

## TC-USERPOINTS-024: SEO метатеги страницы
**Приоритет**: P3  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /userpoints
2. Проверить метатеги

### Ожидаемый результат:
```html
<title>Мои точки | Metravel</title>
<link rel="canonical" href="https://metravel.by/userpoints" />
<meta name="robots" content="noindex, nofollow" />
```

### Проверки:
- [ ] Title корректен
- [ ] noindex установлен (приватная страница)

---

## TC-USERPOINTS-025: Обработка ошибки загрузки точек
**Приоритет**: P2  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку API
2. Открыть /userpoints

### Ожидаемый результат:
- Отображается сообщение об ошибке
- Кнопка "Повторить"
- Приложение не падает

### Проверки:
- [ ] Error handling работает
- [ ] Retry доступен

---

## TC-USERPOINTS-026: Геолокация для определения текущей позиции
**Приоритет**: P3  
**Предусловия**: Браузер поддерживает геолокацию

### Шаги:
1. Разрешить доступ к геолокации
2. Кликнуть "Добавить текущую позицию"

### Ожидаемый результат:
- Текущие координаты определяются
- Автоматически добавляется точка с текущей позицией
- Можно задать название

### Проверки:
- [ ] Геолокация работает
- [ ] Координаты корректны
- [ ] Точка добавляется

---

## TC-USERPOINTS-027: Разрешения доступа к геолокации
**Приоритет**: P3  
**Предусловия**: Первый запрос геолокации

### Шаги:
1. Запросить геолокацию
2. Отклонить разрешение

### Ожидаемый результат:
- Сообщение: "Доступ к геолокации отклонен"
- Предложение ввести координаты вручную
- Функционал не блокируется

### Проверки:
- [ ] Обработка отказа работает
- [ ] Сообщение понятное
- [ ] Альтернатива предложена

---

## TC-USERPOINTS-028: Производительность с большим количеством точек
**Приоритет**: P3  
**Предусловия**: 100+ точек в списке

### Шаги:
1. Импортировать большой файл с точками
2. Проверить производительность списка и карты

### Ожидаемый результат:
- Список рендерится быстро (виртуализация)
- Карта не лагает (кластеризация)
- Scroll плавный
- Поиск/фильтрация быстрые

### Проверки:
- [ ] Производительность приемлема
- [ ] Виртуализация работает
- [ ] Кластеризация на карте

---

## TC-USERPOINTS-029: Accessibility (a11y) страницы
**Приоритет**: P3  
**Предусловия**: Keyboard navigation

### Шаги:
1. Использовать Tab для навигации
2. Управлять списком с клавиатуры

### Ожидаемый результат:
- Все элементы доступны через Tab
- Кнопки активируются Enter/Space
- Screen reader озвучивает содержимое
- ARIA labels присутствуют

### Проверки:
- [ ] Keyboard navigation работает
- [ ] ARIA attributes корректны
- [ ] Screen reader friendly

---

## TC-USERPOINTS-030: Синхронизация между устройствами
**Приоритет**: P4  
**Предусловия**: Пользователь авторизован на нескольких устройствах

### Шаги:
1. Добавить точку на устройстве A
2. Открыть /userpoints на устройстве B

### Ожидаемый результат:
- Точки синхронизируются через API
- При обновлении страницы данные актуальны
- Real-time синхронизация (опционально через WebSocket)

### Проверки:
- [ ] Синхронизация работает
- [ ] Данные актуальны

---

## Покрытие автоматизацией

### Jest unit tests:
- Рендеринг компонента UserPointsScreen
- PointsList компонент
- ImportWizard логика
- Парсинг файлов (GPX, KML)
- Валидация координат

Файлы:
- `__tests__/components/UserPoints/`
- `__tests__/utils/geoParser.test.ts` (если есть)

### Playwright E2E:
- Авторизация и доступ
- Импорт точек
- CRUD операции
- Защита страницы

Существующий:
- `e2e/user-points.spec.ts`

### Связанные файлы:
- `app/(tabs)/userpoints.tsx`
- `src/screens/tabs/UserPointsScreen.tsx`
- `components/UserPoints/PointsList.tsx`
- `components/UserPoints/ImportWizard.tsx`
- `utils/geoParser.ts` (предполагаемый)
