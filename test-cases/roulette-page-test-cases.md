# Тест-кейсы: Страница рулетки (/roulette)

## Общая информация
- **Страница**: Рулетка путешествий
- **URL**: `/roulette`
- **Компонент**: `app/(tabs)/roulette.tsx`
- **Приоритет**: P2 (High)

---

## TC-ROULETTE-001: Загрузка страницы рулетки
**Приоритет**: P2  
**Предусловия**: API доступен

### Шаги:
1. Открыть URL `/roulette`
2. Дождаться загрузки страницы

### Ожидаемый результат:
- Страница загружается без ошибок
- Отображается интерфейс рулетки
- Видны фильтры для настройки предпочтений
- Кнопка "Крутить рулетку" доступна

### Проверки:
- [ ] Страница отображается
- [ ] UI элементы видны
- [ ] Нет ошибок в консоли

---

## TC-ROULETTE-002: Запуск рулетки без фильтров
**Приоритет**: P2  
**Предусловия**: Страница загружена, фильтры не выбраны

### Шаги:
1. Кликнуть на кнопку "Крутить рулетку"
2. Дождаться результата

### Ожидаемый результат:
- Отображается анимация вращения
- После завершения показываются случайные путешествия
- Результатов обычно 3-5 карточек
- Каждая карточка содержит: название, изображение, страну

### Проверки:
- [ ] Анимация работает
- [ ] Результаты отображаются
- [ ] Карточки кликабельны

---

## TC-ROULETTE-003: Применение фильтров перед запуском
**Приоритет**: P2  
**Предусловия**: Страница загружена

### Шаги:
1. Открыть панель фильтров
2. Выбрать параметры:
   - Страна (например, Беларусь)
   - Категория (например, "Природа")
   - Сложность (например, "Легкий")
3. Кликнуть "Крутить рулетку"

### Ожидаемый результат:
- Рулетка учитывает выбранные фильтры
- Результаты соответствуют критериям
- API запрос содержит параметры фильтров

### Проверки:
- [ ] Фильтры применяются
- [ ] Результаты соответствуют
- [ ] API запрос корректен

---

## TC-ROULETTE-004: Отображение результатов рулетки
**Приоритет**: P2  
**Предусловия**: Рулетка запущена и завершена

### Шаги:
1. Запустить рулетку
2. Проверить отображение результатов

### Ожидаемый результат:
Каждая карточка результата содержит:
- Изображение путешествия
- Название
- Страна
- Краткое описание (опционально)
- Кнопка "Подробнее" или ссылка

### Проверки:
- [ ] Карточки отображаются
- [ ] Данные корректны
- [ ] Изображения загружаются

---

## TC-ROULETTE-005: Клик по результату рулетки
**Приоритет**: P2  
**Предусловия**: Результаты отображены

### Шаги:
1. Кликнуть на карточку путешествия в результатах
2. Проверить переход

### Ожидаемый результат:
- Переход на детальную страницу путешествия
- URL: `/travel/[slug]`
- Страница загружается корректно

### Проверки:
- [ ] Переход работает
- [ ] Детальная страница открыта
- [ ] Нет ошибок

---

## TC-ROULETTE-006: Повторный запуск рулетки
**Приоритет**: P2  
**Предусловия**: Результаты уже отображены

### Шаги:
1. Запустить рулетку первый раз
2. Кликнуть "Крутить еще раз"
3. Сравнить результаты

### Ожидаемый результат:
- Предыдущие результаты заменяются новыми
- Новые результаты могут отличаться от предыдущих
- Анимация повторяется

### Проверки:
- [ ] Рулетка запускается повторно
- [ ] Результаты обновляются
- [ ] Нет дубликатов с предыдущим запуском

---

## TC-ROULETTE-007: Очистка фильтров на рулетке
**Приоритет**: P2  
**Предусловия**: Фильтры применены

### Шаги:
1. Применить фильтры
2. Найти кнопку "Очистить все"
3. Кликнуть на кнопку

### Ожидаемый результат:
- Все фильтры сбрасываются
- Счетчик активных фильтров обнуляется
- Можно запустить рулетку без фильтров

### Проверки:
- [ ] Фильтры сброшены
- [ ] UI обновлен
- [ ] Функционал работает

---

## TC-ROULETTE-008: Отображение пустого результата
**Приоритет**: P2  
**Предусловия**: Фильтры слишком строгие, нет подходящих путешествий

### Шаги:
1. Применить очень специфичные фильтры
2. Запустить рулетку

### Ожидаемый результат:
- Отображается сообщение "Не найдено путешествий с такими параметрами"
- Предлагается изменить фильтры
- Есть кнопка "Очистить фильтры"

### Проверки:
- [ ] Empty state отображается
- [ ] Сообщение понятное
- [ ] Кнопка очистки работает

---

## TC-ROULETTE-009: Счетчик активных фильтров
**Приоритет**: P3  
**Предусловия**: Страница загружена

### Шаги:
1. Применить несколько фильтров
2. Проверить счетчик на кнопке фильтров

### Ожидаемый результат:
- На кнопке "Фильтры" отображается бейдж с количеством
- Например: "Фильтры (3)"
- При очистке счетчик обнуляется

### Проверки:
- [ ] Счетчик отображается
- [ ] Количество корректно
- [ ] Обнуляется при сбросе

---

## TC-ROULETTE-010: Анимация вращения рулетки
**Приоритет**: P3  
**Предусловия**: Рулетка запускается

### Шаги:
1. Запустить рулетку
2. Наблюдать анимацию

### Ожидаемый результат:
- Плавная анимация вращения
- Длительность анимации 1-3 секунды
- После анимации плавное появление результатов
- Кнопка "Крутить" недоступна во время анимации

### Проверки:
- [ ] Анимация плавная
- [ ] Timing корректен
- [ ] Кнопка заблокирована во время анимации

---

## TC-ROULETTE-011: Добавление результата в избранное
**Приоритет**: P2  
**Предусловия**: Пользователь авторизован, результаты отображены

### Шаги:
1. Найти иконку "Избранное" на карточке результата
2. Кликнуть на иконку

### Ожидаемый результат:
- Иконка меняет состояние
- API запрос: `PATCH /api/travels/{id}/mark-as-favorite/`
- Toast уведомление об успехе

### Проверки:
- [ ] Иконка изменилась
- [ ] API запрос успешен
- [ ] Feedback пользователю

---

## TC-ROULETTE-012: Попытка добавить в избранное без авторизации
**Приоритет**: P2  
**Предусловия**: Пользователь НЕ авторизован

### Шаги:
1. Кликнуть на иконку "Избранное" в результатах
2. Проверить реакцию

### Ожидаемый результат:
- Модальное окно или редирект на /login
- Сообщение: "Войдите, чтобы добавить в избранное"

### Проверки:
- [ ] Модальное окно/редирект
- [ ] Понятное сообщение

---

## TC-ROULETTE-013: Мобильная версия рулетки
**Приоритет**: P2  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть /roulette на мобильном устройстве
2. Проверить адаптивность

### Ожидаемый результат:
- UI адаптирован под мобильный экран
- Фильтры доступны через модальное окно
- Карточки результатов в одну колонку
- Кнопки достаточно большие

### Проверки:
- [ ] Layout адаптирован
- [ ] Фильтры доступны
- [ ] Touch interactions работают

---

## TC-ROULETTE-014: SEO метатеги страницы рулетки
**Приоритет**: P2  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /roulette
2. Проверить исходный код

### Ожидаемый результат:
```html
<title>Рулетка путешествий | Metravel</title>
<meta name="description" content="Не знаешь, куда поехать? Рулетка поможет выбрать путешествие..." />
<link rel="canonical" href="https://metravel.by/roulette" />
```

### Проверки:
- [ ] Title корректен
- [ ] Description заполнен
- [ ] Canonical правильный

---

## TC-ROULETTE-015: Сохранение состояния фильтров
**Приоритет**: P3  
**Предусловия**: Фильтры применены, запущена рулетка

### Шаги:
1. Применить фильтры
2. Запустить рулетку
3. Перейти на другую страницу
4. Вернуться на /roulette

### Ожидаемый результат:
- Фильтры могут сохраняться в sessionStorage/localStorage
- Или сбрасываются при новом визите
- Поведение должно быть предсказуемым

### Проверки:
- [ ] Поведение определено
- [ ] Нет неожиданных состояний

---

## TC-ROULETTE-016: Обработка ошибки API
**Приоритет**: P2  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку API
2. Запустить рулетку

### Ожидаемый результат:
- Отображается сообщение об ошибке
- Есть кнопка "Повторить"
- Приложение не падает

### Проверки:
- [ ] Error state отображается
- [ ] Retry работает
- [ ] Graceful degradation

---

## TC-ROULETTE-017: Фильтр по странам на рулетке
**Приоритет**: P2  
**Предусловия**: Фильтры доступны

### Шаги:
1. Открыть фильтры
2. Выбрать страну (например, Польша)
3. Запустить рулетку

### Ожидаемый результат:
- Результаты только из выбранной страны
- API запрос содержит: `?countries=[616]`

### Проверки:
- [ ] Фильтр применяется
- [ ] Результаты корректны

---

## TC-ROULETTE-018: Фильтр по категориям на рулетке
**Приоритет**: P2  
**Предусловия**: Фильтры доступны

### Шаги:
1. Открыть фильтры
2. Выбрать категорию (например, "Замки")
3. Запустить рулетку

### Ожидаемый результат:
- Результаты соответствуют категории
- API запрос содержит: `?categories=[id]`

### Проверки:
- [ ] Фильтр работает
- [ ] Результаты релевантны

---

## TC-ROULETTE-019: Множественный выбор в фильтрах
**Приоритет**: P2  
**Предусловия**: Фильтры поддерживают multiple selection

### Шаги:
1. Открыть фильтры
2. Выбрать несколько категорий и стран
3. Запустить рулетку

### Ожидаемый результат:
- Результаты соответствуют любому из выбранных критериев (OR logic)
- API запрос содержит массивы: `?countries=[112,616]&categories=[1,2]`

### Проверки:
- [ ] Множественный выбор работает
- [ ] Логика OR применяется
- [ ] Результаты корректны

---

## TC-ROULETTE-020: Производительность рулетки
**Приоритет**: P3  
**Предусловия**: Lighthouse/Performance tools

### Шаги:
1. Открыть /roulette
2. Запустить Performance audit

### Ожидаемый результат:
- Анимация плавная (60 FPS)
- Нет блокирующих операций
- Время загрузки < 2s

### Проверки:
- [ ] Анимация smooth
- [ ] Нет лагов
- [ ] Performance метрики в норме

---

## TC-ROULETTE-021: Accessibility (a11y) рулетки
**Приоритет**: P3  
**Предусловия**: Keyboard navigation

### Шаги:
1. Открыть /roulette
2. Использовать Tab для навигации
3. Запустить рулетку с клавиатуры (Enter/Space)

### Ожидаемый результат:
- Все элементы доступны через Tab
- Кнопка "Крутить" активируется Enter/Space
- Focus visible
- Screen reader озвучивает результаты

### Проверки:
- [ ] Keyboard navigation работает
- [ ] Focus visible
- [ ] ARIA attributes корректны

---

## TC-ROULETTE-022: Интеграция с аналитикой
**Приоритет**: P3  
**Предусловия**: Аналитика настроена

### Шаги:
1. Запустить рулетку
2. Проверить отправку событий аналитики

### Ожидаемый результат:
События отправляются:
- `roulette_spin` - запуск рулетки
- `roulette_result_click` - клик по результату
- С параметрами фильтров

### Проверки:
- [ ] События отправляются
- [ ] Параметры корректны
- [ ] Нет ошибок в консоли

---

## TC-ROULETTE-023: Шаринг результатов рулетки
**Приоритет**: P4  
**Предусловия**: Функция шаринга доступна

### Шаги:
1. Получить результаты рулетки
2. Найти кнопку "Поделиться"
3. Кликнуть на кнопку

### Ожидаемый результат:
- Открывается модальное окно шаринга
- Доступны варианты: копировать ссылку, соцсети
- Ссылка содержит параметры результатов

### Проверки:
- [ ] Шаринг работает
- [ ] Ссылка корректна
- [ ] Социальные кнопки функциональны

---

## TC-ROULETTE-024: Deep link с результатами
**Приоритет**: P4  
**Предусловия**: URL с ID результатов

### Шаги:
1. Открыть URL с параметрами: `/roulette?results=[1,2,3]`
2. Проверить отображение

### Ожидаемый результат:
- Результаты загружаются из параметров URL
- Отображаются без запуска анимации
- Можно запустить рулетку снова

### Проверки:
- [ ] Результаты из URL отображаются
- [ ] Нет ошибок

---

## TC-ROULETTE-025: Загрузка при медленном интернете
**Приоритет**: P2  
**Предусловия**: Network throttling (Slow 3G)

### Шаги:
1. Включить Slow 3G throttling
2. Запустить рулетку

### Ожидаемый результат:
- Отображается индикатор загрузки
- Timeout не происходит (или адекватный)
- Пользователь видит прогресс

### Проверки:
- [ ] Loading state работает
- [ ] Нет бесконечной загрузки
- [ ] Feedback пользователю

---

## Покрытие автоматизацией

### Jest unit tests:
- Логика рулетки (`useRouletteLogic`)
- Обработка фильтров
- Обработка результатов

### Playwright E2E:
- `e2e/roulette-page.spec.ts`
- Запуск рулетки
- Применение фильтров
- Клик по результатам

### Связанные файлы:
- `app/(tabs)/roulette.tsx`
- `components/roulette/useRoulette.ts`
- `components/roulette/styles.ts`
- `__tests__/components/roulette/`
