# Тест-кейсы: Страница профиля (/profile)

## Общая информация
- **Страница**: Профиль пользователя
- **URL**: `/profile`
- **Компонент**: `app/(tabs)/profile.tsx`
- **Приоритет**: P2 (High)
- **Требует авторизации**: Да

---

## TC-PROFILE-001: Загрузка страницы профиля
**Приоритет**: P2  
**Предусловия**: Пользователь авторизован

### Шаги:
1. Авторизоваться
2. Открыть URL `/profile`
3. Дождаться загрузки

### Ожидаемый результат:
- Страница загружается без ошибок
- API запрос: `GET /api/user/{id}/profile/`
- Отображаются данные профиля:
  - Аватар
  - Имя пользователя
  - Email
  - Дата регистрации
  - Статистика (количество путешествий, просмотров)

### Проверки:
- [ ] Страница отображается
- [ ] Данные загружены
- [ ] Нет ошибок в консоли

---

## TC-PROFILE-002: Попытка доступа без авторизации
**Приоритет**: P1  
**Предусловия**: Пользователь НЕ авторизован

### Шаги:
1. Открыть `/profile` без авторизации

### Ожидаемый результат:
- Редирект на `/login?redirect=/profile`
- Или сообщение: "Войдите, чтобы просмотреть профиль"

### Проверки:
- [ ] Защита работает
- [ ] Редирект корректен

---

## TC-PROFILE-003: Просмотр чужого профиля
**Приоритет**: P3  
**Предусловия**: URL с ID другого пользователя

### Шаги:
1. Открыть `/user/{other_user_id}/profile`
2. Проверить отображение

### Ожидаемый результат:
- Отображается публичная информация пользователя
- Видны путешествия пользователя
- Редактирование недоступно

### Проверки:
- [ ] Публичный профиль виден
- [ ] Кнопки редактирования скрыты

---

## TC-PROFILE-004: Редактирование имени пользователя
**Приоритет**: P2  
**Предусловия**: Страница профиля открыта

### Шаги:
1. Найти поле "Имя пользователя"
2. Кликнуть на кнопку "Редактировать" или иконку карандаша
3. Изменить имя: `NewUsername`
4. Сохранить

### Ожидаемый результат:
- API запрос: `PUT /api/user/{id}/profile/update/`
- Имя обновляется
- Toast: "Профиль обновлен"
- Изменения видны без перезагрузки

### Проверки:
- [ ] Редактирование работает
- [ ] API запрос успешен
- [ ] UI обновляется

---

## TC-PROFILE-005: Валидация имени пользователя
**Приоритет**: P2  
**Предусловия**: Режим редактирования

### Шаги:
1. Попытаться ввести пустое имя
2. Попытаться ввести слишком короткое (< 3 символов)
3. Попытаться ввести с недопустимыми символами

### Ожидаемый результат:
- Отображаются ошибки валидации:
  - "Имя обязательно"
  - "Минимум 3 символа"
  - "Только буквы, цифры, _ и -"
- Сохранение недоступно

### Проверки:
- [ ] Валидация работает
- [ ] Сообщения понятны

---

## TC-PROFILE-006: Загрузка аватара
**Приоритет**: P2  
**Предусловия**: Страница профиля открыта

### Шаги:
1. Кликнуть на аватар или кнопку "Изменить аватар"
2. Выбрать изображение (JPG/PNG, < 5MB)
3. Загрузить

### Ожидаемый результат:
- API запрос: `PUT /api/user/{id}/profile/avatar-upload/`
- Аватар обновляется
- Превью показывается сразу
- Toast: "Аватар обновлен"

### Проверки:
- [ ] Загрузка работает
- [ ] Аватар отображается
- [ ] API запрос успешен

---

## TC-PROFILE-007: Валидация загрузки аватара
**Приоритет**: P2  
**Предусловия**: Попытка загрузки

### Шаги:
1. Попытаться загрузить файл > 5MB
2. Попытаться загрузить не изображение (TXT, PDF)
3. Попытаться загрузить неподдерживаемый формат (BMP)

### Ожидаемый результат:
- Ошибки валидации:
  - "Файл слишком большой (макс. 5MB)"
  - "Разрешены только изображения"
  - "Поддерживаются только JPG, PNG, WebP"

### Проверки:
- [ ] Валидация работает
- [ ] Загрузка блокируется

---

## TC-PROFILE-008: Удаление аватара
**Приоритет**: P3  
**Предусловия**: Аватар установлен

### Шаги:
1. Найти кнопку "Удалить аватар"
2. Кликнуть
3. Подтвердить

### Ожидаемый результат:
- Аватар заменяется на дефолтный (инициалы или иконка)
- API запрос на удаление

### Проверки:
- [ ] Удаление работает
- [ ] Дефолтный аватар отображается

---

## TC-PROFILE-009: Изменение email
**Приоритет**: P2  
**Предусловия**: Режим редактирования

### Шаги:
1. Изменить email на новый
2. Сохранить

### Ожидаемый результат:
- Может потребоваться подтверждение нового email
- Письмо отправлено на новый адрес
- Email обновляется после подтверждения

### Проверки:
- [ ] Изменение работает
- [ ] Подтверждение требуется

---

## TC-PROFILE-010: Изменение пароля
**Приоритет**: P1  
**Предусловия**: Страница профиля или настроек

### Шаги:
1. Найти раздел "Изменить пароль"
2. Ввести текущий пароль
3. Ввести новый пароль
4. Подтвердить новый пароль
5. Сохранить

### Ожидаемый результат:
- API запрос на изменение пароля
- Toast: "Пароль успешно изменен"
- Сессия остается активной (не требуется повторный вход)

### Проверки:
- [ ] Изменение работает
- [ ] Сессия сохранена
- [ ] Валидация паролей

---

## TC-PROFILE-011: Неверный текущий пароль при изменении
**Приоритет**: P1  
**Предусловия**: Попытка изменить пароль

### Шаги:
1. Ввести неверный текущий пароль
2. Ввести новый пароль
3. Попытаться сохранить

### Ожидаемый результат:
- API возвращает ошибку
- Отображается: "Неверный текущий пароль"
- Пароль не изменяется

### Проверки:
- [ ] Валидация работает
- [ ] Сообщение понятное

---

## TC-PROFILE-012: Статистика профиля
**Приоритет**: P3  
**Предусловия**: Пользователь имеет активность

### Шаги:
1. Проверить блок статистики

### Ожидаемый результат:
Отображается:
- Количество созданных путешествий
- Количество просмотров путешествий
- Количество избранных
- Дата регистрации

### Проверки:
- [ ] Статистика отображается
- [ ] Данные корректны

---

## TC-PROFILE-013: Список путешествий пользователя
**Приоритет**: P2  
**Предусловия**: Пользователь создал путешествия

### Шаги:
1. Прокрутить до раздела "Мои путешествия"
2. Проверить список

### Ожидаемый результат:
- Отображаются путешествия пользователя
- Можно кликнуть для редактирования
- Статусы: Опубликовано/На модерации/Черновик

### Проверки:
- [ ] Список отображается
- [ ] Статусы видны
- [ ] Редактирование доступно

---

## TC-PROFILE-014: Удаление своего путешествия
**Приоритет**: P2  
**Предусловия**: Есть созданные путешествия

### Шаги:
1. Найти путешествие в списке
2. Кликнуть "Удалить"
3. Подтвердить действие

### Ожидаемый результат:
- Модальное окно подтверждения
- Путешествие удаляется
- Toast: "Путешествие удалено"
- Список обновляется

### Проверки:
- [ ] Подтверждение запрашивается
- [ ] Удаление работает

---

## TC-PROFILE-015: Настройки приватности
**Приоритет**: P3  
**Предусловия**: Настройки доступны

### Шаги:
1. Найти раздел "Приватность"
2. Изменить настройки:
   - Показывать профиль публично
   - Показывать email
   - Разрешить комментарии

### Ожидаемый результат:
- Настройки сохраняются
- Влияют на публичный профиль

### Проверки:
- [ ] Настройки работают
- [ ] Изменения применяются

---

## TC-PROFILE-016: Выход из аккаунта
**Приоритет**: P1  
**Предусловия**: Пользователь авторизован

### Шаги:
1. Найти кнопку "Выйти"
2. Кликнуть

### Ожидаемый результат:
- API запрос: `POST /api/user/logout/`
- Токен удаляется
- Редирект на главную страницу
- UI обновляется (гость)

### Проверки:
- [ ] Выход работает
- [ ] Токен удален
- [ ] Редирект корректен

---

## TC-PROFILE-017: Удаление аккаунта
**Приоритет**: P3  
**Предусловия**: Функция удаления доступна

### Шаги:
1. Найти "Удалить аккаунт"
2. Кликнуть
3. Подтвердить с вводом пароля

### Ожидаемый результат:
- Серьезное предупреждение
- Требование ввести пароль
- Аккаунт и данные удаляются
- Выход из системы

### Проверки:
- [ ] Подтверждение строгое
- [ ] Удаление работает
- [ ] Данные удалены

---

## TC-PROFILE-018: Мобильная версия профиля
**Приоритет**: P2  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть /profile на мобильном
2. Проверить адаптивность

### Ожидаемый результат:
- Аватар и данные адаптированы
- Формы редактирования удобны
- Кнопки доступны

### Проверки:
- [ ] Layout адаптирован
- [ ] Функционал работает

---

## TC-PROFILE-019: SEO метатеги страницы профиля
**Приоритет**: P3  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /profile
2. Проверить метатеги

### Ожидаемый результат:
```html
<title>Профиль | Metravel</title>
<link rel="canonical" href="https://metravel.by/profile" />
<meta name="robots" content="noindex, nofollow" />
```

### Проверки:
- [ ] Title корректен
- [ ] noindex установлен

---

## TC-PROFILE-020: Обработка ошибки загрузки профиля
**Приоритет**: P2  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку API
2. Открыть /profile

### Ожидаемый результат:
- Отображается сообщение об ошибке
- Кнопка "Повторить"
- Приложение не падает

### Проверки:
- [ ] Error handling работает
- [ ] Retry доступен

---

## TC-PROFILE-021: Accessibility (a11y) профиля
**Приоритет**: P3  
**Предусловия**: Keyboard navigation

### Шаги:
1. Использовать Tab для навигации
2. Редактировать поля через клавиатуру

### Ожидаемый результат:
- Все элементы доступны через Tab
- Формы заполняются с клавиатуры
- Screen reader озвучивает содержимое

### Проверки:
- [ ] Keyboard navigation работает
- [ ] ARIA labels присутствуют

---

## TC-PROFILE-022: Редактирование биографии
**Приоритет**: P3  
**Предусловия**: Поле биографии доступно

### Шаги:
1. Найти поле "О себе" или "Биография"
2. Ввести текст (макс. 500 символов)
3. Сохранить

### Ожидаемый результат:
- Текст сохраняется
- Отображается на публичном профиле
- Счетчик символов работает

### Проверки:
- [ ] Редактирование работает
- [ ] Лимит символов проверяется

---

## TC-PROFILE-023: Смена языка интерфейса
**Приоритет**: P4  
**Предусловия**: Мультиязычность поддерживается

### Шаги:
1. Найти настройку языка
2. Изменить на другой язык (EN/RU/BY)
3. Сохранить

### Ожидаемый результат:
- Интерфейс переключается на выбранный язык
- Настройка сохраняется

### Проверки:
- [ ] Переключение работает
- [ ] Язык сохраняется

---

## TC-PROFILE-024: Настройка уведомлений
**Приоритет**: P3  
**Предусловия**: Уведомления поддерживаются

### Шаги:
1. Найти раздел "Уведомления"
2. Изменить настройки:
   - Email уведомления
   - Push уведомления
   - Типы уведомлений

### Ожидаемый результат:
- Настройки сохраняются
- Влияют на получаемые уведомления

### Проверки:
- [ ] Настройки работают
- [ ] Изменения применяются

---

## TC-PROFILE-025: История просмотров
**Приоритет**: P3  
**Предусловия**: Пользователь просматривал путешествия

### Шаги:
1. Открыть раздел "История" или `/history`
2. Проверить список

### Ожидаемый результат:
- API запрос: `GET /api/user/{id}/history/`
- Отображаются недавно просмотренные путешествия
- Можно очистить историю

### Проверки:
- [ ] История отображается
- [ ] Очистка работает

---

## Покрытие автоматизацией

### Jest unit tests:
- Логика обновления профиля
- Валидация полей
- Обработка ошибок

### Playwright E2E:
- `e2e/profile-page.spec.ts`
- Редактирование профиля
- Загрузка аватара
- Изменение пароля

### Связанные файлы:
- `app/(tabs)/profile.tsx`
- `app/(tabs)/settings.tsx`
- `stores/userStore.ts`
- `api/user.ts`
- `__tests__/stores/userStore.test.ts`
