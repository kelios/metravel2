# Тест-кейсы: Страница регистрации (/registration)

## Общая информация
- **Страница**: Регистрация нового пользователя
- **URL**: `/registration` (также доступна как `/register`)
- **Компонент**: `app/(tabs)/registration.tsx`
- **Приоритет**: P1 (Critical)

---

## TC-REG-001: Загрузка страницы регистрации
**Приоритет**: P1  
**Предусловия**: Пользователь не авторизован

### Шаги:
1. Открыть URL `/registration`
2. Дождаться загрузки страницы

### Ожидаемый результат:
- Страница загружается без ошибок
- Видна форма регистрации с полями:
  - Имя пользователя
  - Email
  - Пароль
  - Подтверждение пароля
- Кнопка "Зарегистрироваться"
- Ссылка "Уже есть аккаунт? Войти"

### Проверки:
- [ ] Страница отображается
- [ ] Все поля видны
- [ ] Нет ошибок в консоли

---

## TC-REG-002: Успешная регистрация с корректными данными
**Приоритет**: P1  
**Предусловия**: Email не зарегистрирован

### Шаги:
1. Ввести имя: `TestUser`
2. Ввести email: `newuser@example.com`
3. Ввести пароль: `SecurePass123!`
4. Подтвердить пароль: `SecurePass123!`
5. Кликнуть "Зарегистрироваться"

### Ожидаемый результат:
- API запрос: `POST /api/user/registration/`
- Успешный ответ
- Редирект на `/accountconfirmation` или автоматический вход
- Toast уведомление: "Регистрация успешна"
- Email с подтверждением отправлен (опционально)

### Проверки:
- [ ] Регистрация выполнена
- [ ] Редирект произошел
- [ ] Пользователь создан в системе

---

## TC-REG-003: Регистрация с существующим email
**Приоритет**: P1  
**Предусловия**: Email уже зарегистрирован

### Шаги:
1. Ввести существующий email: `existing@example.com`
2. Заполнить остальные поля
3. Кликнуть "Зарегистрироваться"

### Ожидаемый результат:
- API возвращает ошибку 400
- Отображается: "Пользователь с таким email уже существует"
- Поле email выделено красным
- Регистрация не выполнена

### Проверки:
- [ ] Ошибка отображается
- [ ] Сообщение понятное
- [ ] Пользователь не создан

---

## TC-REG-004: Валидация пустого имени пользователя
**Приоритет**: P1  
**Предусловия**: Форма открыта

### Шаги:
1. Оставить поле "Имя" пустым
2. Заполнить остальные поля
3. Кликнуть "Зарегистрироваться"

### Ожидаемый результат:
- Отображается: "Имя пользователя обязательно"
- Поле выделено красным
- API запрос не отправляется

### Проверки:
- [ ] Валидация работает
- [ ] Сообщение видно

---

## TC-REG-005: Валидация пустого email
**Приоритет**: P1  
**Предусловия**: Форма открыта

### Шаги:
1. Оставить поле email пустым
2. Заполнить остальные поля
3. Кликнуть "Зарегистрироваться"

### Ожидаемый результат:
- Отображается: "Email обязателен"
- API запрос не отправляется

### Проверки:
- [ ] Валидация работает
- [ ] Запрос не отправлен

---

## TC-REG-006: Валидация формата email
**Приоритет**: P2  
**Предусловия**: Форма открыта

### Шаги:
1. Ввести невалидный email: `not-valid-email`
2. Заполнить остальные поля
3. Попытаться отправить форму

### Ожидаемый результат:
- Отображается: "Введите корректный email"
- Форма не отправляется

### Проверки:
- [ ] Валидация формата работает
- [ ] Сообщение понятное

---

## TC-REG-007: Валидация минимальной длины пароля
**Приоритет**: P1  
**Предусловия**: Установлено требование мин. длины (например, 8 символов)

### Шаги:
1. Ввести короткий пароль: `Pass1`
2. Заполнить остальные поля
3. Попытаться отправить

### Ожидаемый результат:
- Отображается: "Пароль должен содержать минимум 8 символов"
- Форма не отправляется

### Проверки:
- [ ] Валидация длины работает
- [ ] Сообщение корректное

---

## TC-REG-008: Валидация сложности пароля
**Приоритет**: P2  
**Предусловия**: Требования к сложности пароля установлены

### Шаги:
1. Ввести простой пароль: `password`
2. Заполнить остальные поля
3. Попытаться отправить

### Ожидаемый результат:
- Отображается: "Пароль должен содержать буквы, цифры и спецсимволы"
- Индикатор сложности показывает "Слабый"
- Форма может не отправиться

### Проверки:
- [ ] Валидация сложности работает
- [ ] Индикатор отображается

---

## TC-REG-009: Несовпадение паролей
**Приоритет**: P1  
**Предусловия**: Форма открыта

### Шаги:
1. Ввести пароль: `SecurePass123!`
2. Ввести подтверждение: `DifferentPass123!`
3. Попытаться отправить

### Ожидаемый результат:
- Отображается: "Пароли не совпадают"
- Поле "Подтверждение пароля" выделено красным
- Форма не отправляется

### Проверки:
- [ ] Валидация работает
- [ ] Сообщение понятное
- [ ] Регистрация не выполнена

---

## TC-REG-010: Показать/скрыть пароль
**Приоритет**: P3  
**Предусловия**: Поле пароля содержит текст

### Шаги:
1. Ввести пароль
2. Кликнуть на иконку "глаз" у поля пароля
3. Кликнуть еще раз

### Ожидаемый результат:
- Пароль показывается открытым текстом
- При повторном клике скрывается
- Работает для обоих полей (пароль и подтверждение)

### Проверки:
- [ ] Функция работает
- [ ] Иконка меняется

---

## TC-REG-011: Индикатор надежности пароля
**Приоритет**: P3  
**Предусловия**: Индикатор реализован

### Шаги:
1. Ввести слабый пароль: `pass`
2. Ввести средний: `Password1`
3. Ввести сильный: `SecureP@ss123!`

### Ожидаемый результат:
- Индикатор меняется: Слабый → Средний → Сильный
- Цвета: красный → желтый → зеленый
- Подсказки отображаются

### Проверки:
- [ ] Индикатор работает
- [ ] Цвета корректны
- [ ] Подсказки понятны

---

## TC-REG-012: Переход на страницу входа
**Приоритет**: P2  
**Предусловия**: Страница регистрации открыта

### Шаги:
1. Найти ссылку "Уже есть аккаунт? Войти"
2. Кликнуть на ссылку

### Ожидаемый результат:
- Переход на `/login`
- Страница входа загружается

### Проверки:
- [ ] Переход работает
- [ ] Страница логина открыта

---

## TC-REG-013: Согласие с условиями использования
**Приоритет**: P2  
**Предусловия**: Чекбокс согласия присутствует

### Шаги:
1. Заполнить все поля
2. НЕ ставить галочку "Я согласен с условиями"
3. Попытаться зарегистрироваться

### Ожидаемый результат:
- Отображается: "Необходимо согласие с условиями"
- Регистрация не выполнена

### Проверки:
- [ ] Валидация работает
- [ ] Регистрация заблокирована

---

## TC-REG-014: Ссылка на политику конфиденциальности
**Приоритет**: P3  
**Предусловия**: Ссылка присутствует в форме

### Шаги:
1. Найти ссылку на "Политику конфиденциальности"
2. Кликнуть на ссылку

### Ожидаемый результат:
- Открывается `/privacy` в новой вкладке или модальном окне
- Содержимое политики отображается

### Проверки:
- [ ] Ссылка работает
- [ ] Политика доступна

---

## TC-REG-015: Подтверждение email после регистрации
**Приоритет**: P2  
**Предусловия**: Email верификация включена

### Шаги:
1. Зарегистрироваться
2. Проверить email
3. Кликнуть на ссылку подтверждения

### Ожидаемый результат:
- Email с подтверждением получен
- Ссылка ведет на `/accountconfirmation`
- API запрос: `POST /api/user/confirm-registration/`
- Аккаунт активируется

### Проверки:
- [ ] Email отправлен
- [ ] Ссылка работает
- [ ] Аккаунт активирован

---

## TC-REG-016: Ввод кода подтверждения
**Приоритет**: P2  
**Предусловия**: Используется код подтверждения

### Шаги:
1. Зарегистрироваться
2. Получить код на email
3. Ввести код на странице подтверждения

### Ожидаемый результат:
- Код принят
- Аккаунт активирован
- Автоматический вход или редирект на /login

### Проверки:
- [ ] Код работает
- [ ] Аккаунт активен

---

## TC-REG-017: Неверный код подтверждения
**Приоритет**: P2  
**Предусловия**: Страница подтверждения

### Шаги:
1. Ввести неверный код: `999999`
2. Отправить

### Ожидаемый результат:
- Отображается: "Неверный код подтверждения"
- Аккаунт не активируется
- Можно попробовать снова

### Проверки:
- [ ] Ошибка отображается
- [ ] Повтор возможен

---

## TC-REG-018: Повторная отправка кода подтверждения
**Приоритет**: P3  
**Предусловия**: Код не получен

### Шаги:
1. На странице подтверждения найти "Отправить код повторно"
2. Кликнуть на ссылку
3. Дождаться таймера

### Ожидаемый результат:
- Новый код отправлен
- Таймер 60 секунд перед повторной отправкой
- Toast: "Код отправлен повторно"

### Проверки:
- [ ] Повторная отправка работает
- [ ] Таймер функционирует

---

## TC-REG-019: Мобильная версия регистрации
**Приоритет**: P1  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть /registration на мобильном
2. Проверить адаптивность

### Ожидаемый результат:
- Форма адаптирована
- Поля достаточно большие
- Клавиатура не перекрывает кнопки
- Все элементы доступны

### Проверки:
- [ ] Layout адаптирован
- [ ] Поля удобны
- [ ] Keyboard handling корректен

---

## TC-REG-020: SEO и canonical для регистрации
**Приоритет**: P2  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /registration
2. Проверить метатеги

### Ожидаемый результат:
```html
<title>Регистрация | Metravel</title>
<link rel="canonical" href="https://metravel.by/registration" />
<meta name="robots" content="noindex, nofollow" />
```

### Проверки:
- [ ] Title корректен
- [ ] Canonical правильный
- [ ] noindex установлен

---

## TC-REG-021: Автозаполнение и автокомплит
**Приоритет**: P3  
**Предусловия**: Браузер поддерживает автозаполнение

### Шаги:
1. Открыть форму
2. Проверить атрибуты autocomplete

### Ожидаемый результат:
- `autocomplete="username"` для имени
- `autocomplete="email"` для email
- `autocomplete="new-password"` для пароля
- Браузер предлагает сгенерировать пароль

### Проверки:
- [ ] Атрибуты правильные
- [ ] Браузер предлагает генерацию пароля

---

## TC-REG-022: Обработка ошибки сети
**Приоритет**: P1  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку сети
2. Попытаться зарегистрироваться

### Ожидаемый результат:
- Отображается: "Ошибка соединения"
- Кнопка "Повторить"
- Данные формы сохраняются

### Проверки:
- [ ] Error handling работает
- [ ] Retry доступен
- [ ] Данные не теряются

---

## TC-REG-023: Валидация на стороне клиента
**Приоритет**: P2  
**Предусловия**: Client-side валидация реализована

### Шаги:
1. Заполнить форму с ошибками
2. Проверить, что валидация срабатывает до отправки

### Ожидаемый результат:
- Валидация происходит onBlur или onSubmit
- API запрос отправляется только при валидных данных
- Экономия ресурсов сервера

### Проверки:
- [ ] Client-side валидация работает
- [ ] Нет лишних API запросов

---

## TC-REG-024: Accessibility (a11y) формы
**Приоритет**: P2  
**Предусловия**: Keyboard navigation

### Шаги:
1. Использовать Tab для навигации
2. Заполнить форму и отправить через Enter

### Ожидаемый результат:
- Все поля доступны через Tab
- Labels связаны с inputs
- Ошибки озвучиваются screen reader
- Порядок фокуса логичен

### Проверки:
- [ ] Keyboard navigation работает
- [ ] ARIA attributes присутствуют
- [ ] Screen reader friendly

---

## TC-REG-025: Редирект с /register на /registration
**Приоритет**: P2  
**Предусловия**: URL alias настроен

### Шаги:
1. Открыть URL `/register`
2. Проверить редирект

### Ожидаемый результат:
- Автоматический редирект на `/registration`
- URL в адресной строке обновляется
- Canonical указывает на `/registration`

### Проверки:
- [ ] Редирект работает
- [ ] URL корректен
- [ ] 301 redirect (постоянный)

---

## Покрытие автоматизацией

### Jest unit tests:
- Валидация формы
- Проверка совпадения паролей
- Индикатор сложности пароля

### Playwright E2E:
- `e2e/auth-registration.spec.ts`
- Полный flow регистрации
- Ошибки валидации
- Подтверждение email

### Связанные файлы:
- `app/(tabs)/registration.tsx`
- `app/register.tsx` (redirect)
- `components/auth/RegistrationForm.tsx`
- `__tests__/components/auth/`
