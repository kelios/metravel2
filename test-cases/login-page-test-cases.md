# Тест-кейсы: Страница авторизации (/login)

## Общая информация
- **Страница**: Вход в систему
- **URL**: `/login`
- **Компонент**: `app/(tabs)/login.tsx`
- **Приоритет**: P1 (Critical)

---

## TC-LOGIN-001: Загрузка страницы входа
**Приоритет**: P1  
**Предусловия**: Пользователь не авторизован

### Шаги:
1. Открыть URL `/login`
2. Дождаться загрузки страницы

### Ожидаемый результат:
- Страница загружается без ошибок
- Видна форма входа с полями:
  - Email
  - Пароль
- Кнопка "Войти"
- Ссылка "Забыли пароль?"
- Ссылка "Зарегистрируйтесь"

### Проверки:
- [ ] Страница отображается
- [ ] Все элементы видны
- [ ] Нет ошибок в консоли

---

## TC-LOGIN-002: Успешный вход с корректными данными
**Приоритет**: P1  
**Предусловия**: Зарегистрированный пользователь

### Шаги:
1. Ввести email: `user@example.com`
2. Ввести пароль: `correct_password`
3. Кликнуть "Войти"

### Ожидаемый результат:
- API запрос: `POST /api/user/login/`
- Получен токен и данные пользователя
- Редирект на главную страницу или предыдущую
- Токен сохранен в localStorage/cookies
- Toast уведомление: "Вы успешно вошли"

### Проверки:
- [ ] Вход выполнен
- [ ] Токен сохранен
- [ ] Редирект произошел
- [ ] UI обновлен (видна иконка профиля)

---

## TC-LOGIN-003: Вход с неверным паролем
**Приоритет**: P1  
**Предусловия**: Пользователь существует

### Шаги:
1. Ввести email: `user@example.com`
2. Ввести пароль: `wrong_password`
3. Кликнуть "Войти"

### Ожидаемый результат:
- API возвращает ошибку 401
- Отображается сообщение: "Неверный email или пароль"
- Поля формы не очищаются
- Пользователь остается на странице логина

### Проверки:
- [ ] Ошибка отображается
- [ ] Сообщение понятное
- [ ] Вход не выполнен

---

## TC-LOGIN-004: Вход с несуществующим email
**Приоритет**: P1  
**Предусловия**: Email не зарегистрирован

### Шаги:
1. Ввести email: `nonexistent@example.com`
2. Ввести пароль: `any_password`
3. Кликнуть "Войти"

### Ожидаемый результат:
- API возвращает ошибку
- Отображается: "Пользователь не найден" или "Неверный email или пароль"
- Вход не выполнен

### Проверки:
- [ ] Ошибка отображается
- [ ] Сообщение корректное

---

## TC-LOGIN-005: Валидация пустого email
**Приоритет**: P1  
**Предусловия**: Форма открыта

### Шаги:
1. Оставить поле email пустым
2. Ввести пароль
3. Кликнуть "Войти"

### Ожидаемый результат:
- Отображается сообщение валидации: "Email обязателен"
- Поле email выделено красным
- API запрос не отправляется

### Проверки:
- [ ] Валидация работает
- [ ] Сообщение видно
- [ ] Запрос не отправлен

---

## TC-LOGIN-006: Валидация пустого пароля
**Приоритет**: P1  
**Предусловия**: Форма открыта

### Шаги:
1. Ввести email
2. Оставить поле пароля пустым
3. Кликнуть "Войти"

### Ожидаемый результат:
- Отображается: "Пароль обязателен"
- Поле пароля выделено красным
- API запрос не отправляется

### Проверки:
- [ ] Валидация работает
- [ ] Сообщение видно

---

## TC-LOGIN-007: Валидация формата email
**Приоритет**: P2  
**Предусловия**: Форма открыта

### Шаги:
1. Ввести невалидный email: `not-an-email`
2. Ввести пароль
3. Кликнуть "Войти" или покинуть поле (blur)

### Ожидаемый результат:
- Отображается: "Введите корректный email"
- API запрос не отправляется

### Проверки:
- [ ] Валидация email формата работает
- [ ] Сообщение понятное

---

## TC-LOGIN-008: Переход на страницу регистрации
**Приоритет**: P1  
**Предусловия**: Страница логина открыта

### Шаги:
1. Найти ссылку "Зарегистрируйтесь"
2. Кликнуть на ссылку

### Ожидаемый результат:
- Переход на `/registration`
- Страница регистрации загружается
- Cookie баннер не блокирует ссылку (fix applied)

### Проверки:
- [ ] Переход работает
- [ ] Страница регистрации открыта
- [ ] Нет блокировки баннером

---

## TC-LOGIN-009: Переход на восстановление пароля
**Приоритет**: P2  
**Предусловия**: Страница логина открыта

### Шаги:
1. Найти ссылку "Забыли пароль?"
2. Кликнуть на ссылку

### Ожидаемый результат:
- Переход на `/set-password` или модальное окно
- Форма восстановления пароля отображается

### Проверки:
- [ ] Переход работает
- [ ] Форма восстановления доступна

---

## TC-LOGIN-010: Показать/скрыть пароль
**Приоритет**: P3  
**Предусловия**: Поле пароля содержит текст

### Шаги:
1. Ввести пароль (отображается как •••)
2. Кликнуть на иконку "глаз" (показать пароль)
3. Кликнуть еще раз (скрыть пароль)

### Ожидаемый результат:
- При клике пароль отображается открытым текстом
- При повторном клике скрывается снова
- Иконка меняется

### Проверки:
- [ ] Функция работает
- [ ] Иконка меняется
- [ ] Пароль показывается/скрывается

---

## TC-LOGIN-011: Защита от многократных попыток входа
**Приоритет**: P2  
**Предусловия**: 5+ неудачных попыток входа

### Шаги:
1. Ввести неверные данные 5 раз подряд
2. Попытаться войти снова

### Ожидаемый результат:
- После N попыток появляется captcha или задержка
- Или сообщение: "Слишком много попыток, попробуйте позже"
- Временная блокировка (rate limiting)

### Проверки:
- [ ] Защита работает
- [ ] Сообщение понятное
- [ ] Блокировка временная

---

## TC-LOGIN-012: Вход после регистрации
**Приоритет**: P2  
**Предусловия**: Пользователь только что зарегистрировался

### Шаги:
1. Завершить регистрацию
2. Перейти на /login
3. Ввести только что созданные данные

### Ожидаемый результат:
- Вход успешен
- Пользователь автоматически авторизован
- (Опционально) Автоматический логин после регистрации

### Проверки:
- [ ] Вход работает
- [ ] Новый аккаунт активен

---

## TC-LOGIN-013: Автозаполнение полей (browser autofill)
**Приоритет**: P3  
**Предусловия**: Браузер имеет сохраненные данные

### Шаги:
1. Открыть /login
2. Проверить автозаполнение

### Ожидаемый результат:
- Браузер предлагает сохраненные логины
- Поля корректно заполняются
- `autocomplete` атрибуты настроены

### Проверки:
- [ ] Autofill работает
- [ ] Атрибуты `autocomplete="email"` и `autocomplete="current-password"`

---

## TC-LOGIN-014: Сохранение пароля в браузере
**Приоритет**: P3  
**Предусловия**: Успешный вход

### Шаги:
1. Ввести данные
2. Войти
3. Проверить предложение браузера сохранить пароль

### Ожидаемый результат:
- Браузер предлагает сохранить пароль
- После сохранения пароль доступен для автозаполнения

### Проверки:
- [ ] Браузер предлагает сохранение
- [ ] Сохранение работает

---

## TC-LOGIN-015: Редирект на целевую страницу после входа
**Приоритет**: P2  
**Предусловия**: Пользователь пытался попасть на защищенную страницу

### Шаги:
1. Попытаться открыть `/favorites` без авторизации
2. Редирект на `/login?redirect=/favorites`
3. Войти в систему

### Ожидаемый результат:
- После входа автоматический редирект на `/favorites`
- Параметр `redirect` обработан корректно

### Проверки:
- [ ] Редирект работает
- [ ] Целевая страница открыта

---

## TC-LOGIN-016: Мобильная версия страницы логина
**Приоритет**: P1  
**Предусловия**: Мобильный viewport

### Шаги:
1. Открыть /login на мобильном устройстве
2. Проверить адаптивность

### Ожидаемый результат:
- Форма адаптирована под мобильный экран
- Поля ввода достаточно большие
- Кнопки удобные для клика
- Клавиатура не перекрывает поля

### Проверки:
- [ ] Layout адаптирован
- [ ] Поля доступны
- [ ] Keyboard не блокирует UI

---

## TC-LOGIN-017: SEO метатеги страницы логина
**Приоритет**: P2  
**Предусловия**: Доступ к исходному коду

### Шаги:
1. Открыть /login
2. Проверить исходный код

### Ожидаемый результат:
```html
<title>Вход | Metravel</title>
<meta name="description" content="Войдите в свой аккаунт" />
<link rel="canonical" href="https://metravel.by/login" />
<meta name="robots" content="noindex, nofollow" />
```

### Проверки:
- [ ] Title корректен
- [ ] Canonical правильный
- [ ] noindex установлен (для приватных страниц)

---

## TC-LOGIN-018: Обработка ошибки сети
**Приоритет**: P1  
**Предусловия**: API недоступен

### Шаги:
1. Имитировать ошибку сети
2. Попытаться войти

### Ожидаемый результат:
- Отображается: "Ошибка соединения. Проверьте интернет"
- Кнопка "Повторить"
- Приложение не падает

### Проверки:
- [ ] Error handling работает
- [ ] Сообщение понятное
- [ ] Retry доступен

---

## TC-LOGIN-019: Accessibility (a11y) формы логина
**Приоритет**: P2  
**Предусловия**: Keyboard navigation

### Шаги:
1. Открыть /login
2. Использовать Tab для навигации
3. Заполнить форму и отправить через Enter

### Ожидаемый результат:
- Все поля доступны через Tab
- Labels связаны с inputs
- Ошибки валидации озвучиваются screen reader
- Form submit через Enter работает

### Проверки:
- [ ] Keyboard navigation работает
- [ ] Labels корректны
- [ ] ARIA attributes присутствуют

---

## TC-LOGIN-020: Сессия остается активной
**Приоритет**: P2  
**Предусловия**: Пользователь вошел

### Шаги:
1. Войти в систему
2. Закрыть браузер
3. Открыть сайт снова

### Ожидаемый результат:
- Пользователь остается авторизованным
- Токен не истек
- Не требуется повторный вход

### Проверки:
- [ ] Сессия сохраняется
- [ ] Токен валиден
- [ ] Auto-login работает

---

## Покрытие автоматизацией

### Jest unit tests:
- Валидация формы
- Обработка ошибок
- Логика авторизации

### Playwright E2E:
- `e2e/auth-login.spec.ts`
- Успешный вход
- Ошибки валидации
- Переходы между страницами

### Связанные файлы:
- `app/(tabs)/login.tsx`
- `components/auth/LoginForm.tsx`
- `stores/authStore.ts`
- `__tests__/components/auth/`
