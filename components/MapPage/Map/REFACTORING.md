# –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Map.web.tsx

## –ü—Ä–æ–±–ª–µ–º–∞
–§–∞–π–ª Map.web.tsx —Å–æ–¥–µ—Ä–∂–∞–ª **1786 —Å—Ç—Ä–æ–∫** –∫–æ–¥–∞, —á—Ç–æ –¥–µ–ª–∞–ª–æ –µ–≥–æ:
- –°–ª–æ–∂–Ω—ã–º –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ú–µ–¥–ª–µ–Ω–Ω—ã–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ IDE
- –ü–æ–¥–≤–µ—Ä–∂–µ–Ω–Ω—ã–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º –ø—Ä–∏ merge
- –¢—Ä—É–¥–Ω—ã–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —á–∞—Å—Ç–µ–π

## –†–µ—à–µ–Ω–∏–µ - –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–§–∞–π–ª —Ä–∞–∑–±–∏—Ç –Ω–∞ **–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏**:

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `/components/MapPage/map/`

```
map/
‚îú‚îÄ‚îÄ types.ts                 # –¢–∏–ø—ã TypeScript
‚îú‚îÄ‚îÄ constants.ts             # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–ø–æ—Ä–æ–≥–∏, –∑—É–º—ã –∏ —Ç.–¥.)
‚îú‚îÄ‚îÄ utils.ts                 # –£—Ç–∏–ª–∏—Ç—ã (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, ID –∏ —Ç.–¥.)
‚îú‚îÄ‚îÄ styles.ts                # –°—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ useLeafletIcons.ts       # –•—É–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–∫–æ–Ω–æ–∫ –º–∞—Ä–∫–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ useMapCleanup.ts         # –•—É–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Leaflet
‚îú‚îÄ‚îÄ TravelMarkers.tsx        # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ ClusterLayer.tsx         # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ Map.web.tsx              # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã (—É–º–µ–Ω—å—à–µ–Ω –¥–æ ~300-400 —Å—Ç—Ä–æ–∫)
```

## –î–µ—Ç–∞–ª–∏ –º–æ–¥—É–ª–µ–π

### 1. `types.ts` (40 —Å—Ç—Ä–æ–∫)
–í—Å–µ TypeScript —Ç–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:
- `Point` - —Ç–æ—á–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
- `Coordinates` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- `MapMode`, `TransportMode` - —Ä–µ–∂–∏–º—ã –∫–∞—Ä—Ç—ã
- `MapProps` - –ø—Ä–æ–ø—Å—ã –≥–ª–∞–≤–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- `ClusterData` - –¥–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä–∞

### 2. `constants.ts` (9 —Å—Ç—Ä–æ–∫)
–í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `CLUSTER_THRESHOLD` - –ø–æ—Ä–æ–≥ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ (25)
- `CLUSTER_EXPAND_ZOOM` - –∑—É–º –∞–≤—Ç–æ-—Ä–∞—Å–∫—Ä—ã—Ç–∏—è (15)
- `DEFAULT_ZOOM` - –∑—É–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (11)
- –∏ –¥—Ä.

### 3. `utils.ts` (27 —Å—Ç—Ä–æ–∫)
–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- `strToLatLng` - –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–∏ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- `buildClusterKey` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
- `getClusterGridForZoom` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- `generateUniqueId` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID

### 4. `styles.ts` (70 —Å—Ç—Ä–æ–∫)
–í—Å–µ —Å—Ç–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∫–∞—Ä—Ç—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

### 5. `useLeafletIcons.ts` (70 —Å—Ç—Ä–æ–∫)
–•—É–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –∏–∫–æ–Ω–æ–∫ Leaflet:
- –û—Ä–∞–Ω–∂–µ–≤–∞—è - –º–µ—Å—Ç–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π
- –ó–µ–ª–µ–Ω–∞—è - —Å—Ç–∞—Ä—Ç –º–∞—Ä—à—Ä—É—Ç–∞
- –ö—Ä–∞—Å–Ω–∞—è - —Ñ–∏–Ω–∏—à –º–∞—Ä—à—Ä—É—Ç–∞
- –°–∏–Ω—è—è - –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 6. `useMapCleanup.ts` (90 —Å—Ç—Ä–æ–∫)
–•—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ Leaflet:
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ "being reused"

### 7. `TravelMarkers.tsx` (80 —Å—Ç—Ä–æ–∫)
–ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤:
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å Canvas Renderer –¥–ª—è >50 –º–∞—Ä–∫–µ—Ä–æ–≤
- –ö–∞—Å—Ç–æ–º–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫

### 8. `ClusterLayer.tsx` (260 —Å—Ç—Ä–æ–∫)
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–æ–≤:
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ç–æ—á–µ–∫ –ø–æ —è—á–µ–π–∫–∞–º —Å–µ—Ç–∫–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö –∏–∫–æ–Ω–æ–∫
- –†–∞—Å–∫—Ä—ã—Ç–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –ø–æ –∫–ª–∏–∫—É
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–æ–∫ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 9. `Map.web.tsx` (–Ω–æ–≤—ã–π, ~400 —Å—Ç—Ä–æ–∫ –≤–º–µ—Å—Ç–æ 1786)
–ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã - —Ç–µ–ø–µ—Ä—å —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞:
- –ó–∞–≥—Ä—É–∑–∫–µ Leaflet –∏ React-Leaflet
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–∞—Ä—Ç—ã
- –ö–æ–º–ø–æ–∑–∏—Ü–∏–∏ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
- –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–¥
- –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–º–ø–æ—Ä—Ç–æ–≤

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –≤ –º–æ–¥—É–ª—è—Ö
- –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ merge
- –ü—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏

### ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- –•—É–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
- –£—Ç–∏–ª–∏—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –¢–∏–ø—ã –µ–¥–∏–Ω—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∫–∞—Ä—Ç—ã

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Tree-shaking —Ä–∞–±–æ—Ç–∞–µ—Ç –ª—É—á—à–µ
- –ú–µ–Ω—å—à–µ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ = –±—ã—Å—Ç—Ä–µ–µ IDE
- Lazy loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–æ—â–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

## –ú–∏–≥—Ä–∞—Ü–∏—è

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
‚úÖ **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - API –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è

### –ò–º–ø–æ—Ä—Ç—ã
```typescript
// –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± - –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
import Map from '@/components/MapPage/Map';

// –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± - –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–æ–¥—É–ª—è–º
import { strToLatLng } from '@/components/MapPage/map/utils';
import { CLUSTER_THRESHOLD } from '@/components/MapPage/map/constants';
import TravelMarkers from '@/components/MapPage/map/TravelMarkers';
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–î–æ–±–∞–≤–∏—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
2. **–°–æ–∑–¥–∞—Ç—å Storybook** –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤
3. **–ò–∑–≤–ª–µ—á—å MapLogic** –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ö—É–∫
4. **–î–æ–±–∞–≤–∏—Ç—å JSDoc** –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
5. **–°–æ–∑–¥–∞—Ç—å —Ö—É–∫ useMapApi** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å MapUiApi

## –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –°—Ç—Ä–æ–∫ –≤ Map.web.tsx | 1786 | ~400 | -78% |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ | 1 | 9 | –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å |
| –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ | 200+ | <100 | —á–∏—Ç–∞–µ–º–æ—Å—Ç—å |
| –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å | –Ω–∏–∑–∫–∞—è | –≤—ã—Å–æ–∫–∞—è | ‚úÖ |

---

**–î–∞—Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 3 —è–Ω–≤–∞—Ä—è 2025
**–ê–≤—Ç–æ—Ä:** GitHub Copilot

