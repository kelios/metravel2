__d(function(g,_r,_i,a,m,_e,d){var e=_r(d[0]);Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;var t=p(_r(d[1])),o=e(_r(d[2])),n=e(_r(d[3])),r=e(_r(d[4])),i=e(_r(d[5])),s=(e(_r(d[6])),p(_r(d[7]))),l=e(_r(d[8])),c=e(_r(d[9])),u=_r(d[10]);function p(e,t){if("function"==typeof WeakMap)var o=new WeakMap,n=new WeakMap;return(p=function(e,t){if(!t&&e&&e.__esModule)return e;var r,i,s={__proto__:null,default:e};if(null===e||"object"!=typeof e&&"function"!=typeof e)return s;if(r=t?n:o){if(r.has(e))return r.get(e);r.set(e,s)}for(const t in e)"default"!==t&&{}.hasOwnProperty.call(e,t)&&((i=(r=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,t))&&(i.get||i.set)?r(s,t,i):s[t]=e[t]);return s})(e,t)}const f=e=>{const[t,o]=e.split(',').map(Number);return Number.isFinite(t)&&Number.isFinite(o)?[o,t]:null},h=({points:e,icon:t,Marker:o,Popup:n,PopupContent:r})=>(0,u.jsx)(u.Fragment,{children:e.map((e,i)=>{const s=f(e.coord);if(!s||!e.coord)return null;const l=e.id?`travel-${e.id}`:`travel-${e.coord.replace(/,/g,'-')}-${i}`;return(0,u.jsx)(o,{position:[s[1],s[0]],icon:t,children:(0,u.jsx)(n,{children:(0,u.jsx)(r,{point:e})})},l)})}),x=t.default.memo(h,(e,t)=>e.points.length===t.points.length&&(e.icon===t.icon&&e.Marker===t.Marker&&e.Popup===t.Popup&&e.PopupContent===t.PopupContent&&e.points.every((e,o)=>{const n=t.points[o];return!!n&&(e.id===n.id&&e.coord===n.coord&&e.address===n.address)}))),b=({travel:e={data:[]},coordinates:r,routePoints:p,setRoutePoints:h,onMapClick:b,mode:j,transportMode:k,setRouteDistance:v,setFullRouteCoords:C,radius:R})=>{const[z,E]=(0,t.useState)(null),[M,S]=(0,t.useState)(null),[P,A]=(0,t.useState)(null),[I,L]=(0,t.useState)({location:!1,loadingModules:!1,routing:!1}),[T,_]=(0,t.useState)(!1),[H,O]=(0,t.useState)(!1),[U,B]=(0,t.useState)(!1),[N,V]=(0,t.useState)(()=>window.matchMedia('(max-width: 768px)').matches);(0,t.useEffect)(()=>{const e=window.matchMedia('(max-width: 768px)'),t=e=>V(e.matches);return e.addEventListener?e.addEventListener('change',t):e.addListener(t),()=>{e.removeEventListener?e.removeEventListener('change',t):e.removeListener(t)}},[]),(0,t.useEffect)(()=>{let e=!1;const t='undefined'!=typeof process&&'test'===process.env?.NODE_ENV,o=()=>{const e='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';if(!document.querySelector(`link[href="${e}"]`)){const t=document.createElement('link');t.rel='stylesheet',t.href=e,document.head.appendChild(t)}},n=async()=>{const e=window;return e.L||(o(),n._loader||(n._loader=new Promise((e,t)=>{const o=document.createElement('script');o.src='https://unpkg.com/leaflet@1.9.4/dist/leaflet.js',o.async=!0,o.onload=()=>e(),o.onerror=e=>{n._loader=null,t(e)},document.body.appendChild(o)})),await n._loader),e.L},r=async()=>{try{const t=await n(),o=await _r(d[12])(d[11],d.paths);e||(E(t),S(o))}catch{e||L(e=>({...e,loadingModules:!0}))}};if(t)r();else{if(!('requestIdleCallback'in window)){const e=setTimeout(r,1200);return()=>clearTimeout(e)}window.requestIdleCallback(r,{timeout:2e3})}return()=>{e=!0}},[]);const W="5b3ce3597851110001cf62482eef0c4cb7aa4f33a455a1e1075a8646",D=e=>{const t=(0,M.useMap)();return(0,u.jsx)(l.default,{map:t,...e})},F=(0,t.useMemo)(()=>{if(!z||'function'!=typeof z.Icon)return{meTravel:void 0,userLocation:void 0,start:void 0,end:void 0};const e=new z.Icon({iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',iconRetinaUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-41],shadowSize:[41,41],shadowAnchor:[12,41],crossOrigin:!0}),t=new z.Icon({iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',iconRetinaUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',iconSize:[30,41],iconAnchor:[15,41],popupAnchor:[0,-41],shadowSize:[41,41],shadowAnchor:[12,41]}),o=new z.Icon({iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',iconRetinaUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',iconSize:[30,41],iconAnchor:[15,41],popupAnchor:[0,-41],shadowSize:[41,41],shadowAnchor:[12,41]});return{meTravel:e,userLocation:new z.Icon({iconUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',iconRetinaUrl:'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',shadowUrl:'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[0,-41],shadowSize:[41,41],shadowAnchor:[12,41]}),start:t,end:o}},[z]);(0,t.useEffect)(()=>{(async()=>{try{_(!0);const{status:e}=await s.requestForegroundPermissionsAsync();if('granted'!==e)throw new globalThis.Error;const t=await s.getCurrentPositionAsync({accuracy:s.Accuracy.BestForNavigation});A({latitude:t.coords.latitude,longitude:t.coords.longitude})}catch{L(e=>({...e,location:!0}))}finally{_(!1)}})()},[]);const q=(0,t.useCallback)(e=>{if('route'!==j||p.length>=2)return;const t=[e.latlng.lng,e.latlng.lat];h([...p,t]),B(!0),b(e.latlng.lng,e.latlng.lat)},[j,p,h,b]),$=(0,t.useMemo)(()=>{if('radius'!==j)return null;const e=parseInt(R||'60',10);return isNaN(e)||e<=0?6e4:1e3*e},[j,R]),Y=(0,t.useRef)(null),Z=(0,t.useRef)(!1),K=(0,t.useRef)(null),X=(0,t.useRef)(null),G=(0,t.useCallback)(()=>{Y.current&&P&&Y.current.setView([P.latitude,P.longitude],13,{animate:!0})},[P]);if((0,t.useEffect)(()=>{'route'===j&&p.length>=1&&(globalThis.lastMarkerClickHandler=e=>{e?.originalEvent?.stopPropagation?.()})},[j,p.length]),T)return(0,u.jsx)(w,{message:"Loading map..."});if(!z||!M)return(0,u.jsx)(w,{message:I.loadingModules?'Loading map modules failed':'Loading map...'});const{MapContainer:J,TileLayer:Q,Marker:ee,Popup:te,Circle:oe,useMap:ne,useMapEvents:re}=M,ie=()=>{const o=ne();re({click:q});const[n,i]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{Y.current=o},[o]),(0,t.useEffect)(()=>{if(!o||'route'!==j)return;const e=()=>{const e=o.getCenter(),t=o.getZoom();X.current={center:[e.lat,e.lng],zoom:t}};return o.on('moveend',e),o.on('zoomend',e),()=>{o.off('moveend',e),o.off('zoomend',e)}},[o,j]),(0,t.useEffect)(()=>{if(o){if('route'===j)return!Z.current&&r.latitude&&r.longitude&&(o.setView([r.latitude,r.longitude],13,{animate:!1}),Z.current=!0),void(K.current=j);'route'===K.current&&'radius'===j&&(Z.current=!1),Z.current||(P?(o.setView([P.latitude,P.longitude],11,{animate:!1}),Z.current=!0):r.latitude&&r.longitude&&(o.setView([r.latitude,r.longitude],11,{animate:!1}),Z.current=!0)),K.current=j}},[o,P,r,j]),(0,t.useEffect)(()=>{if(U||!o)return;if('route'===j)return;if(!z||'function'!=typeof z.latLngBounds||'function'!=typeof z.latLng)return;const t=[];if(e.data&&e.data.length>0){const o=(e.data||[]).map(e=>f(e.coord)).filter(Boolean);t.push(...o)}if(0===t.length&&P&&t.push([P.longitude,P.latitude]),t.length>0){const e=z.latLngBounds(t.map(([e,t])=>z.latLng(t,e)));o.fitBounds(e.pad(.2),{animate:!n}),i(!0)}},[U,j,p,e.data,P,o,n,N]),null};return(0,u.jsxs)(o.default,{style:y.wrapper,children:[P&&(0,u.jsx)("div",{style:{position:'absolute',top:10,right:10,zIndex:1e3},children:(0,u.jsx)("button",{onClick:G,style:{width:'44px',height:'44px',borderRadius:'50%',backgroundColor:'#fff',border:'2px solid rgba(0,0,0,0.2)',boxShadow:'0 2px 8px rgba(0,0,0,0.15)',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',padding:0,transition:'all 0.2s ease',color:'#2b6cb0'},onMouseEnter:e=>{e.currentTarget.style.backgroundColor='#f0f7ff',e.currentTarget.style.transform='scale(1.05)'},onMouseLeave:e=>{e.currentTarget.style.backgroundColor='#fff',e.currentTarget.style.transform='scale(1)'},title:"\u041c\u043e\u0435 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u0435","aria-label":"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u043c\u043e\u0435\u043c\u0443 \u043c\u0435\u0441\u0442\u043e\u043f\u043e\u043b\u043e\u0436\u0435\u043d\u0438\u044e",children:(0,u.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,u.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z",fill:"currentColor"})})})}),N&&'route'===j&&p.length<2&&(0,u.jsxs)("div",{style:y.mobileRouteHint,children:[(0,u.jsx)("div",{style:y.mobileRouteHintIcon,children:"\u279c"}),(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{style:y.mobileRouteHintTitle,children:"\u0423\u043a\u0430\u0436\u0438 \u0441\u0442\u0430\u0440\u0442 \u0438 \u0444\u0438\u043d\u0438\u0448"}),(0,u.jsx)("div",{style:y.mobileRouteHintText,children:"\u041d\u0430\u0436\u043c\u0438 \u043f\u043e \u043a\u0430\u0440\u0442\u0435: \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0441\u0442\u0430\u0440\u0442, \u0437\u0430\u0442\u0435\u043c \u0444\u0438\u043d\u0438\u0448. \u041a\u0430\u0440\u0442\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u043c\u0430\u0441\u0448\u0442\u0430\u0431\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438."})]})]}),(0,u.jsxs)(J,{center:'route'===j?[r.latitude,r.longitude]:P?[P.latitude,P.longitude]:[r.latitude,r.longitude],zoom:'route'===j?13:P?11:13,style:y.map,zoomAnimation:!1,markerZoomAnimation:!1,children:[(0,u.jsx)(Q,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xa9 <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>"}),(0,u.jsx)(ie,{}),'radius'===j&&$&&(0,u.jsx)(oe,{center:[r.latitude,r.longitude],radius:$,pathOptions:{color:'#ff9800',fillColor:'#ff9800',fillOpacity:.2,weight:2}}),p.length>=1&&F?.start&&(0,u.jsx)(ee,{position:[p[0][1],p[0][0]],icon:F.start,eventHandlers:{click:e=>{e.originalEvent?.stopPropagation()}},children:(0,u.jsx)(te,{children:"Start"})}),2===p.length&&F?.end&&(0,u.jsx)(ee,{position:[p[1][1],p[1][0]],icon:F.end,eventHandlers:{click:e=>{e.originalEvent?.stopPropagation()}},children:(0,u.jsx)(te,{children:"End"})}),'route'===j&&p.length>=2&&W&&M&&(0,u.jsx)(D,{routePoints:p,transportMode:k,setRoutingLoading:O,setErrors:L,setRouteDistance:v,setFullRouteCoords:C,ORS_API_KEY:W}),P&&F?.userLocation&&(0,u.jsx)(ee,{position:[P.latitude,P.longitude],icon:F.userLocation,children:(0,u.jsx)(te,{children:"Your location"})}),F?.meTravel&&e?.data&&Array.isArray(e.data)&&e.data.length>0&&(0,u.jsx)(x,{points:e.data,icon:F.meTravel,Marker:ee,Popup:te,PopupContent:({point:e})=>{const o=ne(),n=(0,t.useCallback)(()=>{o.closePopup()},[o]);return(0,u.jsx)(c.default,{travel:e,onClose:n})}}),'route'===j&&p.length>=2&&e.data&&0===e.data.length&&(0,u.jsxs)(o.default,{testID:"no-points-message",style:{position:'absolute',top:'50%',left:'50%',transform:[{translateX:-150},{translateY:-60}],backgroundColor:'rgba(255, 255, 255, 0.95)',paddingVertical:20,paddingHorizontal:24,borderRadius:12,zIndex:1e3,shadowColor:'#000',shadowOpacity:.2,shadowRadius:8,elevation:4,maxWidth:300,alignItems:'center'},children:[(0,u.jsx)(n.default,{style:{marginBottom:8,fontSize:16,fontWeight:'600',textAlign:'center'},children:"\u0422\u043e\u0447\u043a\u0438 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"}),(0,u.jsx)(n.default,{style:{color:'#666',fontSize:13,textAlign:'center'},children:"\u0412 \u0440\u0430\u0434\u0438\u0443\u0441\u0435 2 \u043a\u043c \u043e\u0442 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430 \u043d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0442\u043e\u0447\u0435\u043a"})]}),H&&(0,u.jsxs)(o.default,{style:y.routingProgress,children:[(0,u.jsx)(i.default,{size:"small",color:"#fff"}),(0,u.jsx)(n.default,{style:y.routingProgressText,children:"Building route..."})]}),I.routing&&(0,u.jsx)(o.default,{style:y.routingError,children:(0,u.jsx)(n.default,{style:y.routingErrorText,children:"Routing error"})})]})]})},w=({message:e})=>(0,u.jsxs)(o.default,{style:y.loader,children:[(0,u.jsx)(i.default,{size:"large"}),(0,u.jsx)(n.default,{children:e})]}),y=r.default.create({wrapper:{flex:1,borderRadius:16,overflow:'hidden',backgroundColor:'#f5f5f5',position:'relative'},map:{width:'100%',height:'100%',minHeight:300},loader:{flex:1,justifyContent:'center',alignItems:'center',padding:20},errorText:{color:'#d32f2f',textAlign:'center'},myLocationButton:{position:'absolute',top:10,right:10,zIndex:1e3},myLocationButtonInner:{width:'44px',height:'44px',borderRadius:'50%',backgroundColor:'#fff',border:'2px solid rgba(0,0,0,0.2)',boxShadow:'0 2px 8px rgba(0,0,0,0.15)',cursor:'pointer',display:'flex',alignItems:'center',justifyContent:'center',padding:0,transition:'all 0.2s ease',color:'#2b6cb0'},routingProgress:{position:'absolute',top:60,left:'10%',right:'10%',backgroundColor:'rgba(100,100,255,0.9)',padding:10,borderRadius:8,zIndex:1e3,flexDirection:'row',alignItems:'center',justifyContent:'center'},routingProgressText:{color:'#fff',marginLeft:8},routingError:{position:'absolute',top:20,left:'10%',right:'10%',backgroundColor:'rgba(255,80,80,0.9)',padding:10,borderRadius:8,zIndex:1e3,alignItems:'center'},routingErrorText:{color:'#fff',fontWeight:'600'},mobileRouteHint:{position:'absolute',left:12,right:12,top:12,zIndex:1e3,backgroundColor:'rgba(255,255,255,0.95)',borderRadius:16,padding:12,display:'flex',flexDirection:'row',alignItems:'center',gap:12,boxShadow:'0 8px 24px rgba(15,23,42,0.18)',pointerEvents:'none'},mobileRouteHintIcon:{width:40,height:40,borderRadius:12,backgroundColor:'rgba(74,140,140,0.12)',color:'#4a8c8c',display:'flex',alignItems:'center',justifyContent:'center',fontSize:18,fontWeight:'700'},mobileRouteHintTitle:{fontSize:14,fontWeight:'700',color:'#1f2937',marginBottom:2},mobileRouteHintText:{fontSize:12,color:'#4b5563',lineHeight:16}});_e.default=t.default.memo(b)},2092,{"0":23,"1":4,"2":315,"3":132,"4":145,"5":407,"6":123,"7":1987,"8":2093,"9":2087,"10":2,"11":2094,"12":1756,"paths":{"2094":"/_expo/static/js/web/index-659422579c4f2e91851c75a73bfc1c32.js"}});
__d(function(g,r,_i,a,m,_e,d){Object.defineProperty(_e,"__esModule",{value:!0}),_e.default=void 0;var t=r(d[0]);const e=t=>{switch(t){case'bike':return'cycling-regular';case'foot':return'foot-walking';default:return'driving-car'}},n=t=>{switch(t){case'bike':return'bike';case'foot':return'foot';default:return'driving'}};_e.default=({map:o,routePoints:c,transportMode:i,setRoutingLoading:s,setErrors:u,setRouteDistance:l,setFullRouteCoords:f,ORS_API_KEY:y})=>{const w=(0,t.useRef)(null),h=(0,t.useRef)(null),p=Array.isArray(c)&&c.length>=2;return(0,t.useEffect)(()=>{const t=window.L;if(!o||!t)return;window.matchMedia('(max-width: 768px)').matches;if(!p){if(w.current){try{o.removeLayer(w.current)}catch(t){}w.current=null}return u(t=>({...t,routing:!1})),void l(0)}h.current&&(h.current.abort(),h.current=null);const L=new AbortController;h.current=L;const v=async()=>{const t=await fetch(`https://api.openrouteservice.org/v2/directions/${e(i)}/geojson`,{method:'POST',headers:{Authorization:String(y),'Content-Type':'application/json'},body:JSON.stringify({coordinates:c}),signal:L.signal});if(!t.ok)throw new Error(`ORS error: ${t.status}`);const n=await t.json(),o=n.features?.[0],s=o?.geometry,u=o?.properties?.summary;if(!s?.coordinates?.length)throw new Error('Empty route from ORS');const l=s.coordinates,f=u?.distance;return{coordsLngLat:l,distance:f}},b=async()=>{const t=`https://router.project-osrm.org/route/v1/${n(i)}/${c.map(([t,e])=>`${t},${e}`).join(';')}?overview=full&geometries=geojson`,e=await fetch(t,{signal:L.signal});if(!e.ok)throw new Error(`OSRM error: ${e.status}`);const o=await e.json(),s=o.routes?.[0];if(!s?.geometry?.coordinates?.length)throw new Error('Empty route from OSRM');return{coordsLngLat:s.geometry.coordinates,distance:s.distance}};let E=!0;return(async()=>{try{if(!E)return;s(!0),u(t=>({...t,routing:!1}));const e=y?await v():await b();if(!E)return;f(e.coordsLngLat);const n=e.coordsLngLat.map(([e,n])=>t.latLng(n,e));if(w.current){try{o.removeLayer(w.current)}catch(t){}w.current=null}const c=t.polyline(n,{color:'#3388ff',weight:5,opacity:.85});if(c.addTo(o),w.current=c,'number'==typeof e.distance)l(e.distance);else{const t=n.reduce((t,e,n,o)=>0===n?0:t+o[n-1].distanceTo(e),0);l(t)}window.disableFitBounds=!1}catch(e){if('AbortError'===e?.name||!E)return;if(u(t=>({...t,routing:e?.message||!0})),y&&E)try{const e=await b();if(!E)return;f(e.coordsLngLat);const n=e.coordsLngLat.map(([e,n])=>t.latLng(n,e));if(w.current){try{o.removeLayer(w.current)}catch{}w.current=null}const c=t.polyline(n,{color:'#3388ff',weight:5,opacity:.85});c.addTo(o),w.current=c,'number'==typeof e.distance?l(e.distance):l(0),window.disableFitBounds=!1,u(t=>({...t,routing:!1}))}catch(t){}}finally{E&&s(!1)}})(),()=>{E=!1,h.current&&(h.current.abort(),h.current=null)}},[o,i,y,JSON.stringify(c)]),(0,t.useEffect)(()=>{const t=window.L;return()=>{if(o&&t&&w.current){try{o.removeLayer(w.current)}catch{}w.current=null}}},[o]),null}},2093,[4]);
//# sourceMappingURL=/_expo/static/js/web/Map-2cc31664850f64b50dce5ace324d99a0.js.map
//# debugId=6657ed54-0ae5-45e5-a2bd-a0ee1b170c72