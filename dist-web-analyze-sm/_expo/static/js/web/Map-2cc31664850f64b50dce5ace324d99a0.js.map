{"version":3,"sources":["/components/MapPage/Map.web.tsx","/components/MapPage/RoutingMachine.tsx"],"sourcesContent":["// components/MapPage/Map.web.tsx\nimport React, { useEffect, useState, useMemo, useCallback, useRef } from 'react';\nimport { View, Text, StyleSheet, ActivityIndicator, Platform } from 'react-native';\nimport * as Location from 'expo-location';\ntype LeafletNS = any;\ntype ReactLeafletNS = typeof import('react-leaflet');\n// CSS загружается через CDN ниже в коде\nimport RoutingMachine from '@/components/MapPage/RoutingMachine';\nimport PopupContentComponent from '@/components/MapPage/PopupContentComponent';\nimport MapLegend from '@/components/MapPage/MapLegend';\n\ntype Point = {\n  id?: number;\n  coord: string;\n  address: string;\n  travelImageThumbUrl: string;\n  categoryName: string;\n  articleUrl?: string;\n  urlTravel?: string;\n};\n\ninterface Coordinates {\n  latitude: number;\n  longitude: number;\n}\n\ntype TransportMode = 'car' | 'bike' | 'foot';\ntype MapMode = 'radius' | 'route';\n\ninterface Props {\n  travel?: { data?: Point[] };\n  coordinates: Coordinates;\n  routePoints: [number, number][];\n  setRoutePoints: (points: [number, number][]) => void;\n  onMapClick: (lng: number, lat: number) => void;\n  mode: MapMode;\n  transportMode: TransportMode;\n  setRouteDistance: (distance: number) => void;\n  setFullRouteCoords: (coords: [number, number][]) => void;\n  radius?: string; // Радиус поиска в км\n}\n\nconst strToLatLng = (s: string): [number, number] | null => {\n  const [lat, lng] = s.split(',').map(Number);\n  return Number.isFinite(lat) && Number.isFinite(lng) ? [lng, lat] : null;\n};\n\nconst generateUniqueKey = (\n    point: Point,\n    index: number,\n    coords: [number, number] | null\n): string => {\n  if (point.id) return `point-${point.id}`;\n  if (coords) return `point-${index}-${coords.join('-')}`;\n  return `point-${index}-${Date.now()}`;\n};\n\n// ✅ ОПТИМИЗАЦИЯ: Мемоизированный компонент маркеров для предотвращения лишних перерисовок\ninterface TravelMarkersProps {\n  points: Point[];\n  icon: any;\n  Marker: React.ComponentType<any>;\n  Popup: React.ComponentType<any>;\n  PopupContent: React.ComponentType<{ point: Point }>; // Передаем компонент попапа как проп\n}\n\nconst TravelMarkers: React.FC<TravelMarkersProps> = ({ points, icon, Marker, Popup, PopupContent }) => {\n  return (\n    <>\n      {points.map((point, index) => {\n        const coords = strToLatLng(point.coord);\n        if (!coords || !point.coord) {\n          return null;\n        }\n        \n        const markerKey = point.id \n          ? `travel-${point.id}` \n          : `travel-${point.coord.replace(/,/g, '-')}-${index}`;\n        \n        return (\n          <Marker\n            key={markerKey}\n            position={[coords[1], coords[0]]}\n            icon={icon}\n          >\n            <Popup>\n              <PopupContent point={point} />\n            </Popup>\n          </Marker>\n        );\n      })}\n    </>\n  );\n};\n\n// Мемоизация с кастомным компаратором - перерисовываем только при изменении ID точек\n// ✅ ИСПРАВЛЕНИЕ: Улучшенное сравнение для предотвращения лишних перерисовок\nconst TravelMarkersMemo = React.memo(TravelMarkers, (prev, next) => {\n  // Сравниваем количество точек\n  if (prev.points.length !== next.points.length) return false;\n  \n  // Сравниваем ссылки на иконки и компоненты (они должны быть стабильными)\n  if (prev.icon !== next.icon || prev.Marker !== next.Marker || prev.Popup !== next.Popup || prev.PopupContent !== next.PopupContent) {\n    return false;\n  }\n  \n  // ✅ ИСПРАВЛЕНИЕ: Более надежное сравнение точек с проверкой всех ключевых полей\n  return prev.points.every((p, i) => {\n    const nextPoint = next.points[i];\n    if (!nextPoint) return false;\n    // Сравниваем ID, координаты и адрес для надежности\n    return (\n      p.id === nextPoint.id &&\n      p.coord === nextPoint.coord &&\n      p.address === nextPoint.address\n    );\n  });\n});\n\nconst MapPageComponent: React.FC<Props> = ({\n                                             travel = { data: [] },\n                                             coordinates,\n                                             routePoints,\n                                             setRoutePoints,\n                                             onMapClick,\n                                             mode,\n                                             transportMode,\n                                             setRouteDistance,\n                                             setFullRouteCoords,\n                                             radius,\n                                           }) => {\n  const [L, setL] = useState<any>(null);\n  const [rl, setRl] = useState<any>(null);\n  const [userLocation, setUserLocation] = useState<Coordinates | null>(null);\n  const [errors, setErrors] = useState({\n    location: false,\n    loadingModules: false,\n    routing: false,\n  });\n  const [loading, setLoading] = useState(false);\n  const [routingLoading, setRoutingLoading] = useState(false);\n  const [disableFitBounds, setDisableFitBounds] = useState(false);\n  const [isMobileScreen, setIsMobileScreen] = useState<boolean>(() => {\n    if (typeof window === 'undefined') return false;\n    return window.matchMedia('(max-width: 768px)').matches;\n  });\n\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const media = window.matchMedia('(max-width: 768px)');\n    const handler = (event: MediaQueryListEvent) => setIsMobileScreen(event.matches);\n    if (media.addEventListener) {\n      media.addEventListener('change', handler);\n    } else {\n      // @ts-ignore\n      media.addListener(handler);\n    }\n    return () => {\n      if (media.removeEventListener) {\n        media.removeEventListener('change', handler);\n      } else {\n        // @ts-ignore\n        media.removeListener(handler);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n    if (Platform.OS !== 'web' || typeof window === 'undefined') return;\n\n    const isTestEnv = typeof process !== 'undefined' && process.env?.NODE_ENV === 'test';\n\n    const ensureLeafletCSS = () => {\n      const href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';\n      if (!document.querySelector(`link[href=\"${href}\"]`)) {\n        const link = document.createElement('link');\n        link.rel = 'stylesheet';\n        link.href = href;\n        document.head.appendChild(link);\n      }\n    };\n\n    const ensureLeaflet = async (): Promise<any> => {\n      const w = window as any;\n      if (w.L) return w.L;\n\n      ensureLeafletCSS();\n\n      if (!(ensureLeaflet as any)._loader) {\n        (ensureLeaflet as any)._loader = new Promise<void>((resolve, reject) => {\n          const script = document.createElement('script');\n          script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';\n          script.async = true;\n          script.onload = () => resolve();\n          script.onerror = (err) => {\n            (ensureLeaflet as any)._loader = null;\n            reject(err);\n          };\n          document.body.appendChild(script);\n        });\n      }\n\n      await (ensureLeaflet as any)._loader;\n      return w.L;\n    };\n\n    const load = async () => {\n      try {\n        const L = await ensureLeaflet();\n        const rlMod = await import('react-leaflet');\n        if (!cancelled) {\n          setL(L);\n          setRl(rlMod);\n        }\n      } catch {\n        if (!cancelled) {\n          setErrors((prev) => ({ ...prev, loadingModules: true }));\n        }\n      }\n    };\n\n    if (isTestEnv) {\n      load();\n    } else if ('requestIdleCallback' in window) {\n      (window as any).requestIdleCallback(load, { timeout: 2000 });\n    } else {\n      const t = setTimeout(load, 1200);\n      return () => clearTimeout(t);\n    }\n\n    return () => {\n      cancelled = true;\n    };\n  }, []);\n\n  const ORS_API_KEY = process.env.EXPO_PUBLIC_ROUTE_SERVICE;\n\n  const RoutingMachineWithMapInner: React.FC<any> = (props) => {\n    const useMap = (rl as any).useMap;\n    const map = useMap();\n    return <RoutingMachine map={map} {...props} />;\n  };\n\n  const customIcons = useMemo(() => {\n    // Защита от отсутствия Leaflet в тестовой/серверной среде\n    if (!L || typeof (L as any).Icon !== 'function') {\n      return {\n        meTravel: undefined,\n        userLocation: undefined,\n        start: undefined,\n        end: undefined,\n      } as any;\n    }\n\n    // Цвета сайта\n    // primary: '#ff9f5a' (оранжевый) - для путешествий\n    // success: '#25a562' (зеленый) - для старта\n    // danger: '#d94b4b' (красный) - для финиша\n    // info: '#2b6cb0' (синий) - для местоположения\n    \n    // ✅ ИСПРАВЛЕНИЕ: Оранжевый маркер для путешествий (стандартный оранжевый)\n    const orangeMarkerIcon = new L.Icon({\n      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-orange.png',\n      iconRetinaUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n      iconSize: [25, 41],\n      iconAnchor: [12, 41],\n      popupAnchor: [0, -41],\n      shadowSize: [41, 41],\n      shadowAnchor: [12, 41],\n      // ✅ Убеждаемся что иконка всегда загружается\n      crossOrigin: true,\n    });\n    \n    // Зеленый маркер для старта (success цвет)\n    const greenMarkerIcon = new L.Icon({\n      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',\n      iconRetinaUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n      iconSize: [30, 41],\n      iconAnchor: [15, 41],\n      popupAnchor: [0, -41],\n      shadowSize: [41, 41],\n      shadowAnchor: [12, 41],\n    });\n    \n    // Красный маркер для финиша (danger цвет)\n    const redMarkerIcon = new L.Icon({\n      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',\n      iconRetinaUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n      iconSize: [30, 41],\n      iconAnchor: [15, 41],\n      popupAnchor: [0, -41],\n      shadowSize: [41, 41],\n      shadowAnchor: [12, 41],\n    });\n    \n    // Синий маркер для местоположения (info цвет)\n    const blueMarkerIcon = new L.Icon({\n      iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png',\n      iconRetinaUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',\n      shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',\n      iconSize: [25, 41],\n      iconAnchor: [12, 41],\n      popupAnchor: [0, -41],\n      shadowSize: [41, 41],\n      shadowAnchor: [12, 41],\n    });\n    \n    return {\n      meTravel: orangeMarkerIcon,\n      userLocation: blueMarkerIcon,\n      start: greenMarkerIcon,\n      end: redMarkerIcon,\n    };\n  }, [L]);\n\n  useEffect(() => {\n    const requestLocation = async () => {\n      try {\n        setLoading(true);\n        const { status } = await Location.requestForegroundPermissionsAsync();\n        if (status !== 'granted') throw new globalThis.Error();\n        const loc = await Location.getCurrentPositionAsync({\n          accuracy: Location.Accuracy.BestForNavigation,\n        });\n        setUserLocation({\n          latitude: loc.coords.latitude,\n          longitude: loc.coords.longitude,\n        });\n      } catch {\n        setErrors((prev) => ({ ...prev, location: true }));\n      } finally {\n        setLoading(false);\n      }\n    };\n    requestLocation();\n  }, []);\n\n  const handleMapClick = useCallback(\n      (e: any) => {\n        if (mode !== 'route' || routePoints.length >= 2) return;\n        const newPoint: [number, number] = [e.latlng.lng, e.latlng.lat];\n        setRoutePoints([...routePoints, newPoint]);\n        setDisableFitBounds(true);\n        onMapClick(e.latlng.lng, e.latlng.lat);\n      },\n      [mode, routePoints, setRoutePoints, onMapClick]\n  );\n\n  // Вычисляем радиус в метрах для отображения круга (должен быть до условных возвратов)\n  const radiusInMeters = useMemo(() => {\n    if (mode !== 'radius') return null;\n    // Используем переданный радиус или значение по умолчанию 60 км\n    const radiusValue = radius || '60';\n    const radiusKm = parseInt(radiusValue, 10);\n    if (isNaN(radiusKm) || radiusKm <= 0) return 60000; // По умолчанию 60 км\n    return radiusKm * 1000; // Конвертируем км в метры\n  }, [mode, radius]);\n\n  // Сохраняем ссылку на карту для кнопки \"Мое местоположение\" (должен быть до условных возвратов)\n  const mapRef = useRef<any>(null);\n\n  // ✅ ИСПРАВЛЕНИЕ: Используем useRef для отслеживания инициализации\n  // Должны быть объявлены ДО условных возвратов, чтобы соблюдать правила хуков\n  const hasInitializedRef = useRef(false);\n  const lastModeRef = useRef<MapMode | null>(null);\n  const savedMapViewRef = useRef<{ center: [number, number]; zoom: number } | null>(null);\n\n  // Функция для центрирования на местоположении пользователя (должна быть до условных возвратов)\n  const centerOnUserLocation = useCallback(() => {\n    if (!mapRef.current || !userLocation) return;\n    mapRef.current.setView([userLocation.latitude, userLocation.longitude], 13, { animate: true });\n  }, [userLocation]);\n\n  // Тестовый экспорт: предоставляем обработчик клика по маркерам старта/финиша,\n  // который предотвращает дальнейшую обработку события (и, соответственно, зум).\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    if (mode === 'route' && routePoints.length >= 1) {\n      (globalThis as any).lastMarkerClickHandler = (e: any) => {\n        e?.originalEvent?.stopPropagation?.();\n      };\n    }\n  }, [mode, routePoints.length]);\n\n  if (loading) return <Loader message=\"Loading map...\" />;\n\n  if (!L || !rl) {\n    return <Loader message={errors.loadingModules ? 'Loading map modules failed' : 'Loading map...'} />;\n  }\n\n  const { MapContainer, TileLayer, Marker, Popup, Circle, useMap, useMapEvents } = rl as ReactLeafletNS;\n\n  // Компонент для управления закрытием попапа (внутри MapContainer)\n  const PopupWithClose: React.FC<{ point: Point }> = ({ point }) => {\n    const map = useMap();\n\n    const handleClose = useCallback(() => {\n      map.closePopup();\n    }, [map]);\n\n    return <PopupContentComponent travel={point} onClose={handleClose} />;\n  };\n\n  const MapLogic = () => {\n    const map = useMap();\n    useMapEvents({ click: handleMapClick });\n    const [hasCenteredOnData, setHasCenteredOnData] = useState(false);\n    \n    // Сохраняем ссылку на карту\n    useEffect(() => {\n      mapRef.current = map;\n    }, [map]);\n\n    // Сохраняем текущую позицию карты при изменении (только в режиме route)\n    useEffect(() => {\n      if (!map || mode !== 'route') return;\n      \n      const saveView = () => {\n        const center = map.getCenter();\n        const zoom = map.getZoom();\n        savedMapViewRef.current = {\n          center: [center.lat, center.lng],\n          zoom,\n        };\n      };\n      \n      // Сохраняем позицию при изменении зума или перемещении\n      map.on('moveend', saveView);\n      map.on('zoomend', saveView);\n      \n      return () => {\n        map.off('moveend', saveView);\n        map.off('zoomend', saveView);\n      };\n    }, [map, mode]);\n\n    // Центрирование на местоположение пользователя при первой загрузке\n    useEffect(() => {\n      if (!map) return;\n      \n      // ✅ ИСПРАВЛЕНИЕ: В режиме route НИКОГДА не центрируем автоматически\n      // Пользователь сам выбирает точки на карте, карта должна оставаться на текущей позиции\n      if (mode === 'route') {\n        // Только при первой инициализации используем coordinates\n        if (!hasInitializedRef.current && coordinates.latitude && coordinates.longitude) {\n          map.setView([coordinates.latitude, coordinates.longitude], 13, { animate: false });\n          hasInitializedRef.current = true;\n        }\n        // После инициализации НЕ трогаем карту - она остается на текущей позиции\n        lastModeRef.current = mode;\n        return;\n      }\n      \n      // Если переключились с route на radius, сбрасываем флаг инициализации\n      if (lastModeRef.current === 'route' && mode === 'radius') {\n        hasInitializedRef.current = false;\n      }\n      \n      // Только для режима radius делаем центрирование при первой загрузке\n      if (!hasInitializedRef.current) {\n        if (userLocation) {\n          map.setView([userLocation.latitude, userLocation.longitude], 11, { animate: false });\n          hasInitializedRef.current = true;\n        } else if (coordinates.latitude && coordinates.longitude) {\n          map.setView([coordinates.latitude, coordinates.longitude], 11, { animate: false });\n          hasInitializedRef.current = true;\n        }\n      }\n      \n      lastModeRef.current = mode;\n    }, [map, userLocation, coordinates, mode]);\n\n    // Автоматическое подгонка границ при изменении данных (но только если не отключено)\n    useEffect(() => {\n      if (disableFitBounds || !map) return;\n      \n      // ✅ ИСПРАВЛЕНИЕ: В режиме route НИКОГДА не делаем автоматический зум\n      // Это предотвращает зум при клике на старт/финиш и при переключении вкладок\n      if (mode === 'route') return;\n\n      // Защита от отсутствия Leaflet в тестовой/серверной среде\n      if (!L || typeof (L as any).latLngBounds !== 'function' || typeof (L as any).latLng !== 'function') {\n        return;\n      }\n\n      const allPoints: [number, number][] = [];\n      \n      // Добавляем точки путешествий\n      if (travel.data && travel.data.length > 0) {\n        const travelPoints = (travel.data || [])\n          .map((p) => strToLatLng(p.coord))\n          .filter(Boolean) as [number, number][];\n        allPoints.push(...travelPoints);\n      }\n      \n      // ✅ ИСПРАВЛЕНИЕ: Не добавляем местоположение пользователя при установке точек маршрута\n      // Это предотвращает нежелательный зум к текущему местоположению\n      // Добавляем местоположение пользователя ТОЛЬКО если нет других точек\n      if (allPoints.length === 0 && userLocation) {\n        allPoints.push([userLocation.longitude, userLocation.latitude]);\n      }\n\n      if (allPoints.length > 0) {\n        const bounds = L.latLngBounds(\n          allPoints.map(([lng, lat]) => L.latLng(lat, lng))\n        );\n        map.fitBounds(bounds.pad(0.2), { animate: !hasCenteredOnData });\n        setHasCenteredOnData(true);\n      }\n    }, [disableFitBounds, mode, routePoints, travel.data, userLocation, map, hasCenteredOnData, isMobileScreen]);\n\n    return null;\n  };\n\n  return (\n      <View style={styles.wrapper}>\n        {/* Кнопка \"Мое местоположение\" */}\n        {userLocation && Platform.OS === 'web' && (\n          <div style={{\n            position: 'absolute',\n            top: 10,\n            right: 10,\n            zIndex: 1000,\n          }}>\n            <button\n              onClick={centerOnUserLocation}\n              style={{\n                width: '44px',\n                height: '44px',\n                borderRadius: '50%',\n                backgroundColor: '#fff',\n                border: '2px solid rgba(0,0,0,0.2)',\n                boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n                cursor: 'pointer',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                padding: 0,\n                transition: 'all 0.2s ease',\n                color: '#2b6cb0',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.backgroundColor = '#f0f7ff';\n                e.currentTarget.style.transform = 'scale(1.05)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.backgroundColor = '#fff';\n                e.currentTarget.style.transform = 'scale(1)';\n              }}\n              title=\"Мое местоположение\"\n              aria-label=\"Вернуться к моему местоположению\"\n            >\n              <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n                <path d=\"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z\" fill=\"currentColor\"/>\n              </svg>\n            </button>\n          </div>\n        )}\n        {isMobileScreen && mode === 'route' && routePoints.length < 2 && (\n          <div style={styles.mobileRouteHint}>\n            <div style={styles.mobileRouteHintIcon}>➜</div>\n            <div>\n              <div style={styles.mobileRouteHintTitle}>\n                Укажи старт и финиш\n              </div>\n              <div style={styles.mobileRouteHintText}>\n                Нажми по карте: сначала старт, затем финиш. Карта не будет масштабироваться автоматически.\n              </div>\n            </div>\n          </div>\n        )}\n        \n        <MapContainer\n            center={\n              // ✅ ИСПРАВЛЕНИЕ: В режиме route всегда используем только coordinates\n              // Это предотвращает центрирование на пользователя при клике и переключении вкладок\n              mode === 'route' \n                ? [coordinates.latitude, coordinates.longitude]\n                : (userLocation ? [userLocation.latitude, userLocation.longitude] : [coordinates.latitude, coordinates.longitude])\n            }\n            zoom={mode === 'route' ? 13 : (userLocation ? 11 : 13)}\n            style={styles.map}\n            zoomAnimation={false}\n            markerZoomAnimation={false}\n        >\n          <TileLayer\n              url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n              attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n          />\n\n          <MapLogic />\n\n          {/* Круг радиуса поиска */}\n          {mode === 'radius' && radiusInMeters && (\n              <Circle\n                  center={[coordinates.latitude, coordinates.longitude]}\n                  radius={radiusInMeters}\n                  pathOptions={{\n                      color: '#ff9800',\n                      fillColor: '#ff9800',\n                      fillOpacity: 0.2,\n                      weight: 2,\n                  }}\n              />\n          )}\n\n          {routePoints.length >= 1 && customIcons?.start && (\n              <Marker \n                position={[routePoints[0][1], routePoints[0][0]]} \n                icon={customIcons.start}\n                eventHandlers={{\n                  // ✅ ИСПРАВЛЕНИЕ: Отключаем зум при клике на маркер старт\n                  click: (e: any) => {\n                    e.originalEvent?.stopPropagation();\n                  }\n                }}\n              >\n                <Popup>Start</Popup>\n              </Marker>\n          )}\n\n          {routePoints.length === 2 && customIcons?.end && (\n              <Marker \n                position={[routePoints[1][1], routePoints[1][0]]} \n                icon={customIcons.end}\n                eventHandlers={{\n                  // ✅ ИСПРАВЛЕНИЕ: Отключаем зум при клике на маркер финиш\n                  click: (e: any) => {\n                    e.originalEvent?.stopPropagation();\n                  }\n                }}\n              >\n                <Popup>End</Popup>\n              </Marker>\n          )}\n\n          {mode === 'route' && routePoints.length >= 2 && ORS_API_KEY && rl && (\n              <RoutingMachineWithMapInner\n                  routePoints={routePoints}\n                  transportMode={transportMode}\n                  setRoutingLoading={setRoutingLoading}\n                  setErrors={setErrors}\n                  setRouteDistance={setRouteDistance}\n                  setFullRouteCoords={setFullRouteCoords}\n                  ORS_API_KEY={ORS_API_KEY}\n              />\n          )}\n\n          {userLocation && customIcons?.userLocation && (\n              <Marker\n                  position={[userLocation.latitude, userLocation.longitude]}\n                  icon={customIcons.userLocation}\n              >\n                <Popup>Your location</Popup>\n              </Marker>\n          )}\n\n          {/* ✅ ИСПРАВЛЕНИЕ: Маркеры путешествий - всегда оранжевые стандартные */}\n          {customIcons?.meTravel && travel?.data && Array.isArray(travel.data) && travel.data.length > 0 && (\n            <TravelMarkersMemo\n              points={travel.data}\n              icon={customIcons.meTravel}\n              Marker={Marker}\n              Popup={Popup}\n              PopupContent={PopupWithClose}\n            />\n          )}\n\n          {/* Сообщение, если точек нет */}\n          {Platform.OS === 'web' && mode === 'route' && routePoints.length >= 2 && travel.data && travel.data.length === 0 && (\n            <View\n              testID=\"no-points-message\"\n              style={{\n                position: 'absolute',\n                top: '50%',\n                left: '50%',\n                transform: [{ translateX: -150 }, { translateY: -60 }],\n                backgroundColor: 'rgba(255, 255, 255, 0.95)',\n                paddingVertical: 20,\n                paddingHorizontal: 24,\n                borderRadius: 12,\n                zIndex: 1000,\n                shadowColor: '#000',\n                shadowOpacity: 0.2,\n                shadowRadius: 8,\n                elevation: 4,\n                maxWidth: 300,\n                alignItems: 'center',\n              }}\n            >\n              <Text style={{ marginBottom: 8, fontSize: 16, fontWeight: '600', textAlign: 'center' }}>\n                Точки не найдены\n              </Text>\n              <Text style={{ color: '#666', fontSize: 13, textAlign: 'center' }}>\n                В радиусе 2 км от маршрута нет доступных точек\n              </Text>\n            </View>\n          )}\n\n          {routingLoading && (\n              <View style={styles.routingProgress}>\n                <ActivityIndicator size=\"small\" color=\"#fff\" />\n                <Text style={styles.routingProgressText}>Building route...</Text>\n              </View>\n          )}\n\n          {errors.routing && (\n              <View style={styles.routingError}>\n                <Text style={styles.routingErrorText}>Routing error</Text>\n              </View>\n          )}\n        </MapContainer>\n        \n        {/* ✅ ИСПРАВЛЕНИЕ: Легенда карты перенесена в боковую панель */}\n      </View>\n  );\n};\n\nconst Loader: React.FC<{ message: string }> = ({ message }) => (\n    <View style={styles.loader}>\n      <ActivityIndicator size=\"large\" />\n      <Text>{message}</Text>\n    </View>\n);\n\nconst Error: React.FC<{ message: string }> = ({ message }) => (\n    <View style={styles.loader}>\n      <Text style={styles.errorText}>{message}</Text>\n    </View>\n);\n\nconst styles = StyleSheet.create({\n  wrapper: { flex: 1, borderRadius: 16, overflow: 'hidden', backgroundColor: '#f5f5f5', position: 'relative' },\n  map: { width: '100%', height: '100%', minHeight: 300 },\n  loader: { flex: 1, justifyContent: 'center', alignItems: 'center', padding: 20 },\n  errorText: { color: '#d32f2f', textAlign: 'center' },\n  myLocationButton: {\n    position: 'absolute',\n    top: 10,\n    right: 10,\n    zIndex: 1000,\n    ...(Platform.OS === 'web' && {\n      // Web-specific styles\n    }),\n  },\n  myLocationButtonInner: {\n    ...(Platform.OS === 'web' && {\n      width: '44px',\n      height: '44px',\n      borderRadius: '50%',\n      backgroundColor: '#fff',\n      border: '2px solid rgba(0,0,0,0.2)',\n      boxShadow: '0 2px 8px rgba(0,0,0,0.15)',\n      cursor: 'pointer',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: 0,\n      transition: 'all 0.2s ease',\n      color: '#2b6cb0',\n    }),\n  } as any,\n  routingProgress: {\n    position: 'absolute',\n    top: 60,\n    left: '10%',\n    right: '10%',\n    backgroundColor: 'rgba(100,100,255,0.9)',\n    padding: 10,\n    borderRadius: 8,\n    zIndex: 1000,\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  routingProgressText: { color: '#fff', marginLeft: 8 },\n  routingError: {\n    position: 'absolute',\n    top: 20,\n    left: '10%',\n    right: '10%',\n    backgroundColor: 'rgba(255,80,80,0.9)',\n    padding: 10,\n    borderRadius: 8,\n    zIndex: 1000,\n    alignItems: 'center',\n  },\n  routingErrorText: { color: '#fff', fontWeight: '600' },\n  mobileRouteHint: {\n    position: 'absolute',\n    left: 12,\n    right: 12,\n    top: 12,\n    zIndex: 1000,\n    backgroundColor: 'rgba(255,255,255,0.95)',\n    borderRadius: 16,\n    padding: 12,\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 12,\n    boxShadow: '0 8px 24px rgba(15,23,42,0.18)',\n    pointerEvents: 'none',\n  } as any,\n  mobileRouteHintIcon: {\n    width: 40,\n    height: 40,\n    borderRadius: 12,\n    backgroundColor: 'rgba(74,140,140,0.12)',\n    color: '#4a8c8c',\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    fontSize: 18,\n    fontWeight: '700',\n  } as any,\n  mobileRouteHintTitle: {\n    fontSize: 14,\n    fontWeight: '700',\n    color: '#1f2937',\n    marginBottom: 2,\n  } as any,\n  mobileRouteHintText: {\n    fontSize: 12,\n    color: '#4b5563',\n    lineHeight: 16,\n  } as any,\n});\n\nexport default React.memo(MapPageComponent);\n","// components/MapPage/RoutingMachine.tsx\nimport { useEffect, useMemo, useRef } from 'react'\n\ninterface RoutingMachineProps {\n    map: any\n    routePoints: [number, number][]\n    transportMode: 'car' | 'bike' | 'foot'\n    setRoutingLoading: (loading: boolean) => void\n    setErrors: (errors: any) => void\n    setRouteDistance: (distance: number) => void\n    setFullRouteCoords: (coords: [number, number][]) => void\n    ORS_API_KEY: string | undefined\n}\n\nconst getORSProfile = (mode: 'car' | 'bike' | 'foot') => {\n    switch (mode) {\n        case 'bike': return 'cycling-regular'\n        case 'foot': return 'foot-walking'\n        default: return 'driving-car'\n    }\n}\n\nconst getOSRMProfile = (mode: 'car' | 'bike' | 'foot') => {\n    switch (mode) {\n        case 'bike': return 'bike'\n        case 'foot': return 'foot'\n        default: return 'driving'\n    }\n}\n\n/**\n * Роутинг без leaflet-routing-machine:\n * 1) Если есть ключ ORS — используем OpenRouteService.\n * 2) Если ключа нет — фоллбэк на публичный OSRM (без ключа).\n */\nconst RoutingMachine: React.FC<RoutingMachineProps> = ({\n                                                           map,\n                                                           routePoints,\n                                                           transportMode,\n                                                           setRoutingLoading,\n                                                           setErrors,\n                                                           setRouteDistance,\n                                                           setFullRouteCoords,\n                                                           ORS_API_KEY,\n                                                       }) => {\n    const polylineRef = useRef<any>(null)\n    const abortRef = useRef<AbortController | null>(null)\n\n    const hasTwoPoints = Array.isArray(routePoints) && routePoints.length >= 2\n\n    useEffect(() => {\n        const L = (window as any).L\n        if (!map || !L) return\n        const avoidAutoFit = typeof window !== 'undefined'\n            ? window.matchMedia('(max-width: 768px)').matches\n            : false\n\n        // если точек недостаточно — убираем линию и выходим\n        if (!hasTwoPoints) {\n            if (polylineRef.current) {\n                try { \n                    map.removeLayer(polylineRef.current); \n                } catch (error) {\n                    // ✅ FIX-009: Логируем ошибки удаления слоя (не критично, но полезно для отладки)\n                    if (__DEV__) {\n                        const { devWarn } = require('@/src/utils/logger');\n                        devWarn('Error removing polyline layer:', error);\n                    }\n                }\n                polylineRef.current = null\n            }\n            setErrors((prev: any) => ({ ...prev, routing: false }))\n            setRouteDistance(0)\n            return\n        }\n\n        // отменяем предыдущий запрос, если был\n        if (abortRef.current) {\n            abortRef.current.abort()\n            abortRef.current = null\n        }\n        const abort = new AbortController()\n        abortRef.current = abort\n\n        const fetchORS = async () => {\n            const res = await fetch(\n                `https://api.openrouteservice.org/v2/directions/${getORSProfile(transportMode)}/geojson`,\n                {\n                    method: 'POST',\n                    headers: {\n                        Authorization: String(ORS_API_KEY),\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({ coordinates: routePoints }),\n                    signal: abort.signal,\n                }\n            )\n            if (!res.ok) throw new Error(`ORS error: ${res.status}`)\n            const data = await res.json()\n            const feature = data.features?.[0]\n            const geometry = feature?.geometry\n            const summary = feature?.properties?.summary\n            if (!geometry?.coordinates?.length) throw new Error('Empty route from ORS')\n            const coordsLngLat: [number, number][] = geometry.coordinates\n            const distance = summary?.distance as number | undefined\n            return { coordsLngLat, distance }\n        }\n\n        const fetchOSRM = async () => {\n            const profile = getOSRMProfile(transportMode)\n            const coordsStr = routePoints.map(([lng, lat]) => `${lng},${lat}`).join(';')\n            const url = `https://router.project-osrm.org/route/v1/${profile}/${coordsStr}?overview=full&geometries=geojson`\n            const res = await fetch(url, { signal: abort.signal })\n            if (!res.ok) throw new Error(`OSRM error: ${res.status}`)\n            const data = await res.json()\n            const route = data.routes?.[0]\n            if (!route?.geometry?.coordinates?.length) throw new Error('Empty route from OSRM')\n            const coordsLngLat: [number, number][] = route.geometry.coordinates\n            const distance = route.distance as number | undefined\n            return { coordsLngLat, distance }\n        }\n\n        // ✅ FIX-006: Флаг для отслеживания монтирования компонента\n        let isMounted = true;\n\n        const run = async () => {\n            try {\n                if (!isMounted) return;\n                setRoutingLoading(true)\n                setErrors((prev: any) => ({ ...prev, routing: false }))\n\n                // 1) пробуем ORS, если есть ключ; иначе — OSRM\n                const result = ORS_API_KEY ? await fetchORS() : await fetchOSRM()\n\n                // ✅ FIX-006: Проверяем монтирование перед обновлением состояния\n                if (!isMounted) return;\n\n                // обновляем состояния\n                setFullRouteCoords(result.coordsLngLat)\n\n                const latlngs = result.coordsLngLat.map(([lng, lat]) => L.latLng(lat, lng))\n\n                if (polylineRef.current) {\n                    try { \n                        map.removeLayer(polylineRef.current); \n                    } catch (error) {\n                        // ✅ FIX-009: Логируем ошибки удаления слоя\n                        if (__DEV__) {\n                            const { devWarn } = require('@/src/utils/logger');\n                            devWarn('Error removing polyline layer:', error);\n                        }\n                    }\n                    polylineRef.current = null\n                }\n                const line = L.polyline(latlngs, { color: '#3388ff', weight: 5, opacity: 0.85 })\n                line.addTo(map)\n                polylineRef.current = line\n\n                // расстояние\n                if (typeof result.distance === 'number') {\n                    setRouteDistance(result.distance)\n                } else {\n                    const dist = latlngs.reduce((acc: number, cur: any, i: number, arr: any[]) => {\n                        if (i === 0) return 0\n                        return acc + arr[i - 1].distanceTo(cur)\n                    }, 0)\n                    setRouteDistance(dist)\n                }\n\n                // ✅ ИСПРАВЛЕНИЕ: Убираем автоматический зум при построении маршрута\n                // Пользователь сам контролирует масштаб карты при клике на старт/финиш\n                // map.fitBounds(line.getBounds().pad(0.2))\n                ;(window as any).disableFitBounds = false\n            } catch (e: any) {\n                if (e?.name === 'AbortError' || !isMounted) return\n                setErrors((prev: any) => ({ ...prev, routing: e?.message || true }))\n                // если ORS с ключом упал — пробуем OSRM разово\n                if (ORS_API_KEY && isMounted) {\n                    try {\n                        const result = await fetchOSRM()\n                        if (!isMounted) return;\n                        setFullRouteCoords(result.coordsLngLat)\n                        const latlngs = result.coordsLngLat.map(([lng, lat]) => L.latLng(lat, lng))\n                        if (polylineRef.current) {\n                            try { map.removeLayer(polylineRef.current) } catch {}\n                            polylineRef.current = null\n                        }\n                        const line = L.polyline(latlngs, { color: '#3388ff', weight: 5, opacity: 0.85 })\n                        line.addTo(map)\n                        polylineRef.current = line\n                        if (typeof result.distance === 'number') setRouteDistance(result.distance)\n                        else setRouteDistance(0)\n                        // ✅ ИСПРАВЛЕНИЕ: Убираем автоматический зум при построении маршрута\n                        // if (!(window as any).disableFitBounds && !avoidAutoFit) map.fitBounds(line.getBounds().pad(0.2))\n                        ;(window as any).disableFitBounds = false\n                        setErrors((prev: any) => ({ ...prev, routing: false }))\n                    } catch (error) {\n                        // ✅ FIX-009: Логируем ошибки fallback маршрутизации\n                        if (__DEV__) {\n                            const { devError } = require('@/src/utils/logger');\n                            devError('Error in OSRM fallback routing:', error);\n                        }\n                    }\n                }\n            } finally {\n                if (isMounted) {\n                    setRoutingLoading(false)\n                }\n            }\n        }\n\n        run()\n\n        return () => {\n            // ✅ FIX-006: Устанавливаем флаг размонтирования\n            isMounted = false;\n            if (abortRef.current) {\n                abortRef.current.abort()\n                abortRef.current = null\n            }\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [map, transportMode, ORS_API_KEY, JSON.stringify(routePoints)])\n\n    // cleanup полилинии при размонтировании\n    useEffect(() => {\n        const L = (window as any).L\n        return () => {\n            if (!map || !L) return\n            if (polylineRef.current) {\n                try { map.removeLayer(polylineRef.current) } catch {}\n                polylineRef.current = null\n            }\n        }\n    }, [map])\n\n    return null\n}\n\nexport default RoutingMachine\n"],"x_facebook_sources":[[{"names":["<global>","strToLatLng","generateUniqueKey","TravelMarkers","points.map$argument_0","React.memo$argument_1","prev.points.every$argument_0","MapPageComponent","useState$argument_0","useEffect$argument_0","handler","<anonymous>","ensureLeafletCSS","ensureLeaflet","Promise$argument_0","script.onload","script.onerror","load","setErrors$argument_0","RoutingMachineWithMapInner","useMemo$argument_0","requestLocation","handleMapClick","centerOnUserLocation","lastMarkerClickHandler","PopupWithClose","handleClose","MapLogic","saveView","map$argument_0","allPoints.map$argument_0","button.props.onMouseEnter","button.props.onMouseLeave","Marker.props.eventHandlers.click","Loader","Error"],"mappings":"AAA;oBC0C;CDG;0BEE;CFQ;oDGW;kBCG;ODqB;CHG;oDKI;2BCU;GDS;CLC;0COE;gECuB;GDG;YEE;oBCG,gED;WEO;KFO;GFC;YEE;6BGM;KHQ;0BIE;2DCO;0BCI,eD;2BEC;WFG;SDE;KJK;iBQE;oBCU,6CD;KRG;aEQ,qBF;WEG;KFE;GFC;oDYI;GZI;8BaE;GbyE;YEE;4BYC;kBHa,uCG;KZI;GFE;MeG;OfM;iCaK;GbO;2CgBY;GhBG;YEI;mDeG;OfE;GFE;qDkBW;oCCG;KDE;GlBG;mBoBE;clBM;KkBE;clBG;uBmBG;OnBO;aEM;OFG;KkBC;clBG;KkBiC;clBG;eoBiB,2BpB;wBqBc,kCrB;KkBK;GpBG;4BwB6B;exBG;4ByBC;ezBG;yB0BgE;mB1BE;yB0Ba;mB1BE;CPuF;8CkCE;ClCK;6CmCE;CnCI"}],[{"names":["<global>","getORSProfile","getOSRMProfile","RoutingMachine","useEffect$argument_0","setErrors$argument_0","fetchORS","fetchOSRM","routePoints.map$argument_0","run","result.coordsLngLat.map$argument_0","latlngs.reduce$argument_0","<anonymous>"],"mappings":"AAA;sBCc;CDM;uBEE;CFM;sDGO;cCe;sBCqB,4CD;yBEa;SFsB;0BGE;8CCE,+BD;SHU;oBKK;0BJI,4CI;wDCW,kCD;gDEsB;qBFG;0BJU,yDI;gECO,kCD;kCJa,4CI;SLc;eQI;SRO;KDE;cCG;eQE;SRM;KDC;CHG"}]],"names":["_react","_interopRequireWildcard","_r","d","_View","_interopRequireDefault","_Text","_StyleSheet","_ActivityIndicator","Location","_RoutingMachine","_PopupContentComponent","_jsxRuntime","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","strToLatLng","s","lat","lng","split","map","Number","isFinite","TravelMarkers","points","icon","Marker","Popup","PopupContent","jsx","Fragment","children","point","index","coords","coord","markerKey","id","replace","position","TravelMarkersMemo","React","memo","prev","next","length","every","p","nextPoint","address","MapPageComponent","travel","data","coordinates","routePoints","setRoutePoints","onMapClick","mode","transportMode","setRouteDistance","setFullRouteCoords","radius","L","setL","useState","rl","setRl","userLocation","setUserLocation","errors","setErrors","location","loadingModules","routing","loading","setLoading","routingLoading","setRoutingLoading","disableFitBounds","setDisableFitBounds","isMobileScreen","setIsMobileScreen","window","matchMedia","matches","useEffect","media","handler","event","addEventListener","addListener","removeEventListener","removeListener","cancelled","isTestEnv","process","env","NODE_ENV","ensureLeafletCSS","href","document","querySelector","link","createElement","rel","head","appendChild","ensureLeaflet","async","w","_loader","Promise","resolve","reject","script","src","onload","onerror","err","body","load","rlMod","paths","setTimeout","clearTimeout","requestIdleCallback","timeout","ORS_API_KEY","RoutingMachineWithMapInner","props","useMap","customIcons","useMemo","Icon","meTravel","undefined","start","end","orangeMarkerIcon","iconUrl","iconRetinaUrl","shadowUrl","iconSize","iconAnchor","popupAnchor","shadowSize","shadowAnchor","crossOrigin","greenMarkerIcon","redMarkerIcon","status","requestForegroundPermissionsAsync","globalThis","Error","loc","getCurrentPositionAsync","accuracy","Accuracy","BestForNavigation","latitude","longitude","requestLocation","handleMapClick","useCallback","newPoint","latlng","radiusInMeters","radiusKm","parseInt","isNaN","mapRef","useRef","hasInitializedRef","lastModeRef","savedMapViewRef","centerOnUserLocation","current","setView","animate","lastMarkerClickHandler","originalEvent","stopPropagation","Loader","message","MapContainer","TileLayer","Circle","useMapEvents","MapLogic","click","hasCenteredOnData","setHasCenteredOnData","saveView","center","getCenter","zoom","getZoom","on","off","latLngBounds","latLng","allPoints","travelPoints","filter","Boolean","push","bounds","fitBounds","pad","jsxs","style","styles","wrapper","top","right","zIndex","onClick","width","height","borderRadius","backgroundColor","border","boxShadow","cursor","display","alignItems","justifyContent","padding","transition","color","onMouseEnter","currentTarget","transform","onMouseLeave","title","viewBox","fill","xmlns","mobileRouteHint","mobileRouteHintIcon","mobileRouteHintTitle","mobileRouteHintText","zoomAnimation","markerZoomAnimation","url","attribution","pathOptions","fillColor","fillOpacity","weight","eventHandlers","Array","isArray","PopupWithClose","handleClose","closePopup","onClose","testID","left","translateX","translateY","paddingVertical","paddingHorizontal","shadowColor","shadowOpacity","shadowRadius","elevation","maxWidth","marginBottom","fontSize","fontWeight","textAlign","routingProgress","size","routingProgressText","routingError","routingErrorText","loader","StyleSheet","create","flex","overflow","minHeight","errorText","myLocationButton","myLocationButtonInner","flexDirection","marginLeft","gap","pointerEvents","lineHeight","_e","getORSProfile","getOSRMProfile","RoutingMachine","polylineRef","abortRef","hasTwoPoints","removeLayer","error","abort","AbortController","fetchORS","res","fetch","method","headers","Authorization","String","JSON","stringify","signal","ok","json","feature","features","geometry","summary","properties","coordsLngLat","distance","fetchOSRM","join","route","routes","isMounted","result","latlngs","line","polyline","opacity","addTo","dist","reduce","acc","cur","arr","distanceTo","name","run"],"mappings":"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","debugId":"6657ed54-0ae5-45e5-a2bd-a0ee1b170c72"}