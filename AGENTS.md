# AGENTS.md

Инструкции для AI-агента в проекте `metravel`.

## 0. Обязательность инструкций

- Агент обязан применять эти правила во всех задачах в этом репозитории.
- При конфликте между "быстро сделать" и правилами из этого файла приоритет у правил.
- Перед началом и перед завершением задачи агент сверяется с этим файлом как с чеклистом.

## 1. Контекст и границы

- Рабочая директория приложения: корень репозитория (папка с `package.json`).
- Источник правил проекта: `docs/RULES.md` и `docs/README.md`.
- Не меняй продовые серверные пути и SSL-пути без явной проверки существования на сервере.
- Не добавляй сложность без необходимости: сначала используй существующие компоненты, хуки и утилиты.

## 2. Базовый рабочий процесс

1. Перед правками изучи релевантные файлы в `docs/`.
2. Внеси минимально достаточные изменения.
3. После каждого логического шага запускай:
   - `npm run lint`
   - `npm run test:run`
4. По завершению задачи снова обязательно запусти:
   - `npm run lint`
   - `npm run test:run`

## 3. Обязательные технические правила

### 3.1 External links

- Запрещено использовать `window.open(...)` напрямую в фичах.
- Запрещено использовать `Linking.openURL(...)` напрямую вне `utils/externalLinks.ts`.
- Используй только:
  - `openExternalUrl(...)`
  - `openExternalUrlInNewTab(...)`
  - `openWebWindow(...)` (только для низкоуровневых инфраструктурных случаев)

Проверка:

- `npm run guard:external-links`
- `npm run governance:verify`

### 3.2 UI и компоненты

- Сначала переиспользуй `components/ui` и существующие фиче-компоненты.
- Для кнопок/иконок/чипов предпочитай существующие примитивы (`Button`, `IconButton`, `Chip`).
- Плейсхолдер изображения должен быть нейтральным:
  - без эмодзи, иконок и текста вроде "нет изображения";
  - с сохранением геометрии исходного медиа.

### 3.3 Иконки

- В прод-UI не использовать эмодзи как иконки.
- Предпочтительный набор иконок: `@expo/vector-icons/Feather`.
- Не копируй имена иконок между разными семействами.
- Перед новым семейством иконок проверь корректный рендер на web (без Metro stub-конфликтов).

### 3.4 Дизайн-токены

- Не хардкодь цвета hex-значениями в компонентах.
- Используй `DESIGN_TOKENS` из `constants/designSystem.ts`.
- CSS-переменные web: `app/global.css`.

## 4. Производительность и релиз

### 4.1 Локально перед деплоем

- Собирать web в production-режиме:
  - `npm run build:web:prod`
- Lighthouse запускать по production-сборке, а не по dev-серверу.

### 4.2 После деплоя

- Проверять перфоманс по реальному URL `https://metravel.by` (Lighthouse/PageSpeed).
- Не возвращать runtime/static service worker caching и сценарии "очистите кэш после релиза".

## 5. Правила качества кода

- Делай маленькие, читаемые, локальные изменения.
- Удаляй мертвый/неиспользуемый код, если он явно обнаружен в зоне задачи.
- Если в ходе работы найдена реальная ошибка, исправь в рамках текущей задачи или явно зафиксируй блокер.
- Не создавай новые отчеты без необходимости: обновляй существующую документацию в `docs/`.

## 6. Мини-чеклист перед завершением задачи

- Изменения ограничены scope задачи.
- Линт и тесты пройдены: `npm run lint`, `npm run test:run`.
- Не нарушены правила external links и governance.
- UI-поведение не сломано на web/mobile.
- Документация обновлена только при необходимости и в правильном месте (`docs/`).
